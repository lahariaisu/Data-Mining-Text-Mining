*------------------------------------------------------------*
User:                lahar
Date:                November 26, 2023
Time:                12:17:50
Site:                70085622
Platform:            X64_10HOME
Maintenance Release: 9.04.01M6P111518
EM Version:          15.1
* 
*------------------------------------------------------------*
* Training Log
Date:                November 26, 2023
Time:                12:17:39
*------------------------------------------------------------*
15225  proc freq data=EMWS3.TextCluster13_VariableSet noprint;
15226  table ROLE*LEVEL/out=WORK.TextCluster13META;
15227  run;
 
NOTE: There were 2 observations read from the data set EMWS3.TEXTCLUSTER13_VARIABLESET.
NOTE: The data set WORK.TEXTCLUSTER13META has 2 observations and 4 variables.
NOTE: PROCEDURE FREQ used (Total process time):
      real time           0.09 seconds
      cpu time            0.03 seconds
 
 
15228  proc print data=WORK.TextCluster13META label noobs;
15229  var ROLE LEVEL COUNT;
15230  label ROLE = "%sysfunc(sasmsg(sashelp.dmine, meta_role_vlabel, NOQUOTE))" LEVEL = "%sysfunc(sasmsg(sashelp.dmine, meta_level_vlabel, NOQUOTE))" COUNT = "%sysfunc(sasmsg(sashelp.dmine, rpt_count_vlabel, NOQUOTE))";
15231  title9 ' ';
15232  title10 "%sysfunc(sasmsg(sashelp.dmine, rpt_varSummary_title  , NOQUOTE))";
15233  run;
 
NOTE: There were 2 observations read from the data set WORK.TEXTCLUSTER13META.
NOTE: The PROCEDURE PRINT printed page 1.
NOTE: PROCEDURE PRINT used (Total process time):
      real time           0.03 seconds
      cpu time            0.00 seconds
 
 
15234  title10;
 
15235  %let EMEXCEPTIONSTRING=;
PERFORMANCE  DETAILS
15561  *------------------------------------------------------------*;
15562  * TextCluster13: Generation of macros and macro variables;
15563  * To see the code generated, set the EM_DEBUG macro variable to SOURCE or _ALL_;
15564  *------------------------------------------------------------*;
 
15565  %let EMEXCEPTIONSTRING=;
15566  *------------------------------------------------------------*;
15567  * TRAIN: TextCluster13;
15568  *------------------------------------------------------------*;
15569  %let EM_ACTION = TRAIN;
15570  %let syscc = 0;
15571  %macro main();
15572
15573     %if %upcase(&EM_ACTION) eq CREATE %then %do;
15574        filename temp catalog 'sashelp.emtxtext.cluster_create.source';
15575        %include temp;
15576        %create();
15577     %end;
15578     %if %upcase(&EM_ACTION) eq TRAIN %then %do;
15579        filename temp catalog 'sashelp.emtxtext.cluster_train.source';
15580        %include temp;
15581        %train();
15582     %end;
15583     %if %upcase(&EM_ACTION) eq REPORT %then %do;
15584        filename temp catalog 'sashelp.emtxtext.cluster_report.source';
15585        %include temp;
15586        %report();
15587     %end;
15588     %if %upcase(&EM_ACTION) eq SCORE %then %do;
15589        filename temp catalog 'sashelp.emtxtext.cluster_score.source';
15590        %include temp;
15591        %score();
15592     %end;
15593  %mend main;
15594
15595  %main();
NOTE: %INCLUDE (level 1) file TEMP is file SASHELP.EMTXTEXT.CLUSTER_TRAIN.SOURCE.
15596 +%macro train();
15597 +
15598 +    %global last_parse_node last_filter_node last_prescore_node server_err
15599 +      parsevar EM_SASMSG;
15600 +    %if ^%symexist(tm_debug) %then %let tm_debug=0;
15601 +    %let EM_SASMSG=TMINE;
15602 +    %let syscc=0;
15603 +
15604 +    filename temp catalog 'sashelp.emtxtext.tm_get_last_filter.source';
15605 +    %include temp;
15606 +    filename temp catalog 'sashelp.emtxtext.tm_cluster.source';
15607 +    %include temp;
15608 +    filename temp catalog 'sashelp.emtxtext.tm_apply_tmutil.source';
15609 +    %include temp;
15610 +    filename temp catalog 'sashelp.emtxtext.tm_svd_do_samp.source';
15611 +    %include temp;
15612 +    filename temp;
15613 +
15614 +    %tm_get_last_filter(eminfo=&EM_IMPORT_DATA_EMINFO,em_lib=&em_lib,
15615 +                        em_variableset=&em_data_variableset);
15616 +    %if &EMEXCEPTIONSTRING ne %then %goto end_cluster_train;
15617 +    %let lastparsenode=&last_parse_node;
15618 +    %let lastfilternode=&last_filter_node;
15619 +    %let lastprescore=&last_prescore_node;
15620 +    %if &lastfilternode=&lastparsenode %then %do;
15621 +        %let EMEXCEPTIONSTRING = EMTOOL.NOFILTERNODE;
15622 +        %goto end_cluster_train;
15623 +    %end;
15624 +
15625 +    /*populate last tm node dataset so tm_get_last_filter is not called in score*/
15626 +    %em_getname(key=last_tm_nodes, type=data);
15627 +    data &em_user_last_tm_nodes;
15628 +        set &EM_IMPORT_DATA_EMINFO;
15629 +    run;
15630 +
15631 +
15632 +    %em_getname(key=tmconfig, type=data);
15633 +    %em_getname(key=terms, type=data);
15634 +    %em_getname(key=docs, type=data);
15635 +    %em_getname(key=clusters, type=data);
15636 +    %em_getname(key=graph_table, type=data);
15637 +    %em_getname(key=svd_u, type=data);
15638 +    %em_getname(key=tmconfig, type=data);
15639 +    %em_getname(key=svd_s, type=data);
15640 +    %em_getname(key=emoutstat, type=data);
15641 +    %em_getname(key=hierds, type=data);
15642 +
15643 +
15644 +
15645 +    /* get target variable info */
15646 +    %let targetvar = ;
15647 +    data _null_;
15648 +       set &em_data_variableset(where=(ROLE='TARGET' and USE in('Y' 'D')
15649 +                                       and LEVEL ne 'INTERVAL'));
15650 +       if _N_=1 then call symput('targetvar', strip(NAME));
15651 +    run;
15652 +
15653 +
15654 +
15655 +    /* set up terms strings and initial config table */
15656 +    proc sql noprint;
15657 +      create table &EM_USER_tmconfig as
15658 +         select *
15659 +         from &EM_LIB..&last_filter_node._tmconfig;
15660 +    quit;
15661 +
15662 +
15663 +    proc sql noprint;
15664 +       select  cellwgt into: _cellweight
15665 +       from &em_user_tmconfig;
15666 +       select termwgt into: _termwgt
15667 +       from &em_user_tmconfig;
15668 +    quit;
15669 +
15670 +    data _keepdocs (keep=_DOCUMENT_ %if &targetvar ne %then &targetvar; );
15671 +        set &EM_IMPORT_DATA;
15672 +    run;
15673 +
15674 +    %tm_apply_tmutil(data=&EM_LIB..&last_filter_node._tmout,
15675 +                       terms=&EM_LIB..&last_filter_node._terms,
15676 +                       docs=&EM_IMPORT_DATA,
15677 +                       keepdocs=_keepdocs,
15678 +                       reduceF=2,
15679 +                       termweight=&_termwgt,
15680 +                       cellweight=&_cellweight,
15681 +                       outdata=_outtmutil_,
15682 +                       outterms=_newkey,
15683 +                       outweights=_weights,
15684 +                       targetvar=&targetvar,
15685 +                       memloc=_tmmem);
15686 +
15687 +                       /* get the svd dimensions on the documents */
15688 +    %tm_svd_do_samp(data=_outtmutil_,docs=_keepdocs, maxK=&em_property_maxK, res=&em_property_resolution,cellwgt=&_cellweight,in_global=_weights,
15689 +                     rowVar=_termnum_,colVar=_document_,entryVar=_count_,u=&EM_USER_SVD_U,v=_svdv,s=&EM_USER_svd_S,
15690 +                     colpro=_svdcolpro,rowpro=_svdrowpro, normcol=normcol, normrow=normrow,prefix=&EM_NODEID);
15691 +
15692 +    %if(&syscc >4 ) %then %do;
15693 +        %goto end_cluster_train;
15694 +    %end;
15695 +
15696 +    proc sql noprint;
15697 +       create table &EM_USER_TERMS(drop=index) as
15698 +       select a.*,b.*
15699 +       from &EM_LIB..&last_filter_node._terms a left join _svdrowpro b
15700 +       on a.key = b.index;
15701 +    quit;
15702 +
15703 +    %tm_cluster(data=&EM_LIB..&last_filter_node._tmout,
15704 +        terms=&EM_LIB..&last_filter_node._terms,
15705 +        docs=&EM_IMPORT_DATA,
15706 +        svdColPro=_svdcolpro,
15707 +        maxNumTerms=&em_property_ndescterms,
15708 +        numClus=&em_property_nclusters,
15709 +        numType=&em_property_exactormaximum,
15710 +        algorithm=&em_property_algorithm,
15711 +        outdocs=&EM_USER_DOCS,
15712 +        outclusters=&EM_USER_CLUSTERS,
15713 +        hierds=&EM_USER_HIERDS,
15714 +        emoutstat=&EM_USER_emoutstat,
15715 +        prefixstring= &EM_NODEID);
15716 +
15717 +    %if &emexceptionstring ne %then %goto end_cluster_train;
15718 +
15719 +    %if &em_property_algorithm=2.0 %then %do;
15720 +
15721 +        data &em_user_hierds(drop=plus);
15722 +            set &em_user_hierds;
15723 +            plus='';
15724 +            if substr(CLUS_DESC, 1, 1) = "+" then plus="+ ";
15725 +            graphdesc=_CLUSTER_ || ': ' || plus || scan(CLUS_DESC, 1);
15726 +        run;
15727 +    %end;
15728 +
15729 +
15730 +    * add the info to EMINFO to forward on to other nodes ;
15731 +   data &EM_DATA_EMINFO;
15732 +      length TARGET KEY $32 DATA $43;
15733 +
15734 +      key="LastTMNode";
15735 +      data="&EM_NODEID";
15736 +      output;
15737 +
15738 +      key="LastTMNodeType";
15739 +      data="TextCluster";
15740 +      output;
15741 +
15742 +      key="LastTextCluster";
15743 +      data="&EM_NODEID";
15744 +      output;
15745 +
15746 +      key="PRESCORECODE";
15747 +      data="&EM_NODEID";
15748 +      output;
15749 +   run;
15750 +
15751 +    proc sql noprint;
15752 +        select count(*) into :svdkeep
15753 +            from &em_user_svd_s
15754 +            where keep=1;
15755 +        select count(*) into :cluscnt
15756 +            from &em_user_clusters;
15757 +    quit;
15758 +   data &EM_USER_tmconfig;
15759 +         set &EM_USER_TMCONFIG;
15760 +         clus_alg = "&em_property_algorithm";
15761 +         maxsvd = &em_property_maxk;
15762 +         svdkeep=&svdkeep;
15763 +         last_prescore = "&last_prescore_node";
15764 +      run;
15765 +
15766 +    %em_metachange(name=&EM_NODEID._CLUSTER_, role=SEGMENT, level=NOMINAL);
15767 +    %do i=1 %to &svdkeep;
15768 +         %em_metachange(name=&EM_NODEID._SVD&i, role=INPUT, level=INTERVAL);
15769 +    %end;
15770 +    %do i=1 %to &cluscnt;
15771 +         %em_metachange(name=&EM_NODEID._PROB&i, role=REJECTED);
15772 +    %end;
15773 +
15774 +%end_cluster_train:
15775 +    filename temp;
15776 +    %if &tm_debug =0 %then %do;
15777 +        proc sql noprint;
15778 +              drop table _svdcolpro;
15779 +              drop table _svdrowpro;
15780 +              drop table _newkey ;
15781 +              drop table _keepdocs ;
15782 +        quit;
15783 +    %end;
15784 +
15785 +%mend train;
15786 +
NOTE: %INCLUDE (level 1) ending.
NOTE: %INCLUDE (level 1) file TEMP is file SASHELP.EMTXTEXT.TM_GET_LAST_FILTER.SOURCE.
15787 +/* ****************************************************************
15788 + * Copyright (C) 2009 by SAS Institute Inc., Cary, NC 27513
15789 + *
15790 + * Name:             tm_get_last_filter.sas
15791 + * Product:          SAS Text Miner
15792 + * Language:         Sas
15793 + * Script:
15794 + *
15795 + * Usage:
15796 + *
15797 + * Purpose:  macro to get the last filter node and the last parse node in the
15798 + *   diagram that corresponds to the current parse variable.  If there is no filter
15799 + *   node, the filter node is set to the last parse node.
15800 + *
15801 + *
15802 + *
15803 + * History:
15804 + * 14Aug09 Initial Coding
15805 + *
15806 + * Notes:
15807 + *    Returns an error in the following cases:
15808 + *      1. There is no preceding parse node.
15809 + *      2. There is no parse node with the current parse variable.
15810 + *
15811 + * Last Modified By:
15812 + * Last Modified On: Wed Sep 23 15:35:04 2009
15813 + *
15814 + * End
15815 + * ************************************************************** */
15816 +%macro tm_get_last_filter(eminfo=,em_lib=, em_variableset=);
15817 +   %let last_parse_node=;
15818 +   %let last_filter_node=;
15819 +   %let last_prescore_node=;
15820 +   %let server_err=;
15821 +   %let EMEXCEPTIONSTRING=;
15822 +   %let syscc=0;
15823 +
15824 +    /* verify that setinit for SAS Text Miner is currently active */
15825 +    %if %sysfunc(sysprod(PRODNUM107)) ne 1 %then %do;
15826 +       %let EMEXCEPTIONSTRING = EMTOOL.NOTMLICENSE;
15827 +        %goto end_macro;
15828 +        %end;
15829 +
15830 +
15831 +    * find last filter or text parse node if no filter node. ;
15832 +   %if %sysfunc(exist(&eminfo)) %then %do;
15833 +      proc sql noprint;
15834 +      select data into :last_parse_node from &eminfo where key="LastTextParsing";
15835 +         select data into :last_filter_node from &eminfo where key="LastTextFilter";
15836 +         select data into :last_prescore_node from &eminfo where kupcase(key)="PRESCORECODE";
15837 +      quit;
15838 +
15839 +   %end;
15840 +
15841 +   %if &last_parse_node= %then %do;
15842 +      %let EMEXCEPTIONSTRING = EMTOOL.NOPARSINGNODE;
15843 +      %goto end_macro;
15844 +      %end;
15845 +
15846 +   %else %if &last_filter_node= %then %let last_filter_node = %ktrim(&last_parse_node);
15847 +   %else %let last_filter_node = %ktrim(&last_filter_node);
15848 +   %let last_parse_node = %ktrim(&last_parse_node);
15849 +
15850 +   * Check to make sure parse variable is present and still exists;
15851 +   %let parsevar = ;
15852 +   proc sql noprint;
15853 +    select parsevar into :parsevar
15854 +    from &em_lib..&last_filter_node._tmconfig;
15855 +    quit;
15856 +
15857 +    *check for dropped parsevar on input dataset;
15858 +       %let parsevarOK= ;
15859 +       %let parsevarN=%kupcase(%ktrim(&parsevar));
15860 +       data _null_;
15861 +         set &em_variableset(where=(kupcase(NAME)="&parsevarN" and USE in('Y' 'D')));
15862 +         if (ROLE='TEXT' or ROLE='TEXTLOC') then call symput('parsevarOK', strip(ROLE));
15863 +         run;
15864 +       %if(&parsevarOK eq ) %then %do;
15865 +          %let EMEXCEPTIONSTRING = EMTOOL.NOPARSINGVAR;
15866 +          %goto end_macro;
15867 +          %end;
15868 +%end_macro:
15869 +
15870 +%mend tm_get_last_filter;
NOTE: %INCLUDE (level 1) ending.
NOTE: %INCLUDE (level 1) file TEMP is file SASHELP.EMTXTEXT.TM_CLUSTER.SOURCE.
15872 +   /* ****************************************************************
15873 + * Copyright (C) 2009 by SAS Institute Inc., Cary, NC 27513
15874 + *
15875 + * Name:             tm_cluster.sas
15876 + * Support:          rualbr Russell Albright
15877 + * Product:
15878 + * Language:         Sas
15879 + * Script:
15880 + *
15881 + * Usage:
15883 + !Inputs into %tm_train_cluster
15884 + * doc = doc datset from a tm node
15885 + * data =  out datset from a tm node
15886 + * terms = terms dataset from  tm node
15887 + * svdcolpro = column projections data set
15888 + * cellweight setting
15889 + * termweight setting
15890 + * maxSvddim = Maximum number of dimension to calculate
15891 + * svdres= <HIGH, MED, or LOW>
15892 + * maxNumTerms - maximum number of term to use for descriptive terms
15893 + * numClus = number of clusters to use
15894 + * numType=<MAXIMUM or EXACT> Max means that <= maximum will actually be used.
15895 + * threads = the number of threads you would like emclus to use
15898 + !Outputs from %tm_train_cluster
15899 + * outdocs - a doc table with the cluster restults on it.
15900 + * outclusters- an output cluster table with the descriptive terms on it (future story)
15901 + *
15902 + * Example call
15903 + *
15904 + *%tm_cluster(data=tmn.text_out_t,
15905 + *             terms=tmn.terms,
15906 + *             docs=testdata._train,
15907 + *             svdcolpro=tmn._svdcolpro,
15908 + *             maxNumTerms=5,
15909 + *             numClus=40,
15910 + *             numType=MAXIMUM,
15911 + *             outdocs=docsresult,
15912 + *             hierds=_hierds,
15913 + *             emoutstat=_emoutstat,
15914 + *             outclusters= clusterResult);
15915 + *
15916 + *
15917 + * Purpose: Perform the clustering on out,term, doc from parse or filter node
15918 + *
15919 + * History:
15920 + *
15921 + *
15922 + * Notes:
15923 + *
15924 + * Last Modified By:
15925 + * Last Modified On: Thu Jan 08 17:22:43 2009
15926 + *
15927 + * End
15928 + * ************************************************************** */
15930 +%macro tm_cluster(data=,
15931 +                     terms=,
15932 +                     docs=,
15933 +                     svdColPro=,
15934 +                     maxNumTerms=,
15935 +                     numClus=,
15936 +                     numType=MAXIMUM,
15937 +                     algorithm=,
15938 +                     outdocs=,
15939 +                     hierds=_hierds,
15940 +                     emoutstat=_emoutstat,
15941 +                     outclusters=,
15942 +                     prefixString=,
15943 +                     threads=);
15946 +    %local _cleanedout ;
15947 +    %local _numRepDocs;
15948 +    %global systmutil;
15949 +    %let systmutil = ;
15950 +    %if ^%symexist(tm_debug) %then %let tm_debug=0;
15952 +    filename temp catalog 'sashelp.emtext.tmgetncl.source';
15953 +    %include temp;
15954 +    filename temp catalog 'sashelp.emtext.tmfast.source';
15955 +    %include temp;
15957 +    filename temp catalog 'sashelp.emtext.tmemclus.source';
15958 +    %include temp;
15960 +    filename temp catalog 'sashelp.emtext.tmpred.source';
15961 +    %include temp;
15963 +    filename temp catalog 'sashelp.emtext.tmsort.source';
15964 +    %include temp;
15966 +    %let tmdata=&data;
15967 +    %let tmterms=&terms;
15968 +    %let tmdocs=&docs;
15969 +    %let emexceptionstring=;
15972 +    /* check some basic size requirements to proceed.*/
15973 +    proc sql noprint;
15974 +       select count(*) into: numTerms
15975 +       from &terms a
15976 +       where a.numdocs>=2 and _ispar in('+',' ')
15977 +       ;
15978 +       select count (*) into: numdocs
15979 +       from &docs a;
15980 +    quit;
15982 +    %if (&numterms < 10)  OR (&numdocs< 8) %then %do;
15983 +        %let emexceptionstring=EMTOOL.INSUFFICIENTDATA;
15984 +        %goto end_train_cluster;
15985 +    %end;
15987 +    /* Get number of kept svd variables */
15988 +    %let pid = %sysfunc(open(&svdcolpro));
15989 +    %let svdkeep=%eval(%sysfunc(attrn(&pid,nvars))-1);
15990 +    %let rc = %sysfunc(close(&pid));
15993 +   /************************ Find clusters *************************************/
15995 +   %if %upcase(&numType) = MAXIMUM %then %do;   /* numClus = MAXIMUM */
15997 +      /* Call tmgetncl to find the recommended number of clusters. */
15999 +      %tmGetNcl(data=&svdcolpro,
16000 +               maxclusters=&numClus,
16001 +               vars=%str(&prefixstring._SVD1 - &prefixstring._SVD&svdkeep),
16002 +               tempDS=_clusTemp1,
16003 +               clusDS=_clusTemp,
16004 +               threads=
16005 +            );
16007 +      /* error returned in above macro */
16008 +      %if (&syscc >4 ) %then %do;
16009 +         %let emexceptionstring= &SYSERRORTEXT;
16010 +         %goto end_train_cluster;
16011 +      %end;
16013 +      /* Store the recommended number into a macro variable. */
16015 +      proc sql noprint;
16016 +         select max(nclus) into: numClus
16017 +         from _clusTemp
16018 +         ;
16019 +      quit;
16022 +      %if not (&numClus > 1) %then %do;
16023 +        %let numClus = 2;
16024 +      %end;
16027 +       %if &tm_debug =0  %then %do;
16028 +          proc sql nowarn noprint;
16029 +              drop table _clustemp;
16030 +              drop table _clustemp1;
16031 +           quit;
16032 +       %end;
16034 +   %end;  /* &numtype = MAXIMUM */
16036 +   %else  %do;
16037 +       %let numClus = %left(&numClus);/*&numtype=EXACT*/
16038 +   %end;
16040 +    proc sql noprint;
16041 +        select count(*) into: nobs
16042 +        from &svdcolpro;
16043 +    quit;
16045 +   %if %left(&algorithm)=2.0 %then %do; /* Hierarchical clustering */
16046 +        filename temp catalog 'sashelp.emtxtext.tmgethclus.source';
16047 +        %include temp;
16049 +        filename temp catalog 'sashelp.emtext.tmhclus.source';
16050 +        %include temp;
16051 +        filename temp catalog 'sashelp.emtext.tmtree.source';
16052 +        %include temp;
16054 +        %if &nobs < &numClus and  %upcase(&numType) = EXACT %then %do;
16055 +            %let emexceptionstring=EMTOOL.TOOFEWOBSTOCLUS;
16056 +            %goto end_train_cluster;
16057 +        %end;
16059 +        %tmgethclus(outtree=_outtree,
16060 +                    idvar=index,
16061 +                    inDS=&svdcolpro,
16062 +                    outDS=&outdocs,
16063 +                    fastOut=_fastclusstat,
16064 +                    textClusDS=_clusstat,
16065 +                    vars=%str(&prefixstring._SVD1 - &prefixstring._SVD&svdkeep),
16066 +                    nobs=&nobs,
16067 +                    nclus=&numClus,
16068 +                    hierds=&hierds,
16069 +                    svdkeep=&svdkeep,
16070 +                    prefix=&prefixString);
16071 +        %if &EMEXCEPTIONSTRING ne %then %goto end_train_cluster;
16073 +        data _clusstat;
16074 +            set _clusstat(rename=(&prefixstring._SVD1 - &prefixstring._SVD&svdkeep.=_mean1-_mean&svdkeep.));
16075 +        run;
16077 +        data _clustermean;
16078 +          set _clusstat(keep=_cluster_ _mean1-_mean&svdkeep. rename=(_cluster_=cluster));
16079 +        run;
16081 +        proc sql noprint;
16082 +            drop table _outtree;
16083 +        quit;
16084 +   %end;
16085 +   %else %do; /* Expectation-maximization */
16086 +       /* Call %anl_tmfast to create cluster stat data set that will be used as an input for %anl_tmemclus. */
16087 +          %tmFast(data=&svdcolpro,
16088 +             clusters=&numClus,
16089 +             outstat=_fastclusstat,
16090 +             outseed=,
16091 +                id=,
16092 +             out=,
16093 +             vars=%str(&prefixstring._SVD1 - &prefixstring._SVD&svdkeep)
16094 +             );
16095 +          run;
16097 +          /* If some of the clusters are too small (frequency less than 5) and &g_numClusFlag=MAXIMUM, */
16098 +          /* reassign value for &cluster macro var from WORK.&s_reportID._fastclusstat data set. */
16100 +       %if %upcase(&numType) = MAXIMUM %then
16101 +       %do;   /* &ClusType = MAXIMUM */
16103 +          proc sql noprint;
16104 +             select max(CLUSTER) into :numClus
16105 +             from _fastclusstat
16106 +             where upcase(_TYPE_)='SEED'
16107 +             ;
16108 +          quit;
16110 +          %let numClus = %left(&numClus);
16112 +       %end;  /* &ClusType = MAXIMUM */
16113 +       %else %do; /* &ClusType = EXACT */
16114 +          %if &nobs < &numClus %then %do;
16115 +            %let emexceptionstring=EMTOOL.TOOFEWOBSTOCLUS;
16116 +            %goto end_train_cluster;
16117 +          %end;
16118 +       %end;
16120 +       %tmEMClus(data=&svdcolpro,
16121 +                role=TRAIN,
16122 +                clusters=&numClus,
16123 +                seed=_fastclusstat,
16124 +                outstat=&emoutstat,
16125 +                out=_tmutildoc,
16126 +                vars=%str(&prefixstring._SVD1 - &prefixstring._SVD&svdkeep),
16127 +                cov=,
16128 +                iter=5,
16129 +                secclus=,
16130 +                seciter=,
16131 +                min=,
16132 +                method=,
16133 +                eps=.1,
16134 +                init=FASTCLUS,
16135 +                print=NONE,
16136 +                p=,
16137 +                outliers=,
16138 +                decvar=0,
16139 +                initstd=,
16140 +                dist=,
16141 +                secstd=,
16142 +                nobs=,
16143 +                threads=&threads.
16144 +             );
16145 +       run;
16148 +       /* Run %anl_tmpred macro to assign documents to clusters with the largest posterior probability */
16149 +       /* and to calculate cluster frequency. */
16151 +       %tmPred (inds=_tmutildoc,
16152 +                outds=&outdocs,
16153 +              clusters=&numClus,
16154 +              type=max,
16155 +              freqds=_clusstat,
16156 +              compress=1
16157 +              );
16158 +        data &outdocs;
16159 +           set &outdocs;
16160 +           rename prob1-prob&numClus = &prefixString._prob1-&prefixString._prob&numclus;
16161 +        run;
16165 +       /* Transpose the output data set to contain cluster ID and cluster frequency. */
16167 +        data _clusstat;
16168 +            array c(&numClus) _c1-_c&numClus;
16169 +            set _clusstat;
16170 +            /*keep _CLUSTER_ Freq;*/
16171 +            totalobs=0;
16172 +            do _CLUSTER_ = 1 to &numClus;
16173 +                Freq = c(_CLUSTER_);
16174 +                totalobs=totalobs+c(_CLUSTER_);
16175 +                output;
16176 +            end;
16177 +            call symput ('totNumDocs', totalobs);
16178 +        run;
16180 +       %if &totNumDocs = 0 %then
16181 +       %do;   /*&totNumDocs = 0 */
16182 +           goto end_train_cluster;
16183 +       %end; /*&totNumDocs = 0 */
16185 +       /* Calculate cluster percentage. */
16186 +       data _clusstat;
16187 +          set _clusstat;
16188 +          Percent = Freq/&totNumDocs;
16189 +       run;
16191 +       data _clustermean(rename=(&prefixstring._SVD1 - &prefixstring._SVD&svdkeep. = _mean1-_mean&svdkeep.));
16192 +          set &emoutstat(keep=cluster _TYPE_ &prefixstring._SVD1 - &prefixstring._SVD&svdkeep.);
16193 +          if _TYPE_ = "MEAN";
16194 +            keep cluster &prefixstring._SVD1 - &prefixstring._SVD&svdkeep. ;
16195 +      run;
16196 +  %end;
16198 +      proc sql;
16199 +      create table _meandocs(drop=cluster) as
16200 +      select a.*, b.*
16201 +      from &outdocs a left join _clustermean b
16202 +      on a._cluster_=b.cluster
16203 +      ;
16204 +      quit;
16205 +       /*calulate residual for each doc */
16206 +      data _rmscalc;
16207 +          merge _meandocs(in=inhere) _clusstat;
16208 +          array _means(&svdkeep) _mean1-_mean&svdkeep.;
16209 +          array _svds(&svdkeep) &prefixstring._SVD1 - &prefixstring._SVD&svdkeep.;
16210 +          by _cluster_;
16211 +          error=0;
16212 +          do i = 1 to &svdkeep;
16213 +             error +( (_svds{i}-_means{i}) * (_svds{i}-_means{i}));
16214 +          end;
16215 +         /*error=sqrt(error);*/
16216 +          drop i;
16217 +       run;
16218 +    /*calc standardized residual for clusters*/
16219 +       proc summary data=_rmscalc nway;
16220 +          class _cluster_;
16221 +          var error;
16222 +          output out=_meanerr mean=meane sum=sume;
16223 +       run;
16225 +       data _rmsse;
16226 +          set _meanerr;
16227 +          /* original code divides by number of svd dims*/
16228 +          if _freq_ gt 1 then do;
16229 +              _rmsstd_=sqrt(sume/((_freq_-1)*(&svdkeep.)));
16230 +          end;
16231 +          else do;
16232 +              _rmsstd_=0;
16233 +          end;
16234 +          keep _cluster_  _rmsstd_;
16235 +       run;
16238 +       proc sql;
16239 +           create table _clusstat2(drop=cluster) as
16240 +           select a.*,b.*
16241 +           from _clustermean a left join _rmsse b
16242 +           on a.cluster=b._cluster_;
16244 +           create table &outclusters as
16245 +           select  a.*, b.freq, b.percent
16246 +           from _clusstat2(keep=_cluster_ %str(_mean1-_mean&svdkeep) _rmsstd_) a right join _clusstat b
16247 +           on a._cluster_=b._cluster_
16248 +           where b.freq>0 ;
16249 +       quit;
16252 +    filename temp catalog 'sashelp.emtext.tmterm1.source';
16253 +    %include temp / nosource2;
16255 +   /****************** Find descriptive terms for clusters ***************************/
16258 +   /* Add _term_ variable to WORK._terms data set to prepare it as an
16259 +   /* input to %tmterm1 macro. The variable is added from &EM_LIB..&last_filter_node._terms data set. */
16261 +   proc sort data=&tmterms out=_terms_;
16262 +        by key _ispar;
16263 +   run;
16265 +   data _terms_;
16266 +       set _terms_;
16267 +       by key _ispar;
16268 +       if first.key then
16269 +          output;
16270 +       else;
16271 +   run;
16273 +    /* Concatenate + to terms */
16274 +    data _terms_;
16275 +        set _terms_;
16276 +        if _ispar='+' then
16277 +            Term=_ispar || ' ' || term;
16278 +    run;
16280 +   %tmsort(data=&tmdata,
16281 +         out=_tmout_,
16282 +         by=_termnum_,
16283 +            options=,
16284 +         threads=threads);
16287 +   data _tmout_;
16288 +      merge _tmout_ (in=_A_)
16289 +            _terms_ (rename=(key=_termnum_ term=_term_) keep=key term );
16290 +      by _termnum_;
16291 +      if _A_;
16292 +   run;
16294 +   /* Create _segmnt_ variable in WORK._docs data set to prepare it to be an */
16295 +   /* input to %tmterm1 macro. Set it equal to _cluster_ variable. */
16297 +   %if &algorithm=2.0 %then %do;
16298 +        data _docs_;
16299 +            set &outdocs (rename=(index=_document_) keep=index _cluster_ _finalcluster_);
16300 +            _SEGMNT_=_finalcluster_;
16301 +        run;
16302 +        proc sql noprint;
16303 +            select max(_cluster_) into :numclus from &outclusters;
16304 +        quit;
16305 +   %end;
16306 +   %else %do;
16307 +       data _docs_;
16308 +        set &outdocs (rename=(index=_document_) keep=index _cluster_);
16309 +         _SEGMNT_=_cluster_;;
16310 +       run;
16312 +   %end;
16314 +   /* Run %tmterm1 macro to determine descriptive terms for clusters. */
16315 +   %tmterm1(DSN_TPARS=_tmout_,
16316 +        DSN_CLUS=_docs_,
16317 +        DSN_DESC=_desc_,
16318 +        N_DESC_TERMS=&maxnumterms,
16319 +        N_CLUS=&numclus,
16320 +        top_freq=%eval(&maxnumterms*2),
16321 +        key=);
16323 +    /* Add cluster descriptive terms to clusters table. */
16324 +   %tmsort(data=&outclusters,
16325 +         out=&outclusters,
16326 +         by=_cluster_,
16327 +            options=,
16328 +         threads=threads);
16330 +   %tmsort(data=_desc_,
16331 +         out=_desc_,
16332 +         by=_cluster_,
16333 +            options=,
16334 +         threads=threads);
16336 +   data _desc_;
16337 +      merge &outclusters _desc_;
16338 +      by _cluster_;
16339 +   run;
16341 +   %tmsort(data=_desc_,
16342 +         out=&outclusters,
16343 +         by=_cluster_,
16344 +            options=,
16345 +         threads=threads);
16347 +   %if &algorithm=2.0 %then %do;
16349 +        %tmsort(data=&HIERDS,
16350 +         out=&HIERDS,
16351 +         by=_cluster_,
16352 +            options=,
16353 +         threads=threads);
16355 +        data &HIERds;
16356 +            merge &outCLUSTERS &HIERds (keep=_cluster_ parent level in=P);
16357 +            by _cluster_;
16358 +            clust=_cluster_;
16359 +            drop _cluster_;
16360 +            if P;
16361 +        run;
16363 +        %let empty=1;
16365 +        /* Be sure that all parent clusters are on outclusters ds */
16366 +        proc sql noprint;
16367 +            create table &outclusters as
16368 +                select a._cluster_, b.* from &hierds (rename=(clust=_CLUSTER_)) a
16369 +                left join &outclusters b
16370 +                on a._cluster_=b._cluster_;
16371 +        quit;
16373 +        %do %while (&empty);
16374 +            proc sql noprint;
16375 +                update &outclusters set freq=
16376 +                    (select sum(freq) from &HIERDS
16377 +                    where parent=_cluster_), percent=
16378 +                    (select sum(percent) from &HIERDS
16379 +                    where parent=_cluster_)
16380 +                    where freq=. and _cluster_ not in
16381 +                    (select parent from &hierds where freq=.);
16382 +                select count(*) into :empty from &outclusters
16383 +                    where freq=.;
16384 +                update &hierds set freq=(select freq from &outclusters where _cluster_=clust);
16385 +            quit;
16386 +            data &HIERds;
16387 +                merge &OUTCLUSTERS &HIERds (
16388 +                    rename=(clust=_cluster_) keep=clust parent level in=P);
16389 +                by _cluster_;
16390 +                clust=_cluster_;
16391 +                drop _cluster_;
16392 +                if P;
16393 +            run;
16394 +        %end;
16396 +        data &hierds;
16397 +            set &hierds(rename=(CLUST=_CLUSTER_) keep=clust FREQ CLUS_DESC PARENT level);
16398 +        run;
16399 +        data &outclusters;
16400 +            set &outclusters;
16401 +            if _rmsstd_ ne .;
16402 +        run;
16404 +        data &outdocs;
16405 +            set &outdocs (drop=_FINALCLUSTER_ _SUBCLUSTER_);
16406 +            label _CLUSTER_=Cluster ID;
16407 +        run;
16409 +    %end;
16411 +   %end_train_cluster:
16413 +       filename temp;
16415 +       %if &tm_debug =0  %then %do;
16416 +          proc sql nowarn noprint;
16417 +              drop table _clusstat;
16418 +              drop table _clusstat2;
16419 +              drop table _fastclusstat;
16420 +              drop table _clustermean;
16421 +              drop table _meandocs;
16422 +              drop table _rmscalc;
16423 +              drop table _rmsse;
16424 +              drop table _meanerr;
16425 +              drop table _tmutildoc;
16426 +              drop table _desc_;
16427 +              drop table _terms_;
16428 +              drop table _docs_;
16429 +              drop table _tmout_;
16430 +           quit;
16431 +       %end;
16434 +%mend;
NOTE: %INCLUDE (level 1) ending.
NOTE: %INCLUDE (level 1) file TEMP is file SASHELP.EMTXTEXT.TM_APPLY_TMUTIL.SOURCE.
16436 + /*****************************************************************
16437 + * Copyright (C) 2009 by SAS Institute Inc., Cary, NC 27513
16438 + *
16439 + * Name:             tm_apply_tmutil.sas
16440 + * Support:          rualbr Russell Albright
16441 + * Product:
16442 + * Language:         Sas
16443 + * Script:
16444 + *
16445 + * Usage:
16446 + *
16447 + * data= out data set from tgparse
16448 + * terms= terms from tgparse
16449 + * offsets=  addoffset data set form tgparse
16450 + * docs=  data set of document id's and potentially target, not required unless target weighting is used.
16451 + * keepdocs= list of docs to keep. This is a subset of the original docs data set. Not required.
16452 + * reduceF=defaults to log(n) if not specified, eliminates terms if not in at least that many docs
16453 + *     use reduceF=1 to retain all terms.
16454 + * termweight= none, entropy, mi,
16455 + * cellweight= none, log, bin,
16456 + * synnum= Input synonym data set of _termnum_, parent ID pairs
16457 + * synchar= Input synonym data set of term,termrole, parent, parentrole. This data set will
16458 + * get converted to synnym format by the macro tm_convert_syns.
16459 + * targetvar= name of variable on doc dataset contining targetvar.
16460 + * outdata= output out dataset with no more children on this dataset
16461 + * outterms= output terms dataset with dup terms eliminated
16462 + * outweights= weight vector for the terms
16463 + * outoffsets= subsetted outtable with childterms replaced with parents
16464 + * applyweight = , indicates if the weight settings are to be applied to the output OUT table. 0 no, 1 yes.
16465 + * memloc= string for tmutil to use to store its memory pointer. Normally the default can just be used.
16466 + * keeponly=Y  If set to Y (default), then only kept terms are output in terms table.
16467 + *
16468 + * Purpose: Massage the out and key from docparse so that they can bes used
16469 + * in data mining applications.
16470 + *
16471 + * History:
16472 + *
16473 + * Notes:
16474 + *
16475 + * Last Modified By:
16476 + * Last Modified On: Tue Mar 05 16:32:57 2013
16477 + *
16478 + * End
16479 + * ************************************************************** */
16482 +%macro tm_apply_tmutil(data=, terms=,docs=,offsets=,keepdocs=,termweight=none,
16483 +                            cellweight=none,reduceF=,outdata=,outterms=,outweights=,
16484 +                            outoffsets=, synnum=,synchar=, targetvar=, applyweight = 0,
16485 +                            memloc=tmutil_loc,keeponly=Y,repOnly=N);
16486 +     %local keepdocs tempF reduceF synnum  terms  paraExist sentExist;
16489 +    %let EMEXCEPTIONSTRING=;
16490 +    %let syscc=0;
16491 +    %let systmutil=0;
16495 +    /* Find terms to drop */
16496 +        %if &keepdocs ne %then %do;
16497 +          proc sql noprint;
16498 +                create view _keepdata as
16499 +                select * from &data where _DOCUMENT_ in
16500 +                (select _DOCUMENT_ from &keepdocs);
16501 +          quit;
16502 +        %end;
16503 +          %else %do;
16505 +             proc sql noprint;
16506 +                 create view _keepdata as
16507 +                 select * from &data;
16508 +             quit;
16510 +           %let keepdocs=&docs;
16511 +        %end;
16514 +    /* set default on reduceF*/
16515 +         %if &reduceF = %then %do;
16516 +            proc sql noprint;
16517 +           select count(*) into :numdocs from &docs;
16518 +        quit;
16519 +        %let tempF = %sysfunc(log10(%eval(&numdocs+1)));
16520 +        %let reduceF= %sysfunc(floor(&tempF));
16521 +         %end;
16524 +    /* find synnum if synchar supplied */
16526 +    %if &synchar ne %then %do;
16527 +            filename temp catalog 'sashelp.emtxtext.tm_convert_syns.source';
16528 +            %include temp;
16529 +            %tm_convert_syns(insyns= &synchar, outsyns=_myOutsyns ,
16530 +                         interms=&terms,
16531 +                          outterms=newterms );
16532 +                %let numsyns=0;
16533 +                proc sql;
16534 +                   select count(*) into: numsyns
16535 +                   from _myOutsyns;
16536 +                quit;
16537 +                %if &numsyns >0 %then %do;
16538 +                   %Let synnum=_myOutsyns;
16539 +                   %let terms=newterms;
16540 +                %end;
16541 +    %end;
16542 +    /* get the out and key in the proper format*/
16543 +    proc tmutil data=_keepdata key= &terms doc=&keepdocs
16544 +        %if &targetvar ne %then target=&targetvar;
16545 +        ;
16546 +        control init memloc="&memloc";
16547 +            %if &synnum ne %then syn syndata=&synnum force;
16548 +         ;
16549 +    run;
16550 +    %if &syscc >4 %then %goto end_tm_apply_tmutil;
16551 +    %if &reduceF>1 %then %do;
16552 +           proc tmutil;
16553 +           control memloc="&memloc";
16554 +               select reduceF=&reduceF;
16555 +        run;
16556 +   %end;
16557 +    %if &syscc >4 %then %goto end_tm_apply_tmutil;
16559 +     proc tmutil;
16560 +        control memloc="&memloc" release;
16561 +        weight termwgt=&termweight cellwgt=&cellweight;
16562 +            output key=_termstmutil  keyformat=default
16563 +               %if &keeponly eq Y %then keeponly;
16564 +               %if &applyweight  eq 0 %then unweighted ;
16565 +               out=&outdata;
16566 +    run;
16567 +    %if &syscc >4 %then %goto end_tm_apply_tmutil;
16569 +    proc sql noprint;
16570 +           create table _distinctterms as
16571 +           select distinct key,term, role, attribute
16572 +           from &terms;
16574 +       create table &outterms as
16575 +       select  b.term, b.role,b.attribute ,a.*
16576 +       from _termstmutil a left join  _distinctterms b
16577 +       on a.key=b.key;
16578 +       ;
16579 +       %if &outweights ne %then %do;
16580 +          create table &outweights as
16581 +          select distinct a.key as index, a.weight as gwgt
16582 +          from &outterms(where=(_ispar in('+',' '))) a inner join
16583 +                         _distinctterms b
16584 +          on a.key =b.key;
16585 +       %end;
16587 +     quit;
16588 +     %if &offsets ne and &outoffsets ne %then %do;
16590 +        %let paraExist=0; %let sentExist=0;
16591 +        data _null_;
16592 +          dsid=open("&offsets");
16593 +          para=varnum(dsid,'_paragraph_');
16594 +          sent=varnum(dsid,'_sentence_');
16595 +          if para ge 1 then call symput('paraExist',1);
16596 +          if sent ge 1 then call symput('sentExist',1);
16597 +          run;
16600 +        proc sql noprint;
16601 +        create table &outoffsets as
16602 +           select  a._document_,
16603 +              %if &paraExist=1 %then a._paragraph_, ;
16604 +              %if &sentExist=1 %then a._sentence_,;
16605 +              a._offset_, a._length_, b.parent_id as _termnum_
16606 +                 from &offsets a, _termstmutil (where=(_ispar ne "+" and keep="Y")) b
16607 +                 where a._termnum_ = b.key;
16608 +              quit;
16609 +       %end;
16613 +     %end_tm_apply_tmutil:
16615 +     %if ^%symexist(tm_debug) %then %let tm_debug=0;
16616 +       %if &tm_debug =0  %then %do;
16617 +          proc sql noprint;
16618 +            drop table _termstmutil;
16619 +            drop table _distinctterms;
16620 +            drop view _keepdata;
16621 +            %if &synchar ne and &synnum ne  %then drop table &synnum; ;
16622 +         quit;
16623 +     %end;
16624 +     %if &syscc >4 and &systmutil > 4 %then %do;
16625 +           %let EMEXCEPTIONSTRING = EMTOOL.TMUTIL,&systmutil;
16626 +           %put emexceptionstring= "&EMEXCEPTIONSTRING";
16627 +           %let syscc=0;
16628 +     %end;
16630 +%mend;
NOTE: %INCLUDE (level 1) ending.
NOTE: %INCLUDE (level 1) file TEMP is file SASHELP.EMTXTEXT.TM_SVD_DO_SAMP.SOURCE.
16632 +   /* ****************************************************************
16633 + * Copyright (C) 2009 by SAS Institute Inc., Cary, NC 27513
16634 + *
16635 + * Name:             tm_svd_do_samp.sas
16636 + * Product:
16637 + * Language:         Sas
16638 + * Script:
16639 + *
16640 + * Usage:
16641 + *
16642 + * data=out dataset containing only repreentative terms
16643 + * maxK= max number of dimensions to use to computer svd
16644 + * res=<high, med, low> guidenceon what number of dims to choose
16645 + * cellwgt= <none, log, binary>
16646 + * in_global= dataset with index, weight variables
16647 + * rowVar= name of the variable representing row(term)
16648 + * colVar= name of the variable representing col
16649 + * entryVar=count for row,col
16650 + * u= name of output u matrix
16651 + * v= name of output v matrix
16652 + * s= name of output s matrix
16653 + * colpro=dataset to hold projections for terms
16654 + * rowpro= datset to hold projections for docs
16655 + * normcol=<normcol> extra option to add to normalize docs
16656 + * normrow=<normrow> extra option to add to normalize terms
16657 + * docs =<document data set of ids that are being analyzed.
16658 +*      docs needs to be input explicit since some docs may have not terms
16659 + *
16660 + * Purpose: macro to run svd and compute projections, first without mpling
16661 + * and then with sampling onon.
16662 + *
16663 + * History:
16664 + *
16665 + * Notes:
16666 + *
16667 + * Last Modified By:
16668 + * Last Modified On: Thu Jan 08 17:22:43 2009
16669 + *
16670 + * End
16671 + * ************************************************************** */
16672 +%macro tm_svd_do_samp(data=,docs=,maxK=,res=,cellwgt=,in_global=,
16673 +                     rowVar=,colVar=,entryVar=,u=,v=,s=,
16674 +                     colpro=,rowpro=,normcol=, normrow=,prefix=SVD);
16676 +   %local svdkeep;
16677 +   %let syscc=0;
16678 +   proc sort data=&data; by _termnum_; run;
16680 +   proc spsvd data=&data max_k = &maxK res = &res
16681 +       local = &cellWgt global =none in_global = &in_global;
16682 +       row _termnum_;
16683 +       col _document_;
16684 +       entry _count_;
16685 +       output  u = &U v = &V s = &s;
16686 +   run;
16688 +   /*try sampling if out of memory occurred*/
16689 +   %if(&syscc eq 1111) %then %do;
16690 +      %let syscc=0; /*reset syscc*/
16691 +      proc spsvd data = &data max_k = &maxK res = &res
16692 +          local = &cellWgt global = none in_global = &in_global ;
16693 +          row &rowVar;
16694 +          col &colVar;
16695 +          entry &entryVar;
16696 +          output u = &U v = &V s = &s;
16697 +          sample allow;
16698 +      run;
16699 +   %end;
16700 +    %if &syscc > 4 %then %do;
16701 +       %let EMEXCEPTIONSTRING = EMTOOL.SPSVDERROR;
16702 +       %goto end_svd_do_samp;
16703 +    %end;
16706 +   /* if resolution is used, the matrix U/V must be truncated to the set number of dim.*/
16707 +   proc sql noprint;
16708 +       select count(*) into: svdkeep
16709 +       from &s
16710 +       where keep=1;
16711 +    quit;
16713 +    %let svdkeep=%left(&svdkeep);
16714 +    data &U;
16715 +    set &U(keep= index col1-col&svdkeep);
16716 +    run;
16718 +    data &V;
16719 +    set &V(keep= index col1-col&svdkeep);
16720 +    run;
16721 +    %if &colpro ne %then %do;
16722 +       /* when sampling weights may have wrong dimensions*/
16723 +       proc sql noprint;
16724 +          create table new_global as
16725 +             select a.*
16726 +             from &in_global a, &U b
16727 +             where a.index = b.index;
16728 +       quit;
16731 +        proc sort data=&data; by &colVar; run;
16732 +        proc spsvd data=&data IN_U=&U
16733 +            local = &cellWgt global = none in_global = new_global ;
16734 +            row &rowVar;
16735 +            col &colVar;
16736 +            entry &entryVar;
16737 +            output colpro=&colpro bigpro normcol prefix="&prefix._SVD";
16738 +        run;
16740 +        proc sort data=&docs(keep=_document_)  out=_docids;
16741 +        by _document_;
16742 +        run;
16744 +        data &colpro;
16745 +           merge &colpro _docids(rename=(_document_=index));
16746 +        by index;
16747 +        run;
16750 +        data &colpro;
16751 +          set  &colpro;
16752 +          array svd_array &prefix._SVD1 - &prefix._SVD&SVDKEEP;
16753 +          do i = 1 to dim(svd_array);
16754 +             if svd_array(i)=. then svd_array(i)=0;
16755 +          end;
16756 +          drop i;
16757 +        run;
16758 +    %end;
16760 +    %if &syscc > 4 %then %do;
16761 +       %let EMEXCEPTIONSTRING = EMTOOL.SPSVDERROR;
16762 +       %goto end_svd_do_samp;
16763 +    %end;
16765 +    %if &rowpro ne %then %do;
16766 +        proc sort data=&data; by &rowVar; run;
16767 +        /* when sampling weights may have wrong dimensions*/
16768 +       proc sql;
16769 +          create table new_global as
16770 +             select a.*
16771 +             from &in_global a, &U b
16772 +             where a.index = b.index;
16773 +       quit;
16775 +        proc spsvd data=&data IN_V=&V
16776 +            local = &cellWgt global = none in_global = new_global ;
16777 +            row &rowVar; col &colVar; entry &entryVar;
16778 +            output wordPro = &rowpro bigpro normrow prefix="&prefix._SVD";
16779 +        run;
16780 +    %end;
16782 +    %if &syscc > 4 %then %do;
16783 +       %let EMEXCEPTIONSTRING = EMTOOL.SPSVDERROR;
16784 +       %goto end_svd_do_samp;
16785 +    %end;
16787 +   %end_svd_do_samp:
16789 +%mend;
NOTE: %INCLUDE (level 1) ending.
NOTE: Fileref TEMP has been deassigned.
NOTE: PROCEDURE SQL used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
 
 
NOTE: PROCEDURE SQL used (Total process time):
      real time           0.01 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 1 observations read from the data set EMWS3.TEXTCLUSTER13_VARIABLESET.
      WHERE (KUPCASE(NAME)='RESUME_STR') and USE in ('D', 'Y');
NOTE: DATA statement used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 5 observations read from the data set EMWS3.TEXTFILTER7_EMINFO.
NOTE: The data set EMWS3.TEXTCLUSTER13_LAST_TM_NODES has 5 observations and 3 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 1 observations read from the data set EMWS3.TEXTCLUSTER13_VARIABLESET.
      WHERE (ROLE='TARGET') and USE in ('D', 'Y') and (LEVEL not = 'INTERVAL');
NOTE: DATA statement used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
 
 
NOTE: Table EMWS3.TEXTCLUSTER13_TMCONFIG created, with 1 rows and 31 columns.
 
NOTE: PROCEDURE SQL used (Total process time):
      real time           0.02 seconds
      cpu time            0.00 seconds
 
 
NOTE: PROCEDURE SQL used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 674 observations read from the data set EMWS3.TEXTPARSING_TRAIN.
NOTE: There were 674 observations read from the data set EMWS3.TEXTFILTER7_DOC_IDS.
NOTE: There were 674 observations read from the data set EMWS3.TEXTFILTER7_TRAIN.
NOTE: The data set WORK._KEEPDOCS has 674 observations and 2 variables.
NOTE: DATA statement used (Total process time):
      real time           0.11 seconds
      cpu time            0.03 seconds
 
 
NOTE: SQL view WORK._KEEPDATA has been defined.
NOTE: PROCEDURE SQL used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There are 12 distinct target levels.
NOTE: There were 218546 observations read from the data set EMWS3.TEXTFILTER7_TMOUT.
NOTE: There were 674 observations read from the data set WORK._KEEPDOCS.
NOTE: There were 218546 observations read from the data set WORK._KEEPDATA.
NOTE: There were 16666 observations read from the data set EMWS3.TEXTFILTER7_TERMS_DATA.
      WHERE KEEP='Y';
NOTE: There were 73331 observations read from the data set EMWS3.TEXTFILTER7_TERM_STRINGS.
NOTE: There were 674 observations read from the data set WORK._KEEPDOCS.
NOTE: PROCEDURE TMUTIL used (Total process time):
      real time           0.40 seconds
      cpu time            0.04 seconds
 
 
 
NOTE: PROCEDURE TMUTIL used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: The data set WORK._TERMSTMUTIL has 16666 observations and 8 variables.
NOTE: The data set WORK._OUTTMUTIL_ has 205198 observations and 3 variables.
NOTE: PROCEDURE TMUTIL used (Total process time):
      real time           0.04 seconds
      cpu time            0.00 seconds
 
 
NOTE: Table WORK._DISTINCTTERMS created, with 13209 rows and 4 columns.
 
NOTE: Table WORK._NEWKEY created, with 16666 rows and 11 columns.
 
NOTE: Table WORK._WEIGHTS created, with 8502 rows and 2 columns.
 
NOTE: PROCEDURE SQL used (Total process time):
      real time           0.15 seconds
      cpu time            0.04 seconds
 
 
 
NOTE: There were 205198 observations read from the data set WORK._OUTTMUTIL_.
NOTE: The data set WORK._OUTTMUTIL_ has 205198 observations and 3 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.05 seconds
      cpu time            0.04 seconds
 
 
 
NOTE: P has been set to 50.
NOTE: Restart 1, Converged 42
NOTE: Restart 2, Converged 60
NOTE: Restart 3, Converged 75
NOTE: Restart 4, Converged 95
NOTE: Singular values have converged.  Creating data sets.
NOTE: Restarted 4 times.
NOTE: Using value of 100 for K.
NOTE: There were 205198 observations read from the data set WORK._OUTTMUTIL_.
NOTE: There were 8502 observations read from the data set WORK._WEIGHTS.
NOTE: The data set EMWS3.TEXTCLUSTER13_SVD_U has 8502 observations and 101 variables.
NOTE: The data set WORK._SVDV has 673 observations and 101 variables.
NOTE: The data set EMWS3.TEXTCLUSTER13_SVD_S has 100 observations and 2 variables.
NOTE: PROCEDURE SPSVD used (Total process time):
      real time           0.44 seconds
      cpu time            0.25 seconds
 
 
NOTE: PROCEDURE SQL used (Total process time):
      real time           0.00 seconds
      cpu time            0.01 seconds
 
 
 
NOTE: There were 8502 observations read from the data set EMWS3.TEXTCLUSTER13_SVD_U.
NOTE: The data set EMWS3.TEXTCLUSTER13_SVD_U has 8502 observations and 101 variables.
NOTE: DATA statement used (Total process time):
      real time           0.03 seconds
      cpu time            0.01 seconds
 
 
 
NOTE: There were 673 observations read from the data set WORK._SVDV.
NOTE: The data set WORK._SVDV has 673 observations and 101 variables.
NOTE: DATA statement used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
 
 
NOTE: Table WORK.NEW_GLOBAL created, with 8502 rows and 2 columns.
 
NOTE: PROCEDURE SQL used (Total process time):
      real time           0.02 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 205198 observations read from the data set WORK._OUTTMUTIL_.
NOTE: The data set WORK._OUTTMUTIL_ has 205198 observations and 3 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.05 seconds
      cpu time            0.01 seconds
 
 
 
NOTE: There were 205198 observations read from the data set WORK._OUTTMUTIL_.
NOTE: There were 8502 observations read from the data set EMWS3.TEXTCLUSTER13_SVD_U.
NOTE: There were 8502 observations read from the data set WORK.NEW_GLOBAL.
NOTE: The data set WORK._SVDCOLPRO has 673 observations and 101 variables.
NOTE: PROCEDURE SPSVD used (Total process time):
      real time           0.19 seconds
      cpu time            0.07 seconds
 
 
 
NOTE: There were 674 observations read from the data set WORK._KEEPDOCS.
NOTE: The data set WORK._DOCIDS has 674 observations and 1 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 673 observations read from the data set WORK._SVDCOLPRO.
NOTE: There were 674 observations read from the data set WORK._DOCIDS.
NOTE: The data set WORK._SVDCOLPRO has 674 observations and 101 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 674 observations read from the data set WORK._SVDCOLPRO.
NOTE: The data set WORK._SVDCOLPRO has 674 observations and 101 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.01 seconds
 
 
 
NOTE: There were 205198 observations read from the data set WORK._OUTTMUTIL_.
NOTE: The data set WORK._OUTTMUTIL_ has 205198 observations and 3 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.05 seconds
      cpu time            0.01 seconds
 
 
NOTE: Table WORK.NEW_GLOBAL created, with 8502 rows and 2 columns.
 
NOTE: PROCEDURE SQL used (Total process time):
      real time           0.01 seconds
      cpu time            0.01 seconds
 
 
 
NOTE: There were 205198 observations read from the data set WORK._OUTTMUTIL_.
NOTE: There were 673 observations read from the data set WORK._SVDV.
NOTE: There were 8502 observations read from the data set WORK.NEW_GLOBAL.
NOTE: The data set WORK._SVDROWPRO has 8502 observations and 101 variables.
NOTE: PROCEDURE SPSVD used (Total process time):
      real time           0.14 seconds
      cpu time            0.07 seconds
 
 
NOTE: Table EMWS3.TEXTCLUSTER13_TERMS created, with 16666 rows and 113 columns.
 
NOTE: PROCEDURE SQL used (Total process time):
      real time           0.18 seconds
      cpu time            0.07 seconds
 
 
NOTE: %INCLUDE (level 1) file TEMP is file SASHELP.EMTEXT.TMGETNCL.SOURCE.
16792 +
16793 + /*
16794 +  Macro:   tmgetncl.sas
16795 +  Purpose: To obtain a default number of clusters
16796 +  Syntax:  %tmgetncl(data=, maxclusters=, vars=);
16797 +
16798 +  Required Parameters:  data=      The input data set.
16799 +
16800 +  Optional Parameters:  vars=      Variables to be used
16801 +
16802 +  History:
16803 +  2001/01/23 - Bill Wheeler - Initial Coding.
16804 +
16805 +*/
16806 + %MACRO tmgetncl(data=, maxclusters=, vars=, tempDS=,
16807 +                 clusDS=, threads=THREADS);
16808 +
16809 +  %if &maxclusters= %then %let maxclusters = 40;
16810 +
16811 +  %if &vars ^= %then %let var = var &vars;
16812 +  %else %let var = ;
16813 +
16814 +  /* run PROC FASTCLUS with maxClusters clusters */
16815 +  proc fastclus data = &data noprint
16816 +    maxclusters = &maxclusters
16817 +    mean = &tempDS;
16818 +    &var
16819 +    ;
16820 +    run;
16821 +
16822 +  /* use PROC CLUSTER with the MEAN data set from FASTCLUS */
16823 +  proc cluster data = &tempDS
16824 +    method = WARD
16825 +    pseudo
16826 +    noprint
16827 +    outtree = &tempDS;
16828 +    &var;
16829 +  run;
16830 +
16831 +  %if (&SYSERR > 4) %then %do;
16832 +    data &clusDS; nclus = 0; run;
16833 +    %goto exit;
16834 +  %end;
16835 +
16836 +  /* sort and get rid of missing values in the outtree data set */
16837 +  %tmsort(data=&tempDS(where=(_ccc_ > -99999.0) keep = _ncl_ _ccc_),
16838 +        out=&tempDS, by=_ncl_, options=, threads=&threads);
16839 +
16840 +  data &clusDS; set &tempDS;
16841 +    keep nclus;
16842 +    retain loclclus -1 loclccc 0 maxccc 0 maxclus 0
16843 +   jclus -1 maxjump -1 nclus 0 jccc 0 prevjump 0 jump 0 occc 0 oncl 0;
16844 +
16845 +   if _N_ = 1 then do;
16846 +     maxccc = _ccc_;
16847 +     maxclus = _ncl_;
16848 +     nclus = _ncl_;
16849 +     occc = _ccc_;
16850 +     oncl = _ncl_;
16851 +   end;
16852 +   else if (_N_ = 2) then do;
16853 +     jump = _ccc_ - occc;
16854 +     if (jump > 0) then do;
16855 +       maxjump = jump;
16856 +       jclus = _ncl_;
16857 +     end;
16858 +     if (_ccc_ > maxccc) then do;
16859 +       maxccc = _ccc_;
16860 +       maxclus = _ncl_;
16861 +     end;
16862 +     occc = _ccc_;
16863 +     oncl = _ncl_;
16864 +   end;
16865 +
16866 +   else if (_N_ > 2) then do;
16867 +     prevjump = jump;
16868 +     jump = _ccc_ - occc;
16869 +
16870 +     if ((prevjump > 0) & (jump < 0) & (loclclus < 0)) then do;
16871 +        loclclus = oncl;
16872 +        loclccc = occc;
16873 +     end;
16874 +     if (_ccc_ > maxccc) then do;
16875 +       maxccc = _ccc_;
16876 +       maxclus = _ncl_;
16877 +     end;
16878 +     if ((jump > 0) & (jump > maxjump)) then do;
16879 +       jclus = _ncl_;
16880 +       maxjump = jump;
16881 +       jccc = _ccc_;
16882 +     end;
16883 +
16884 +     occc = _ccc_;
16885 +     oncl = _ncl_;
16886 +
16887 +     if ((loclclus > 0) & (jclus > 0)) then nclus = MIN(loclclus, jclus);
16888 +     else if (loclclus > 0) then nclus = loclclus;
16889 +     else if (jclus > 0) then nclus = jclus;
16890 +     else nclus = maxclus;
16891 +   end;
16892 +  run;
16893 +
16894 +  %exit: ;
16895 +
16896 +%MEND tmgetncl;
NOTE: %INCLUDE (level 1) ending.
NOTE: %INCLUDE (level 1) file TEMP is file SASHELP.EMTEXT.TMFAST.SOURCE.
16897 + /*
16898 +
16899 +  Macro:   tmfast.sas
16900 +  Purpose: Call proc fastclus with given defaults and parameters.
16901 +  Syntax:  %tmfast(data=, clusters=, outstat=, vars=);
16902 +
16903 +  Required Parameters:  data=      The input data set.
16904 +                        clusters=  The maximum number of clusters
16905 +
16906 +  Optional Parameters:  vars=      Variables to be used
16907 +                        outstat=   The name of the OUTSTAT data set
16908 +                        outseed=   The name of the OUTSEED data set
16909 +
16910 +  Either outstat or outseed mut be given, but not both.
16911 +  History:
16912 +  2001/01/16 - Bill Wheeler - Initial Coding.
16913 +
16914 +*/
16915 +%MACRO tmfast(data=, clusters=, outstat=, outseed=,
16916 +                 id=, out=, vars=);
16917 + /* defaults */
16918 + %if (&id ne ) %then %let id = id &id;
16919 + %if (&out ne ) %then %let out = out = &out;
16920 + %if (&vars ne ) %then %let var = var &vars;
16921 + %else %let var = ;
16922 +
16923 + %if &outseed= %then
16924 + %do;
16925 +   proc fastclus data = &data
16926 +   maxclusters = &clusters noprint
16927 +   outstat = &outstat &out;
16928 +   &var;
16929 +   &id;
16930 + %end;
16931 + %else
16932 + %do;
16933 +   proc fastclus data = &data
16934 +   maxclusters = &clusters noprint
16935 +   outseed = &outseed &out;
16936 +   &var;
16937 +   &id;
16938 + %end;
16939 +%MEND tmfast;
NOTE: %INCLUDE (level 1) ending.
NOTE: %INCLUDE (level 1) file TEMP is file SASHELP.EMTEXT.TMEMCLUS.SOURCE.
16940 +
16941 + /*
16942 +
16943 +  Macro:   tmemclus.sas
16944 +  Purpose: Call proc emclus with given defaults and parameters.
16945 +  Syntax:  %tmemclus(data=, role=, clusters=, seed=,
16946 +                   outstat=, out=, vars=, cov=, iter=, secclus=,
16947 +                   seciter=, min=, method=, eps=, init=, print=,
16948 +                   p=, outliers=, decvar=, initstd=, dist=,
16949 +                   secstd=, nobs=, threads=);
16950 +  Required Parameters:  data=      The input data set.
16951 +                        role=      Train or score
16952 +                        clusters=  The number of primary clusters
16953 +
16954 +  Optional Parameters:  vars=      Variables to be used
16955 +                   cov=       Type of covariance matrix
16956 +                   iter=      Number of EM iterations
16957 +                   secclus    Number of secondary clusters
16958 +                   seciter    Number of k-means iterations
16959 +                   min=       Minimum number of obs in a cluster
16960 +                   method=    Standard or scaled
16961 +                   eps=       Stopping tolerance
16962 +                   init=      Random, Fastclus, or Emclus
16963 +                   print=     All, last, or none
16964 +                   p=
16965 +                   outliers=  Keep, cluster, or ignore
16966 +                   outstat=   Name of OUTSTAT data set
16967 +                   out=       Name of OUT data set
16968 +                   seed=      Name of SEED data set
16969 +                   decvar=    Proportion to decrease variances
16970 +                   initstd=   Initial standard deviation
16971 +                   dist=      Minimum distance between clusters
16972 +                   secstd=    Secondary cluster max std dev.
16973 +                   nobs=      Number of obs read in each iteration
16974 +  History:
16975 +  2001/01/16 - Bill Wheeler - Initial Coding.
16976 +  2001/11/29 - Bill Wheeler - Updated for version 8 or 9
16977 +*/
16978 +%MACRO tmemclus(data=, role=, clusters=, seed=,
16979 + outstat=, out=, vars=, cov=, iter=, secclus=,
16980 + seciter=, min=, method=, eps=, init=, print=,
16981 + p=, outliers=, decvar=, initstd=, dist=, secstd=, nobs=, threads=);
16982 +
16983 + %local saveout saveseed op1 op2 op3 op4;
16984 +
16985 + %LET saveout = &out;
16986 + %LET saveseed = &outstat;
16987 +
16988 + /* defaults */
16989 + %if &role= %then %let role = TRAIN;
16990 + %if &seed ne %then %let seed = seed=&seed;
16991 + %if &vars= %then %let var = ;
16992 + %else %let var = var &vars;
16993 + %if &cov ne %then %let cov = cov = &cov;
16994 + %if &iter ne %then %let iter = iter = &iter;
16995 + %if &init ne %then %let init = init = &init;
16996 + %if &eps ne  %then %let eps = eps = &eps;
16997 + %if &min ne %then %let min = min = &min;
16998 + %if &seciter ne %then %let seciter = seciter = &seciter;
16999 + %if &print ne %then %let print = print = &print;
17000 + %if &p ne %then %let p = p = &p;
17001 + %if &outliers ne %then %let outliers = outliers = &outliers;
17002 + %if &method ne %then %let method = method = &method;
17003 + %if &decvar ne %then %let decvar = decvar = &decvar;
17004 + %if &outstat ne %then %let outstat = outstat = &outstat;
17005 + %if &out ne %then %let out = out = &out;
17006 + %if (&threads >= 0)  %then %let threads = threads = &threads;
17007 + %else %let threads = ;
17008 +
17009 + %LET op1 = ;
17010 + %LET op2 = ;
17011 + %LET op3 = ;
17012 + %LET op4 = ;
17013 + %if ^(&initstd=) %then %let op1 = %str(initstd = &initstd);
17014 + %if ^(&dist=) %then %let op2 = %str(dist = &dist);
17015 + %if ^(&secstd=) %then %let op3 = %str(secstd = &secstd);
17016 + %if ^(&nobs=) %then %let op4 = %str(nobs = &nobs);
17017 +
17018 +
17019 + %IF &SYSVER < 9 %THEN %DO;
17020 +    %LET cov = ;
17021 +    %LET decvar = ;
17022 +    %LET outliers = ;
17023 +    %LET out = ;
17024 + %END;
17025 +
17026 +
17027 + %if %upcase(&role) = TRAIN %then
17028 + %do;
17029 +   proc emclus data = &data
17030 +   clusters = &clusters
17031 +   &seed
17032 +   &outstat
17033 +   &out
17034 +   &init
17035 +   &eps
17036 +   &method
17037 +   &secclus
17038 +   &min
17039 +   &print
17040 +   &outliers
17041 +   &iter
17042 +   &op1 &op2
17043 +   &op3 &op4
17044 +   &decvar
17045 +   &cov
17046 +   &threads
17047 +   ;
17048 +   &var;
17049 + %end;
17050 + %else
17051 +  %do;
17052 +    proc emclus data = &data
17053 +    role = score
17054 +    clusters = &clusters
17055 +    &seed
17056 +    &out
17057 +    &cov
17058 +    ;
17059 +    &var;
17060 +  %end;
17061 +
17062 + %IF &SYSVER < 9 and &saveout ^= %THEN %DO;
17063 +   proc emclus data = &data
17064 +   role = score
17065 +   clusters = &clusters
17066 +   seed = &saveseed
17067 +   &saveout
17068 +   ;
17069 +   &var;
17070 + %END;
17071 +
17072 +
17073 +%MEND tmemclus;
NOTE: %INCLUDE (level 1) ending.
NOTE: %INCLUDE (level 1) file TEMP is file SASHELP.EMTEXT.TMPRED.SOURCE.
17074 +
17075 +/*
17076 +  Macro: tmpred(inds,outds,clusters,type=,ignore=,freqDS=)
17077 +
17078 +  Description: This macro will take output from
17079 +     emclus and generate predicted
17080 +      predicted clusters.
17081 +
17082 +  Parms: inds - input data set, produced by emclus.
17083 +   outds - data set with clusters created by this macro.
17084 +   clusters - number of clusters that should be on this data set
17085 +   type - valid values: 'max' or 'prob'.  Max will just take the
17086 +      cluster with the highest probability as the predicted cluster.
17087 +      In the case of a tie the first cluster with that value will
17088 +       selected.
17089 +      Prob will attempt to select multiple clusters based on
17090 +      how many clusters were requested.  That is if 3 clusters
17091 +      were requested, any cluster with prob>1/3 will be selected
17092 +      as the predicted cluster. THIS OPTION IS UNTESTED.
17093 +*/
17094 +
17095 +%macro tmpred(inds,outds,clusters,type=, ignore=0, freqDS=, compress=1);
17096 +
17097 +  %local _str newfreqDS _flag;
17098 +
17099 +  * set the optional arguments;
17100 +  %if &type= %then %let type=max;
17101 +  %if &ignore = 1 %then %let
17102 +    _str = if _CLUSTER_ = &clusters then _CLUSTER_ = .;
17103 +  %else %let _str = ;
17104 +  %if %str(&freqDS) ^= %str() %then %do;
17105 +   %let newfreqDS = &freqDS(keep=_c1-_c&clusters);
17106 +   %let _flag = 1;
17107 +  %end;
17108 +  %else %let _flag = 0;
17109 +
17110 +  %if &compress = 1 %then %let compress = compress=Y;
17111 +  %else %let compress = ;
17112 +
17113 +  data &outds(&compress drop=_c1-_c&clusters)
17114 +    %if &_flag = 1 %then %do;
17115 +    &newfreqDS
17116 +    %end;
17117 +    ;
17118 +    set &inds end=eof;
17119 +   * array for holding all probabilities;
17120 +    array _p prob1--prob&clusters;
17121 +    array _c(&clusters);
17122 +    retain _c 0;
17123 +   * get rid of working columns;
17124 +    drop _max_ _i /*prob1--prob&clusters*/ _WARN_;
17125 +    /* keep the largest probability and the cluster */
17126 +    _max_ = 0;
17127 +    do _i = 1 to &clusters;
17128 +      if _p(_i) > _max_ then do;
17129 +        _max_ = _p(_i);
17130 +        _CLUSTER_ = _i;
17131 +      end;
17132 +    end;
17133 +    if (_CLUSTER_ >= 1) and (_CLUSTER_ <= &clusters) then
17134 +      _c(_CLUSTER_) = _c(_CLUSTER_) + 1;
17135 +    else _CLUSTER_ = .;
17136 +    &_str;
17137 +    %if &_flag = 1 %then %do;
17138 +      if eof then do;
17139 +        output &freqDS;
17140 +                output &outDS;
17141 +          end;
17142 +          else output &outDS;
17143 +        %end;
17144 +
17145 +    run;
17146 +%mend tmpred;
NOTE: %INCLUDE (level 1) ending.
NOTE: %INCLUDE (level 1) file TEMP is file SASHELP.EMTEXT.TMSORT.SOURCE.
17147 + /*
17148 +PROC SORT macro
17149 +
17150 +%tmsort(data=, out=, by=);
17151 +
17152 +data=      - name of input data set (outtree data set from PROC CLUSTER)
17153 +out=       - name of the output data set
17154 +by=        - by statement
17155 +options=   - proc options
17156 +*/
17157 +
17158 +%macro tmsort(data=, out=, by=, options=, threads=THREADS);
17159 +  %if %BQUOTE(&out) ^= %then %let out = out =  &out;
17160 +  %if &SYSVER < 9 %then %let threads = ;
17161 +
17162 +  proc sort data = %STR(&data) &threads &options
17163 +    &out;
17164 +    by &by;
17165 +  run;
17166 +
17167 +%mend tmsort;
NOTE: %INCLUDE (level 1) ending.
NOTE: PROCEDURE SQL used (Total process time):
      real time           0.04 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: The data set WORK._CLUSTEMP1 has 12 observations and 107 variables.
NOTE: PROCEDURE FASTCLUS used (Total process time):
      real time           0.02 seconds
      cpu time            0.01 seconds
 
 
 
NOTE: The data set WORK._CLUSTEMP1 has 23 observations and 116 variables.
NOTE: PROCEDURE CLUSTER used (Total process time):
      real time           0.01 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 11 observations read from the data set WORK._CLUSTEMP1.
      WHERE _ccc_>-99999;
NOTE: The data set WORK._CLUSTEMP1 has 11 observations and 2 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.01 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 11 observations read from the data set WORK._CLUSTEMP1.
NOTE: The data set WORK._CLUSTEMP has 11 observations and 1 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.00 seconds
 
 
NOTE: PROCEDURE SQL used (Total process time):
      real time           0.01 seconds
      cpu time            0.01 seconds
 
 
NOTE: PROCEDURE SQL used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: The data set WORK._FASTCLUSSTAT has 50 observations and 103 variables.
NOTE: PROCEDURE FASTCLUS used (Total process time):
      real time           0.01 seconds
      cpu time            0.00 seconds
 
 
NOTE: PROCEDURE SQL used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: The standard EM algorithm will be run.
NOTE: DIST is set to 0.0890257276
NOTE: EPS is set to 0.1
NOTE: INITSTD is set to 21.511287227
NOTE: ITER is set to 5
NOTE: MAXTIME is set to 2147483647
WARNING: The maximum number of 5 iterations in the EM algorithm has been reached. Parameter estimates may not be accurate.
NOTE: There were 674 observations read from the data set WORK._SVDCOLPRO.
NOTE: There were 50 observations read from the data set WORK._FASTCLUSSTAT.
NOTE: The data set EMWS3.TEXTCLUSTER13_EMOUTSTAT has 17 observations and 107 variables.
NOTE: The data set WORK._TMUTILDOC has 674 observations and 110 variables.
NOTE: PROCEDURE EMCLUS used (Total process time):
      real time           0.12 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 674 observations read from the data set WORK._TMUTILDOC.
NOTE: The data set EMWS3.TEXTCLUSTER13_DOCS has 674 observations and 110 variables.
NOTE: Compressing data set EMWS3.TEXTCLUSTER13_DOCS increased size by 10.00 percent.
      Compressed is 11 pages; un-compressed would require 10 pages.
NOTE: The data set WORK._CLUSSTAT has 1 observations and 8 variables.
NOTE: DATA statement used (Total process time):
      real time           0.03 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 674 observations read from the data set EMWS3.TEXTCLUSTER13_DOCS.
NOTE: The data set EMWS3.TEXTCLUSTER13_DOCS has 674 observations and 110 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: Numeric values have been converted to character values at the places given by: (Line):(Column).
      451:154
NOTE: There were 1 observations read from the data set WORK._CLUSSTAT.
NOTE: The data set WORK._CLUSSTAT has 8 observations and 11 variables.
NOTE: DATA statement used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 8 observations read from the data set WORK._CLUSSTAT.
NOTE: The data set WORK._CLUSSTAT has 8 observations and 12 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 17 observations read from the data set EMWS3.TEXTCLUSTER13_EMOUTSTAT.
NOTE: The data set WORK._CLUSTERMEAN has 8 observations and 101 variables.
NOTE: DATA statement used (Total process time):
      real time           0.00 seconds
      cpu time            0.01 seconds
 
 
NOTE: Table WORK._MEANDOCS created, with 674 rows and 210 columns.
 
NOTE: PROCEDURE SQL used (Total process time):
      real time           0.03 seconds
      cpu time            0.01 seconds
 
 
 
NOTE: There were 674 observations read from the data set WORK._MEANDOCS.
NOTE: There were 8 observations read from the data set WORK._CLUSSTAT.
NOTE: The data set WORK._RMSCALC has 674 observations and 222 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.01 seconds
 
 
 
NOTE: There were 674 observations read from the data set WORK._RMSCALC.
NOTE: The data set WORK._MEANERR has 8 observations and 5 variables.
NOTE: PROCEDURE SUMMARY used (Total process time):
      real time           0.02 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 8 observations read from the data set WORK._MEANERR.
NOTE: The data set WORK._RMSSE has 8 observations and 2 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.00 seconds
 
 
NOTE: Table WORK._CLUSSTAT2 created, with 8 rows and 102 columns.
 
NOTE: Table EMWS3.TEXTCLUSTER13_CLUSTERS created, with 8 rows and 104 columns.
 
NOTE: PROCEDURE SQL used (Total process time):
      real time           0.05 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: Input data set is already sorted; it has been copied to the output data set.
NOTE: There were 16666 observations read from the data set EMWS3.TEXTFILTER7_TERMS_DATA.
      WHERE KEEP='Y';
NOTE: There were 73331 observations read from the data set EMWS3.TEXTFILTER7_TERM_STRINGS.
NOTE: There were 16666 observations read from the data set EMWS3.TEXTFILTER7_TERMS.
NOTE: The data set WORK._TERMS_ has 16666 observations and 13 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.09 seconds
      cpu time            0.03 seconds
 
 
 
NOTE: There were 16666 observations read from the data set WORK._TERMS_.
NOTE: The data set WORK._TERMS_ has 13209 observations and 13 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 13209 observations read from the data set WORK._TERMS_.
NOTE: The data set WORK._TERMS_ has 13209 observations and 13 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 218546 observations read from the data set EMWS3.TEXTFILTER7_TMOUT.
NOTE: The data set WORK._TMOUT_ has 218546 observations and 3 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.05 seconds
      cpu time            0.01 seconds
 
 
 
NOTE: There were 218546 observations read from the data set WORK._TMOUT_.
NOTE: There were 13209 observations read from the data set WORK._TERMS_.
NOTE: The data set WORK._TMOUT_ has 218546 observations and 4 variables.
NOTE: DATA statement used (Total process time):
      real time           0.13 seconds
      cpu time            0.10 seconds
 
 
 
NOTE: There were 674 observations read from the data set EMWS3.TEXTCLUSTER13_DOCS.
NOTE: The data set WORK._DOCS_ has 674 observations and 3 variables.
NOTE: DATA statement used (Total process time):
      real time           0.00 seconds
      cpu time            0.01 seconds
 
 
NOTE: SQL view WORK._CMB has been defined.
NOTE: PROCEDURE SQL used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 218546 observations read from the data set WORK._TMOUT_.
NOTE: There were 674 observations read from the data set WORK._DOCS_.
NOTE: There were 218546 observations read from the data set WORK._CMB.
NOTE: The data set WORK._TFREQ has 42569 observations and 5 variables.
NOTE: PROCEDURE SUMMARY used (Total process time):
      real time           0.13 seconds
      cpu time            0.06 seconds
 
 
 
NOTE: There were 218546 observations read from the data set WORK._TMOUT_.
NOTE: There were 674 observations read from the data set WORK._DOCS_.
NOTE: There were 218546 observations read from the data set WORK._CMB.
NOTE: The data set WORK._SUM has 9 observations and 4 variables.
NOTE: PROCEDURE SUMMARY used (Total process time):
      real time           0.06 seconds
      cpu time            0.01 seconds
 
 
 
NOTE: There were 9 observations read from the data set WORK._SUM.
NOTE: DATA statement used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
 
 
NOTE: Table WORK._SUM has been dropped.
NOTE: PROCEDURE SQL used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 42569 observations read from the data set WORK._TFREQ.
NOTE: The data set WORK._TFREQ has 42569 observations and 5 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.04 seconds
      cpu time            0.01 seconds
 
 
 
NOTE: There were 42569 observations read from the data set WORK._TFREQ.
NOTE: The data set WORK._UNQT has 240 observations and 3 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 240 observations read from the data set WORK._UNQT.
NOTE: 126 observations with duplicate key values were deleted.
NOTE: The data set WORK._UNQT has 114 observations and 1 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.02 seconds
      cpu time            0.00 seconds
 
 
NOTE: Table WORK._CLCDF created, with 880 rows and 3 columns.
 
NOTE: PROCEDURE SQL used (Total process time):
      real time           0.03 seconds
      cpu time            0.04 seconds
 
 
NOTE: Table WORK._UNQT has been dropped.
NOTE: Table WORK._TFREQ has been dropped.
NOTE: PROCEDURE SQL used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 880 observations read from the data set WORK._CLCDF.
NOTE: The data set WORK._CLCDF has 114 observations and 10 variables.
NOTE: PROCEDURE TRANSPOSE used (Total process time):
      real time           0.02 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 114 observations read from the data set WORK._CLCDF.
NOTE: The data set WORK._CLCDF has 114 observations and 18 variables.
NOTE: DATA statement used (Total process time):
      real time           0.02 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 114 observations read from the data set WORK._CLCDF.
NOTE: The data set WORK._CLCDFTR has 880 observations and 4 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.00 seconds
 
 
NOTE: Table WORK._CLCDF has been dropped.
NOTE: PROCEDURE SQL used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 880 observations read from the data set WORK._CLCDFTR.
NOTE: The data set WORK._CLCDFTR has 880 observations and 4 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.01 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 880 observations read from the data set WORK._CLCDFTR.
NOTE: The data set WORK._DESC_ has 8 observations and 2 variables.
NOTE: DATA statement used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
 
 
NOTE: Table WORK._CLCDFTR has been dropped.
NOTE: View WORK._CMB has been dropped.
NOTE: PROCEDURE SQL used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 8 observations read from the data set EMWS3.TEXTCLUSTER13_CLUSTERS.
NOTE: The data set EMWS3.TEXTCLUSTER13_CLUSTERS has 8 observations and 104 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.01 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 8 observations read from the data set WORK._DESC_.
NOTE: The data set WORK._DESC_ has 8 observations and 2 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.01 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 8 observations read from the data set EMWS3.TEXTCLUSTER13_CLUSTERS.
NOTE: There were 8 observations read from the data set WORK._DESC_.
NOTE: The data set WORK._DESC_ has 8 observations and 105 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 8 observations read from the data set WORK._DESC_.
NOTE: The data set EMWS3.TEXTCLUSTER13_CLUSTERS has 8 observations and 105 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.01 seconds
      cpu time            0.00 seconds
 
 
NOTE: Fileref TEMP has been deassigned.
 
NOTE: Variable TARGET is uninitialized.
NOTE: The data set EMWS3.TEXTCLUSTER13_EMINFO has 4 observations and 3 variables.
NOTE: DATA statement used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
 
 
NOTE: PROCEDURE SQL used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 1 observations read from the data set EMWS3.TEXTCLUSTER13_TMCONFIG.
NOTE: The data set EMWS3.TEXTCLUSTER13_TMCONFIG has 1 observations and 34 variables.
NOTE: DATA statement used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: The data set WORK.EM_METACHANGE has 1 observations and 9 variables.
NOTE: DATA statement used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 1 observations read from the data set WORK.EM_METACHANGE.
NOTE: The data set WORK.EM_METACHANGE has 2 observations and 9 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 2 observations read from the data set WORK.EM_METACHANGE.
NOTE: The data set WORK.EM_METACHANGE has 3 observations and 9 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 3 observations read from the data set WORK.EM_METACHANGE.
NOTE: The data set WORK.EM_METACHANGE has 4 observations and 9 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 4 observations read from the data set WORK.EM_METACHANGE.
NOTE: The data set WORK.EM_METACHANGE has 5 observations and 9 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 5 observations read from the data set WORK.EM_METACHANGE.
NOTE: The data set WORK.EM_METACHANGE has 6 observations and 9 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 6 observations read from the data set WORK.EM_METACHANGE.
NOTE: The data set WORK.EM_METACHANGE has 7 observations and 9 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 7 observations read from the data set WORK.EM_METACHANGE.
NOTE: The data set WORK.EM_METACHANGE has 8 observations and 9 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 8 observations read from the data set WORK.EM_METACHANGE.
NOTE: The data set WORK.EM_METACHANGE has 9 observations and 9 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 9 observations read from the data set WORK.EM_METACHANGE.
NOTE: The data set WORK.EM_METACHANGE has 10 observations and 9 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 10 observations read from the data set WORK.EM_METACHANGE.
NOTE: The data set WORK.EM_METACHANGE has 11 observations and 9 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 11 observations read from the data set WORK.EM_METACHANGE.
NOTE: The data set WORK.EM_METACHANGE has 12 observations and 9 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 12 observations read from the data set WORK.EM_METACHANGE.
NOTE: The data set WORK.EM_METACHANGE has 13 observations and 9 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 13 observations read from the data set WORK.EM_METACHANGE.
NOTE: The data set WORK.EM_METACHANGE has 14 observations and 9 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.01 seconds
 
 
 
NOTE: There were 14 observations read from the data set WORK.EM_METACHANGE.
NOTE: The data set WORK.EM_METACHANGE has 15 observations and 9 variables.
NOTE: DATA statement used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 15 observations read from the data set WORK.EM_METACHANGE.
NOTE: The data set WORK.EM_METACHANGE has 16 observations and 9 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 16 observations read from the data set WORK.EM_METACHANGE.
NOTE: The data set WORK.EM_METACHANGE has 17 observations and 9 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 17 observations read from the data set WORK.EM_METACHANGE.
NOTE: The data set WORK.EM_METACHANGE has 18 observations and 9 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 18 observations read from the data set WORK.EM_METACHANGE.
NOTE: The data set WORK.EM_METACHANGE has 19 observations and 9 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.01 seconds
 
 
 
NOTE: There were 19 observations read from the data set WORK.EM_METACHANGE.
NOTE: The data set WORK.EM_METACHANGE has 20 observations and 9 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 20 observations read from the data set WORK.EM_METACHANGE.
NOTE: The data set WORK.EM_METACHANGE has 21 observations and 9 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 21 observations read from the data set WORK.EM_METACHANGE.
NOTE: The data set WORK.EM_METACHANGE has 22 observations and 9 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 22 observations read from the data set WORK.EM_METACHANGE.
NOTE: The data set WORK.EM_METACHANGE has 23 observations and 9 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 23 observations read from the data set WORK.EM_METACHANGE.
NOTE: The data set WORK.EM_METACHANGE has 24 observations and 9 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 24 observations read from the data set WORK.EM_METACHANGE.
NOTE: The data set WORK.EM_METACHANGE has 25 observations and 9 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.01 seconds
 
 
 
NOTE: There were 25 observations read from the data set WORK.EM_METACHANGE.
NOTE: The data set WORK.EM_METACHANGE has 26 observations and 9 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 26 observations read from the data set WORK.EM_METACHANGE.
NOTE: The data set WORK.EM_METACHANGE has 27 observations and 9 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 27 observations read from the data set WORK.EM_METACHANGE.
NOTE: The data set WORK.EM_METACHANGE has 28 observations and 9 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 28 observations read from the data set WORK.EM_METACHANGE.
NOTE: The data set WORK.EM_METACHANGE has 29 observations and 9 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 29 observations read from the data set WORK.EM_METACHANGE.
NOTE: The data set WORK.EM_METACHANGE has 30 observations and 9 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 30 observations read from the data set WORK.EM_METACHANGE.
NOTE: The data set WORK.EM_METACHANGE has 31 observations and 9 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 31 observations read from the data set WORK.EM_METACHANGE.
NOTE: The data set WORK.EM_METACHANGE has 32 observations and 9 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 32 observations read from the data set WORK.EM_METACHANGE.
NOTE: The data set WORK.EM_METACHANGE has 33 observations and 9 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 33 observations read from the data set WORK.EM_METACHANGE.
NOTE: The data set WORK.EM_METACHANGE has 34 observations and 9 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 34 observations read from the data set WORK.EM_METACHANGE.
NOTE: The data set WORK.EM_METACHANGE has 35 observations and 9 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.01 seconds
 
 
 
NOTE: There were 35 observations read from the data set WORK.EM_METACHANGE.
NOTE: The data set WORK.EM_METACHANGE has 36 observations and 9 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 36 observations read from the data set WORK.EM_METACHANGE.
NOTE: The data set WORK.EM_METACHANGE has 37 observations and 9 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 37 observations read from the data set WORK.EM_METACHANGE.
NOTE: The data set WORK.EM_METACHANGE has 38 observations and 9 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 38 observations read from the data set WORK.EM_METACHANGE.
NOTE: The data set WORK.EM_METACHANGE has 39 observations and 9 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 39 observations read from the data set WORK.EM_METACHANGE.
NOTE: The data set WORK.EM_METACHANGE has 40 observations and 9 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 40 observations read from the data set WORK.EM_METACHANGE.
NOTE: The data set WORK.EM_METACHANGE has 41 observations and 9 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 41 observations read from the data set WORK.EM_METACHANGE.
NOTE: The data set WORK.EM_METACHANGE has 42 observations and 9 variables.
NOTE: DATA statement used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 42 observations read from the data set WORK.EM_METACHANGE.
NOTE: The data set WORK.EM_METACHANGE has 43 observations and 9 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 43 observations read from the data set WORK.EM_METACHANGE.
NOTE: The data set WORK.EM_METACHANGE has 44 observations and 9 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 44 observations read from the data set WORK.EM_METACHANGE.
NOTE: The data set WORK.EM_METACHANGE has 45 observations and 9 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 45 observations read from the data set WORK.EM_METACHANGE.
NOTE: The data set WORK.EM_METACHANGE has 46 observations and 9 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.01 seconds
 
 
 
NOTE: There were 46 observations read from the data set WORK.EM_METACHANGE.
NOTE: The data set WORK.EM_METACHANGE has 47 observations and 9 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 47 observations read from the data set WORK.EM_METACHANGE.
NOTE: The data set WORK.EM_METACHANGE has 48 observations and 9 variables.
NOTE: DATA statement used (Total process time):
      real time           0.00 seconds
      cpu time            0.01 seconds
 
 
 
NOTE: There were 48 observations read from the data set WORK.EM_METACHANGE.
NOTE: The data set WORK.EM_METACHANGE has 49 observations and 9 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.01 seconds
 
 
 
NOTE: There were 49 observations read from the data set WORK.EM_METACHANGE.
NOTE: The data set WORK.EM_METACHANGE has 50 observations and 9 variables.
NOTE: DATA statement used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 50 observations read from the data set WORK.EM_METACHANGE.
NOTE: The data set WORK.EM_METACHANGE has 51 observations and 9 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 51 observations read from the data set WORK.EM_METACHANGE.
NOTE: The data set WORK.EM_METACHANGE has 52 observations and 9 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 52 observations read from the data set WORK.EM_METACHANGE.
NOTE: The data set WORK.EM_METACHANGE has 53 observations and 9 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 53 observations read from the data set WORK.EM_METACHANGE.
NOTE: The data set WORK.EM_METACHANGE has 54 observations and 9 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 54 observations read from the data set WORK.EM_METACHANGE.
NOTE: The data set WORK.EM_METACHANGE has 55 observations and 9 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.01 seconds
 
 
 
NOTE: There were 55 observations read from the data set WORK.EM_METACHANGE.
NOTE: The data set WORK.EM_METACHANGE has 56 observations and 9 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 56 observations read from the data set WORK.EM_METACHANGE.
NOTE: The data set WORK.EM_METACHANGE has 57 observations and 9 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 57 observations read from the data set WORK.EM_METACHANGE.
NOTE: The data set WORK.EM_METACHANGE has 58 observations and 9 variables.
NOTE: DATA statement used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 58 observations read from the data set WORK.EM_METACHANGE.
NOTE: The data set WORK.EM_METACHANGE has 59 observations and 9 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 59 observations read from the data set WORK.EM_METACHANGE.
NOTE: The data set WORK.EM_METACHANGE has 60 observations and 9 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 60 observations read from the data set WORK.EM_METACHANGE.
NOTE: The data set WORK.EM_METACHANGE has 61 observations and 9 variables.
NOTE: DATA statement used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 61 observations read from the data set WORK.EM_METACHANGE.
NOTE: The data set WORK.EM_METACHANGE has 62 observations and 9 variables.
NOTE: DATA statement used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 62 observations read from the data set WORK.EM_METACHANGE.
NOTE: The data set WORK.EM_METACHANGE has 63 observations and 9 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 63 observations read from the data set WORK.EM_METACHANGE.
NOTE: The data set WORK.EM_METACHANGE has 64 observations and 9 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 64 observations read from the data set WORK.EM_METACHANGE.
NOTE: The data set WORK.EM_METACHANGE has 65 observations and 9 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 65 observations read from the data set WORK.EM_METACHANGE.
NOTE: The data set WORK.EM_METACHANGE has 66 observations and 9 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 66 observations read from the data set WORK.EM_METACHANGE.
NOTE: The data set WORK.EM_METACHANGE has 67 observations and 9 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.01 seconds
 
 
 
NOTE: There were 67 observations read from the data set WORK.EM_METACHANGE.
NOTE: The data set WORK.EM_METACHANGE has 68 observations and 9 variables.
NOTE: DATA statement used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 68 observations read from the data set WORK.EM_METACHANGE.
NOTE: The data set WORK.EM_METACHANGE has 69 observations and 9 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.01 seconds
 
 
 
NOTE: There were 69 observations read from the data set WORK.EM_METACHANGE.
NOTE: The data set WORK.EM_METACHANGE has 70 observations and 9 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 70 observations read from the data set WORK.EM_METACHANGE.
NOTE: The data set WORK.EM_METACHANGE has 71 observations and 9 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 71 observations read from the data set WORK.EM_METACHANGE.
NOTE: The data set WORK.EM_METACHANGE has 72 observations and 9 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 72 observations read from the data set WORK.EM_METACHANGE.
NOTE: The data set WORK.EM_METACHANGE has 73 observations and 9 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 73 observations read from the data set WORK.EM_METACHANGE.
NOTE: The data set WORK.EM_METACHANGE has 74 observations and 9 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 74 observations read from the data set WORK.EM_METACHANGE.
NOTE: The data set WORK.EM_METACHANGE has 75 observations and 9 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 75 observations read from the data set WORK.EM_METACHANGE.
NOTE: The data set WORK.EM_METACHANGE has 76 observations and 9 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 76 observations read from the data set WORK.EM_METACHANGE.
NOTE: The data set WORK.EM_METACHANGE has 77 observations and 9 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 77 observations read from the data set WORK.EM_METACHANGE.
NOTE: The data set WORK.EM_METACHANGE has 78 observations and 9 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.01 seconds
 
 
 
NOTE: There were 78 observations read from the data set WORK.EM_METACHANGE.
NOTE: The data set WORK.EM_METACHANGE has 79 observations and 9 variables.
NOTE: DATA statement used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 79 observations read from the data set WORK.EM_METACHANGE.
NOTE: The data set WORK.EM_METACHANGE has 80 observations and 9 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 80 observations read from the data set WORK.EM_METACHANGE.
NOTE: The data set WORK.EM_METACHANGE has 81 observations and 9 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 81 observations read from the data set WORK.EM_METACHANGE.
NOTE: The data set WORK.EM_METACHANGE has 82 observations and 9 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 82 observations read from the data set WORK.EM_METACHANGE.
NOTE: The data set WORK.EM_METACHANGE has 83 observations and 9 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 83 observations read from the data set WORK.EM_METACHANGE.
NOTE: The data set WORK.EM_METACHANGE has 84 observations and 9 variables.
NOTE: DATA statement used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 84 observations read from the data set WORK.EM_METACHANGE.
NOTE: The data set WORK.EM_METACHANGE has 85 observations and 9 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 85 observations read from the data set WORK.EM_METACHANGE.
NOTE: The data set WORK.EM_METACHANGE has 86 observations and 9 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 86 observations read from the data set WORK.EM_METACHANGE.
NOTE: The data set WORK.EM_METACHANGE has 87 observations and 9 variables.
NOTE: DATA statement used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 87 observations read from the data set WORK.EM_METACHANGE.
NOTE: The data set WORK.EM_METACHANGE has 88 observations and 9 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 88 observations read from the data set WORK.EM_METACHANGE.
NOTE: The data set WORK.EM_METACHANGE has 89 observations and 9 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.01 seconds
 
 
 
NOTE: There were 89 observations read from the data set WORK.EM_METACHANGE.
NOTE: The data set WORK.EM_METACHANGE has 90 observations and 9 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.03 seconds
 
 
 
NOTE: There were 90 observations read from the data set WORK.EM_METACHANGE.
NOTE: The data set WORK.EM_METACHANGE has 91 observations and 9 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 91 observations read from the data set WORK.EM_METACHANGE.
NOTE: The data set WORK.EM_METACHANGE has 92 observations and 9 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 92 observations read from the data set WORK.EM_METACHANGE.
NOTE: The data set WORK.EM_METACHANGE has 93 observations and 9 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 93 observations read from the data set WORK.EM_METACHANGE.
NOTE: The data set WORK.EM_METACHANGE has 94 observations and 9 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 94 observations read from the data set WORK.EM_METACHANGE.
NOTE: The data set WORK.EM_METACHANGE has 95 observations and 9 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 95 observations read from the data set WORK.EM_METACHANGE.
NOTE: The data set WORK.EM_METACHANGE has 96 observations and 9 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 96 observations read from the data set WORK.EM_METACHANGE.
NOTE: The data set WORK.EM_METACHANGE has 97 observations and 9 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 97 observations read from the data set WORK.EM_METACHANGE.
NOTE: The data set WORK.EM_METACHANGE has 98 observations and 9 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 98 observations read from the data set WORK.EM_METACHANGE.
NOTE: The data set WORK.EM_METACHANGE has 99 observations and 9 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 99 observations read from the data set WORK.EM_METACHANGE.
NOTE: The data set WORK.EM_METACHANGE has 100 observations and 9 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 100 observations read from the data set WORK.EM_METACHANGE.
NOTE: The data set WORK.EM_METACHANGE has 101 observations and 9 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.01 seconds
 
 
 
NOTE: There were 101 observations read from the data set WORK.EM_METACHANGE.
NOTE: The data set WORK.EM_METACHANGE has 102 observations and 9 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.01 seconds
 
 
 
NOTE: There were 102 observations read from the data set WORK.EM_METACHANGE.
NOTE: The data set WORK.EM_METACHANGE has 103 observations and 9 variables.
NOTE: DATA statement used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 103 observations read from the data set WORK.EM_METACHANGE.
NOTE: The data set WORK.EM_METACHANGE has 104 observations and 9 variables.
NOTE: DATA statement used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 104 observations read from the data set WORK.EM_METACHANGE.
NOTE: The data set WORK.EM_METACHANGE has 105 observations and 9 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 105 observations read from the data set WORK.EM_METACHANGE.
NOTE: The data set WORK.EM_METACHANGE has 106 observations and 9 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 106 observations read from the data set WORK.EM_METACHANGE.
NOTE: The data set WORK.EM_METACHANGE has 107 observations and 9 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 107 observations read from the data set WORK.EM_METACHANGE.
NOTE: The data set WORK.EM_METACHANGE has 108 observations and 9 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 108 observations read from the data set WORK.EM_METACHANGE.
NOTE: The data set WORK.EM_METACHANGE has 109 observations and 9 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.00 seconds
 
 
WARNING: No logical assign for filename TEMP.
17504  *------------------------------------------------------------*;
17505  * End TRAIN: TextCluster13;
17506  *------------------------------------------------------------*;
 
17507  *------------------------------------------------------------*;
17508  * Close any missing semi colons;
17509  *------------------------------------------------------------*;
17510  ;
17511  ;
17512  ;
17513  ;
17514  quit;
17515  *------------------------------------------------------------*;
17516  * Close any unbalanced quotes;
17517  *------------------------------------------------------------*;
17518  /*; *"; *'; */
17519  ;
17520  run;
17521  quit;
17522  /* Reset EM Options */
17523  options formchar="|----|+|---+=|-/\<>*";
17524  options nocenter ls=256 ps=10000;
17525  goptions reset=all device=GIF NODISPLAY;
 
17526  proc sort data=WORK.EM_METACHANGE;
17527  by key uname;
17528  run;
 
NOTE: There were 109 observations read from the data set WORK.EM_METACHANGE.
NOTE: The data set WORK.EM_METACHANGE has 109 observations and 9 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
 
 
17529  filename x "C:\Users\lahar\OneDrive\Desktop\Data Mining\Resume\Workspaces\EMWS3\TextCluster13\CDELTA_TRAIN.sas";
17530  data _null_;
17531  file x;
17532  put 'if upcase(NAME) = "TEXTCLUSTER13_CLUSTER_" then do;';
17533  put 'ROLE = "SEGMENT";';
17534  put 'LEVEL = "NOMINAL";';
17535  put 'end;';
17536  put 'else ';
17537  put 'if upcase(NAME) = "TEXTCLUSTER13_PROB1" then do;';
17538  put 'ROLE = "REJECTED";';
17539  put 'end;';
17540  put 'else ';
17541  put 'if upcase(NAME) = "TEXTCLUSTER13_PROB2" then do;';
17542  put 'ROLE = "REJECTED";';
17543  put 'end;';
17544  put 'else ';
17545  put 'if upcase(NAME) = "TEXTCLUSTER13_PROB3" then do;';
17546  put 'ROLE = "REJECTED";';
17547  put 'end;';
17548  put 'else ';
17549  put 'if upcase(NAME) = "TEXTCLUSTER13_PROB4" then do;';
17550  put 'ROLE = "REJECTED";';
17551  put 'end;';
17552  put 'else ';
17553  put 'if upcase(NAME) = "TEXTCLUSTER13_PROB5" then do;';
17554  put 'ROLE = "REJECTED";';
17555  put 'end;';
17556  put 'else ';
17557  put 'if upcase(NAME) = "TEXTCLUSTER13_PROB6" then do;';
17558  put 'ROLE = "REJECTED";';
17559  put 'end;';
17560  put 'else ';
17561  put 'if upcase(NAME) = "TEXTCLUSTER13_PROB7" then do;';
17562  put 'ROLE = "REJECTED";';
17563  put 'end;';
17564  put 'else ';
17565  put 'if upcase(NAME) = "TEXTCLUSTER13_PROB8" then do;';
17566  put 'ROLE = "REJECTED";';
17567  put 'end;';
17568  put 'else ';
17569  put 'if upcase(NAME) = "TEXTCLUSTER13_SVD1" then do;';
17570  put 'ROLE = "INPUT";';
17571  put 'LEVEL = "INTERVAL";';
17572  put 'end;';
17573  put 'else ';
17574  put 'if upcase(NAME) = "TEXTCLUSTER13_SVD10" then do;';
17575  put 'ROLE = "INPUT";';
17576  put 'LEVEL = "INTERVAL";';
17577  put 'end;';
17578  put 'else ';
17579  put 'if upcase(NAME) = "TEXTCLUSTER13_SVD100" then do;';
17580  put 'ROLE = "INPUT";';
17581  put 'LEVEL = "INTERVAL";';
17582  put 'end;';
17583  put 'else ';
17584  put 'if upcase(NAME) = "TEXTCLUSTER13_SVD11" then do;';
17585  put 'ROLE = "INPUT";';
17586  put 'LEVEL = "INTERVAL";';
17587  put 'end;';
17588  put 'else ';
17589  put 'if upcase(NAME) = "TEXTCLUSTER13_SVD12" then do;';
17590  put 'ROLE = "INPUT";';
17591  put 'LEVEL = "INTERVAL";';
17592  put 'end;';
17593  put 'else ';
17594  put 'if upcase(NAME) = "TEXTCLUSTER13_SVD13" then do;';
17595  put 'ROLE = "INPUT";';
17596  put 'LEVEL = "INTERVAL";';
17597  put 'end;';
17598  put 'else ';
17599  put 'if upcase(NAME) = "TEXTCLUSTER13_SVD14" then do;';
17600  put 'ROLE = "INPUT";';
17601  put 'LEVEL = "INTERVAL";';
17602  put 'end;';
17603  put 'else ';
17604  put 'if upcase(NAME) = "TEXTCLUSTER13_SVD15" then do;';
17605  put 'ROLE = "INPUT";';
17606  put 'LEVEL = "INTERVAL";';
17607  put 'end;';
17608  put 'else ';
17609  put 'if upcase(NAME) = "TEXTCLUSTER13_SVD16" then do;';
17610  put 'ROLE = "INPUT";';
17611  put 'LEVEL = "INTERVAL";';
17612  put 'end;';
17613  put 'else ';
17614  put 'if upcase(NAME) = "TEXTCLUSTER13_SVD17" then do;';
17615  put 'ROLE = "INPUT";';
17616  put 'LEVEL = "INTERVAL";';
17617  put 'end;';
17618  put 'else ';
17619  put 'if upcase(NAME) = "TEXTCLUSTER13_SVD18" then do;';
17620  put 'ROLE = "INPUT";';
17621  put 'LEVEL = "INTERVAL";';
17622  put 'end;';
17623  put 'else ';
17624  put 'if upcase(NAME) = "TEXTCLUSTER13_SVD19" then do;';
17625  put 'ROLE = "INPUT";';
17626  put 'LEVEL = "INTERVAL";';
17627  put 'end;';
17628  put 'else ';
17629  put 'if upcase(NAME) = "TEXTCLUSTER13_SVD2" then do;';
17630  put 'ROLE = "INPUT";';
17631  put 'LEVEL = "INTERVAL";';
17632  put 'end;';
17633  put 'else ';
17634  put 'if upcase(NAME) = "TEXTCLUSTER13_SVD20" then do;';
17635  put 'ROLE = "INPUT";';
17636  put 'LEVEL = "INTERVAL";';
17637  put 'end;';
17638  put 'else ';
17639  put 'if upcase(NAME) = "TEXTCLUSTER13_SVD21" then do;';
17640  put 'ROLE = "INPUT";';
17641  put 'LEVEL = "INTERVAL";';
17642  put 'end;';
17643  put 'else ';
17644  put 'if upcase(NAME) = "TEXTCLUSTER13_SVD22" then do;';
17645  put 'ROLE = "INPUT";';
17646  put 'LEVEL = "INTERVAL";';
17647  put 'end;';
17648  put 'else ';
17649  put 'if upcase(NAME) = "TEXTCLUSTER13_SVD23" then do;';
17650  put 'ROLE = "INPUT";';
17651  put 'LEVEL = "INTERVAL";';
17652  put 'end;';
17653  put 'else ';
17654  put 'if upcase(NAME) = "TEXTCLUSTER13_SVD24" then do;';
17655  put 'ROLE = "INPUT";';
17656  put 'LEVEL = "INTERVAL";';
17657  put 'end;';
17658  put 'else ';
17659  put 'if upcase(NAME) = "TEXTCLUSTER13_SVD25" then do;';
17660  put 'ROLE = "INPUT";';
17661  put 'LEVEL = "INTERVAL";';
17662  put 'end;';
17663  put 'else ';
17664  put 'if upcase(NAME) = "TEXTCLUSTER13_SVD26" then do;';
17665  put 'ROLE = "INPUT";';
17666  put 'LEVEL = "INTERVAL";';
17667  put 'end;';
17668  put 'else ';
17669  put 'if upcase(NAME) = "TEXTCLUSTER13_SVD27" then do;';
17670  put 'ROLE = "INPUT";';
17671  put 'LEVEL = "INTERVAL";';
17672  put 'end;';
17673  put 'else ';
17674  put 'if upcase(NAME) = "TEXTCLUSTER13_SVD28" then do;';
17675  put 'ROLE = "INPUT";';
17676  put 'LEVEL = "INTERVAL";';
17677  put 'end;';
17678  put 'else ';
17679  put 'if upcase(NAME) = "TEXTCLUSTER13_SVD29" then do;';
17680  put 'ROLE = "INPUT";';
17681  put 'LEVEL = "INTERVAL";';
17682  put 'end;';
17683  put 'else ';
17684  put 'if upcase(NAME) = "TEXTCLUSTER13_SVD3" then do;';
17685  put 'ROLE = "INPUT";';
17686  put 'LEVEL = "INTERVAL";';
17687  put 'end;';
17688  put 'else ';
17689  put 'if upcase(NAME) = "TEXTCLUSTER13_SVD30" then do;';
17690  put 'ROLE = "INPUT";';
17691  put 'LEVEL = "INTERVAL";';
17692  put 'end;';
17693  put 'else ';
17694  put 'if upcase(NAME) = "TEXTCLUSTER13_SVD31" then do;';
17695  put 'ROLE = "INPUT";';
17696  put 'LEVEL = "INTERVAL";';
17697  put 'end;';
17698  put 'else ';
17699  put 'if upcase(NAME) = "TEXTCLUSTER13_SVD32" then do;';
17700  put 'ROLE = "INPUT";';
17701  put 'LEVEL = "INTERVAL";';
17702  put 'end;';
17703  put 'else ';
17704  put 'if upcase(NAME) = "TEXTCLUSTER13_SVD33" then do;';
17705  put 'ROLE = "INPUT";';
17706  put 'LEVEL = "INTERVAL";';
17707  put 'end;';
17708  put 'else ';
17709  put 'if upcase(NAME) = "TEXTCLUSTER13_SVD34" then do;';
17710  put 'ROLE = "INPUT";';
17711  put 'LEVEL = "INTERVAL";';
17712  put 'end;';
17713  put 'else ';
17714  put 'if upcase(NAME) = "TEXTCLUSTER13_SVD35" then do;';
17715  put 'ROLE = "INPUT";';
17716  put 'LEVEL = "INTERVAL";';
17717  put 'end;';
17718  put 'else ';
17719  put 'if upcase(NAME) = "TEXTCLUSTER13_SVD36" then do;';
17720  put 'ROLE = "INPUT";';
17721  put 'LEVEL = "INTERVAL";';
17722  put 'end;';
17723  put 'else ';
17724  put 'if upcase(NAME) = "TEXTCLUSTER13_SVD37" then do;';
17725  put 'ROLE = "INPUT";';
17726  put 'LEVEL = "INTERVAL";';
17727  put 'end;';
17728  put 'else ';
17729  put 'if upcase(NAME) = "TEXTCLUSTER13_SVD38" then do;';
17730  put 'ROLE = "INPUT";';
17731  put 'LEVEL = "INTERVAL";';
17732  put 'end;';
17733  put 'else ';
17734  put 'if upcase(NAME) = "TEXTCLUSTER13_SVD39" then do;';
17735  put 'ROLE = "INPUT";';
17736  put 'LEVEL = "INTERVAL";';
17737  put 'end;';
17738  put 'else ';
17739  put 'if upcase(NAME) = "TEXTCLUSTER13_SVD4" then do;';
17740  put 'ROLE = "INPUT";';
17741  put 'LEVEL = "INTERVAL";';
17742  put 'end;';
17743  put 'else ';
17744  put 'if upcase(NAME) = "TEXTCLUSTER13_SVD40" then do;';
17745  put 'ROLE = "INPUT";';
17746  put 'LEVEL = "INTERVAL";';
17747  put 'end;';
17748  put 'else ';
17749  put 'if upcase(NAME) = "TEXTCLUSTER13_SVD41" then do;';
17750  put 'ROLE = "INPUT";';
17751  put 'LEVEL = "INTERVAL";';
17752  put 'end;';
17753  put 'else ';
17754  put 'if upcase(NAME) = "TEXTCLUSTER13_SVD42" then do;';
17755  put 'ROLE = "INPUT";';
17756  put 'LEVEL = "INTERVAL";';
17757  put 'end;';
17758  put 'else ';
17759  put 'if upcase(NAME) = "TEXTCLUSTER13_SVD43" then do;';
17760  put 'ROLE = "INPUT";';
17761  put 'LEVEL = "INTERVAL";';
17762  put 'end;';
17763  put 'else ';
17764  put 'if upcase(NAME) = "TEXTCLUSTER13_SVD44" then do;';
17765  put 'ROLE = "INPUT";';
17766  put 'LEVEL = "INTERVAL";';
17767  put 'end;';
17768  put 'else ';
17769  put 'if upcase(NAME) = "TEXTCLUSTER13_SVD45" then do;';
17770  put 'ROLE = "INPUT";';
17771  put 'LEVEL = "INTERVAL";';
17772  put 'end;';
17773  put 'else ';
17774  put 'if upcase(NAME) = "TEXTCLUSTER13_SVD46" then do;';
17775  put 'ROLE = "INPUT";';
17776  put 'LEVEL = "INTERVAL";';
17777  put 'end;';
17778  put 'else ';
17779  put 'if upcase(NAME) = "TEXTCLUSTER13_SVD47" then do;';
17780  put 'ROLE = "INPUT";';
17781  put 'LEVEL = "INTERVAL";';
17782  put 'end;';
17783  put 'else ';
17784  put 'if upcase(NAME) = "TEXTCLUSTER13_SVD48" then do;';
17785  put 'ROLE = "INPUT";';
17786  put 'LEVEL = "INTERVAL";';
17787  put 'end;';
17788  put 'else ';
17789  put 'if upcase(NAME) = "TEXTCLUSTER13_SVD49" then do;';
17790  put 'ROLE = "INPUT";';
17791  put 'LEVEL = "INTERVAL";';
17792  put 'end;';
17793  put 'else ';
17794  put 'if upcase(NAME) = "TEXTCLUSTER13_SVD5" then do;';
17795  put 'ROLE = "INPUT";';
17796  put 'LEVEL = "INTERVAL";';
17797  put 'end;';
17798  put 'else ';
17799  put 'if upcase(NAME) = "TEXTCLUSTER13_SVD50" then do;';
17800  put 'ROLE = "INPUT";';
17801  put 'LEVEL = "INTERVAL";';
17802  put 'end;';
17803  put 'else ';
17804  put 'if upcase(NAME) = "TEXTCLUSTER13_SVD51" then do;';
17805  put 'ROLE = "INPUT";';
17806  put 'LEVEL = "INTERVAL";';
17807  put 'end;';
17808  put 'else ';
17809  put 'if upcase(NAME) = "TEXTCLUSTER13_SVD52" then do;';
17810  put 'ROLE = "INPUT";';
17811  put 'LEVEL = "INTERVAL";';
17812  put 'end;';
17813  put 'else ';
17814  put 'if upcase(NAME) = "TEXTCLUSTER13_SVD53" then do;';
17815  put 'ROLE = "INPUT";';
17816  put 'LEVEL = "INTERVAL";';
17817  put 'end;';
17818  put 'else ';
17819  put 'if upcase(NAME) = "TEXTCLUSTER13_SVD54" then do;';
17820  put 'ROLE = "INPUT";';
17821  put 'LEVEL = "INTERVAL";';
17822  put 'end;';
17823  put 'else ';
17824  put 'if upcase(NAME) = "TEXTCLUSTER13_SVD55" then do;';
17825  put 'ROLE = "INPUT";';
17826  put 'LEVEL = "INTERVAL";';
17827  put 'end;';
17828  put 'else ';
17829  put 'if upcase(NAME) = "TEXTCLUSTER13_SVD56" then do;';
17830  put 'ROLE = "INPUT";';
17831  put 'LEVEL = "INTERVAL";';
17832  put 'end;';
17833  put 'else ';
17834  put 'if upcase(NAME) = "TEXTCLUSTER13_SVD57" then do;';
17835  put 'ROLE = "INPUT";';
17836  put 'LEVEL = "INTERVAL";';
17837  put 'end;';
17838  put 'else ';
17839  put 'if upcase(NAME) = "TEXTCLUSTER13_SVD58" then do;';
17840  put 'ROLE = "INPUT";';
17841  put 'LEVEL = "INTERVAL";';
17842  put 'end;';
17843  put 'else ';
17844  put 'if upcase(NAME) = "TEXTCLUSTER13_SVD59" then do;';
17845  put 'ROLE = "INPUT";';
17846  put 'LEVEL = "INTERVAL";';
17847  put 'end;';
17848  put 'else ';
17849  put 'if upcase(NAME) = "TEXTCLUSTER13_SVD6" then do;';
17850  put 'ROLE = "INPUT";';
17851  put 'LEVEL = "INTERVAL";';
17852  put 'end;';
17853  put 'else ';
17854  put 'if upcase(NAME) = "TEXTCLUSTER13_SVD60" then do;';
17855  put 'ROLE = "INPUT";';
17856  put 'LEVEL = "INTERVAL";';
17857  put 'end;';
17858  put 'else ';
17859  put 'if upcase(NAME) = "TEXTCLUSTER13_SVD61" then do;';
17860  put 'ROLE = "INPUT";';
17861  put 'LEVEL = "INTERVAL";';
17862  put 'end;';
17863  put 'else ';
17864  put 'if upcase(NAME) = "TEXTCLUSTER13_SVD62" then do;';
17865  put 'ROLE = "INPUT";';
17866  put 'LEVEL = "INTERVAL";';
17867  put 'end;';
17868  put 'else ';
17869  put 'if upcase(NAME) = "TEXTCLUSTER13_SVD63" then do;';
17870  put 'ROLE = "INPUT";';
17871  put 'LEVEL = "INTERVAL";';
17872  put 'end;';
17873  put 'else ';
17874  put 'if upcase(NAME) = "TEXTCLUSTER13_SVD64" then do;';
17875  put 'ROLE = "INPUT";';
17876  put 'LEVEL = "INTERVAL";';
17877  put 'end;';
17878  put 'else ';
17879  put 'if upcase(NAME) = "TEXTCLUSTER13_SVD65" then do;';
17880  put 'ROLE = "INPUT";';
17881  put 'LEVEL = "INTERVAL";';
17882  put 'end;';
17883  put 'else ';
17884  put 'if upcase(NAME) = "TEXTCLUSTER13_SVD66" then do;';
17885  put 'ROLE = "INPUT";';
17886  put 'LEVEL = "INTERVAL";';
17887  put 'end;';
17888  put 'else ';
17889  put 'if upcase(NAME) = "TEXTCLUSTER13_SVD67" then do;';
17890  put 'ROLE = "INPUT";';
17891  put 'LEVEL = "INTERVAL";';
17892  put 'end;';
17893  put 'else ';
17894  put 'if upcase(NAME) = "TEXTCLUSTER13_SVD68" then do;';
17895  put 'ROLE = "INPUT";';
17896  put 'LEVEL = "INTERVAL";';
17897  put 'end;';
17898  put 'else ';
17899  put 'if upcase(NAME) = "TEXTCLUSTER13_SVD69" then do;';
17900  put 'ROLE = "INPUT";';
17901  put 'LEVEL = "INTERVAL";';
17902  put 'end;';
17903  put 'else ';
17904  put 'if upcase(NAME) = "TEXTCLUSTER13_SVD7" then do;';
17905  put 'ROLE = "INPUT";';
17906  put 'LEVEL = "INTERVAL";';
17907  put 'end;';
17908  put 'else ';
17909  put 'if upcase(NAME) = "TEXTCLUSTER13_SVD70" then do;';
17910  put 'ROLE = "INPUT";';
17911  put 'LEVEL = "INTERVAL";';
17912  put 'end;';
17913  put 'else ';
17914  put 'if upcase(NAME) = "TEXTCLUSTER13_SVD71" then do;';
17915  put 'ROLE = "INPUT";';
17916  put 'LEVEL = "INTERVAL";';
17917  put 'end;';
17918  put 'else ';
17919  put 'if upcase(NAME) = "TEXTCLUSTER13_SVD72" then do;';
17920  put 'ROLE = "INPUT";';
17921  put 'LEVEL = "INTERVAL";';
17922  put 'end;';
17923  put 'else ';
17924  put 'if upcase(NAME) = "TEXTCLUSTER13_SVD73" then do;';
17925  put 'ROLE = "INPUT";';
17926  put 'LEVEL = "INTERVAL";';
17927  put 'end;';
17928  put 'else ';
17929  put 'if upcase(NAME) = "TEXTCLUSTER13_SVD74" then do;';
17930  put 'ROLE = "INPUT";';
17931  put 'LEVEL = "INTERVAL";';
17932  put 'end;';
17933  put 'else ';
17934  put 'if upcase(NAME) = "TEXTCLUSTER13_SVD75" then do;';
17935  put 'ROLE = "INPUT";';
17936  put 'LEVEL = "INTERVAL";';
17937  put 'end;';
17938  put 'else ';
17939  put 'if upcase(NAME) = "TEXTCLUSTER13_SVD76" then do;';
17940  put 'ROLE = "INPUT";';
17941  put 'LEVEL = "INTERVAL";';
17942  put 'end;';
17943  put 'else ';
17944  put 'if upcase(NAME) = "TEXTCLUSTER13_SVD77" then do;';
17945  put 'ROLE = "INPUT";';
17946  put 'LEVEL = "INTERVAL";';
17947  put 'end;';
17948  put 'else ';
17949  put 'if upcase(NAME) = "TEXTCLUSTER13_SVD78" then do;';
17950  put 'ROLE = "INPUT";';
17951  put 'LEVEL = "INTERVAL";';
17952  put 'end;';
17953  put 'else ';
17954  put 'if upcase(NAME) = "TEXTCLUSTER13_SVD79" then do;';
17955  put 'ROLE = "INPUT";';
17956  put 'LEVEL = "INTERVAL";';
17957  put 'end;';
17958  put 'else ';
17959  put 'if upcase(NAME) = "TEXTCLUSTER13_SVD8" then do;';
17960  put 'ROLE = "INPUT";';
17961  put 'LEVEL = "INTERVAL";';
17962  put 'end;';
17963  put 'else ';
17964  put 'if upcase(NAME) = "TEXTCLUSTER13_SVD80" then do;';
17965  put 'ROLE = "INPUT";';
17966  put 'LEVEL = "INTERVAL";';
17967  put 'end;';
17968  put 'else ';
17969  put 'if upcase(NAME) = "TEXTCLUSTER13_SVD81" then do;';
17970  put 'ROLE = "INPUT";';
17971  put 'LEVEL = "INTERVAL";';
17972  put 'end;';
17973  put 'else ';
17974  put 'if upcase(NAME) = "TEXTCLUSTER13_SVD82" then do;';
17975  put 'ROLE = "INPUT";';
17976  put 'LEVEL = "INTERVAL";';
17977  put 'end;';
17978  put 'else ';
17979  put 'if upcase(NAME) = "TEXTCLUSTER13_SVD83" then do;';
17980  put 'ROLE = "INPUT";';
17981  put 'LEVEL = "INTERVAL";';
17982  put 'end;';
17983  put 'else ';
17984  put 'if upcase(NAME) = "TEXTCLUSTER13_SVD84" then do;';
17985  put 'ROLE = "INPUT";';
17986  put 'LEVEL = "INTERVAL";';
17987  put 'end;';
17988  put 'else ';
17989  put 'if upcase(NAME) = "TEXTCLUSTER13_SVD85" then do;';
17990  put 'ROLE = "INPUT";';
17991  put 'LEVEL = "INTERVAL";';
17992  put 'end;';
17993  put 'else ';
17994  put 'if upcase(NAME) = "TEXTCLUSTER13_SVD86" then do;';
17995  put 'ROLE = "INPUT";';
17996  put 'LEVEL = "INTERVAL";';
17997  put 'end;';
17998  put 'else ';
17999  put 'if upcase(NAME) = "TEXTCLUSTER13_SVD87" then do;';
18000  put 'ROLE = "INPUT";';
18001  put 'LEVEL = "INTERVAL";';
18002  put 'end;';
18003  put 'else ';
18004  put 'if upcase(NAME) = "TEXTCLUSTER13_SVD88" then do;';
18005  put 'ROLE = "INPUT";';
18006  put 'LEVEL = "INTERVAL";';
18007  put 'end;';
18008  put 'else ';
18009  put 'if upcase(NAME) = "TEXTCLUSTER13_SVD89" then do;';
18010  put 'ROLE = "INPUT";';
18011  put 'LEVEL = "INTERVAL";';
18012  put 'end;';
18013  put 'else ';
18014  put 'if upcase(NAME) = "TEXTCLUSTER13_SVD9" then do;';
18015  put 'ROLE = "INPUT";';
18016  put 'LEVEL = "INTERVAL";';
18017  put 'end;';
18018  put 'else ';
18019  put 'if upcase(NAME) = "TEXTCLUSTER13_SVD90" then do;';
18020  put 'ROLE = "INPUT";';
18021  put 'LEVEL = "INTERVAL";';
18022  put 'end;';
18023  put 'else ';
18024  put 'if upcase(NAME) = "TEXTCLUSTER13_SVD91" then do;';
18025  put 'ROLE = "INPUT";';
18026  put 'LEVEL = "INTERVAL";';
18027  put 'end;';
18028  put 'else ';
18029  put 'if upcase(NAME) = "TEXTCLUSTER13_SVD92" then do;';
18030  put 'ROLE = "INPUT";';
18031  put 'LEVEL = "INTERVAL";';
18032  put 'end;';
18033  put 'else ';
18034  put 'if upcase(NAME) = "TEXTCLUSTER13_SVD93" then do;';
18035  put 'ROLE = "INPUT";';
18036  put 'LEVEL = "INTERVAL";';
18037  put 'end;';
18038  put 'else ';
18039  put 'if upcase(NAME) = "TEXTCLUSTER13_SVD94" then do;';
18040  put 'ROLE = "INPUT";';
18041  put 'LEVEL = "INTERVAL";';
18042  put 'end;';
18043  put 'else ';
18044  put 'if upcase(NAME) = "TEXTCLUSTER13_SVD95" then do;';
18045  put 'ROLE = "INPUT";';
18046  put 'LEVEL = "INTERVAL";';
18047  put 'end;';
18048  put 'else ';
18049  put 'if upcase(NAME) = "TEXTCLUSTER13_SVD96" then do;';
18050  put 'ROLE = "INPUT";';
18051  put 'LEVEL = "INTERVAL";';
18052  put 'end;';
18053  put 'else ';
18054  put 'if upcase(NAME) = "TEXTCLUSTER13_SVD97" then do;';
18055  put 'ROLE = "INPUT";';
18056  put 'LEVEL = "INTERVAL";';
18057  put 'end;';
18058  put 'else ';
18059  put 'if upcase(NAME) = "TEXTCLUSTER13_SVD98" then do;';
18060  put 'ROLE = "INPUT";';
18061  put 'LEVEL = "INTERVAL";';
18062  put 'end;';
18063  put 'else ';
18064  put 'if upcase(NAME) = "TEXTCLUSTER13_SVD99" then do;';
18065  put 'ROLE = "INPUT";';
18066  put 'LEVEL = "INTERVAL";';
18067  put 'end;';
18068  run;
 
NOTE: The file X is:
      Filename=C:\Users\lahar\OneDrive\Desktop\Data Mining\Resume\Workspaces\EMWS3\TextCluster13\CDELTA_TRAIN.sas,
      RECFM=V,LRECL=32767,File Size (bytes)=0,
      Last Modified=26Nov2023:12:17:45,
      Create Time=20Nov2023:19:51:13
 
NOTE: 536 records were written to the file X.
      The minimum record length was 4.
      The maximum record length was 51.
NOTE: DATA statement used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
 
 
18069  filename x;
NOTE: Fileref X has been deassigned.
 
*------------------------------------------------------------*
* Score Log
Date:                November 26, 2023
Time:                12:17:46
*------------------------------------------------------------*
18171  %let EMEXCEPTIONSTRING=;
18172  *------------------------------------------------------------*;
18173  * SCORE: TextCluster13;
18174  *------------------------------------------------------------*;
18175  %let EM_ACTION = SCORE;
18176  %let syscc = 0;
18177  %macro main();
18178
18179     %if %upcase(&EM_ACTION) eq CREATE %then %do;
18180        filename temp catalog 'sashelp.emtxtext.cluster_create.source';
18181        %include temp;
18182        %create();
18183     %end;
18184     %if %upcase(&EM_ACTION) eq TRAIN %then %do;
18185        filename temp catalog 'sashelp.emtxtext.cluster_train.source';
18186        %include temp;
18187        %train();
18188     %end;
18189     %if %upcase(&EM_ACTION) eq REPORT %then %do;
18190        filename temp catalog 'sashelp.emtxtext.cluster_report.source';
18191        %include temp;
18192        %report();
18193     %end;
18194     %if %upcase(&EM_ACTION) eq SCORE %then %do;
18195        filename temp catalog 'sashelp.emtxtext.cluster_score.source';
18196        %include temp;
18197        %score();
18198     %end;
18199  %mend main;
18200
18201  %main();
NOTE: %INCLUDE (level 1) file TEMP is file SASHELP.EMTXTEXT.CLUSTER_SCORE.SOURCE.
18202 +%macro tmc_score(import_ds=,configdata=,export_ds=,term_ds=,export_out=,clusters_ds=,svdu=,svds=,
18203 +    import_out=,em_outstat=,prefixstring=,ocluster=,ndescterms=,ftmout=,fterms=,hier=);
18204 +  %if &import_ds ne %then %do;
18205 +
18206 +    %let syscc=0;
18207 +
18208 +    %tmc_doc_score(import=&import_ds,export=&export_ds,emoutstat=&em_outstat,
18209 +                termds=&term_ds,clusters=&clusters_ds,configds=&configdata,
18210 +                _scrout=&import_out, svd_u=&svdu, svd_s=&svds, prefix=&prefixstring,
18211 +                outclusters=&ocluster, descterms=&ndescterms, filterterms=&fterms,
18212 +                filtertmout=&ftmout, hierds=&hier);
18213 +
18214 +  %end;
18215 +
18216 +%mend tmc_score;
18217 +%macro score();
18218 +
18219 +    %global last_parse_node last_filter_node last_prescore_node server_err
18220 +      parsevar EM_SASMSG ;
18221 +    %let syscc=0;
18222 +    %if ^%symexist(tm_debug) %then %let tm_debug=0;
18223 +    /*use saved version of em_info in case macro is not populated*/
18224 +    %em_getname(key=last_tm_nodes, type=data);
18225 +
18226 +    filename temp catalog 'sashelp.emtxtext.tm_get_last_filter.source';
18227 +    %include temp;
18228 +    %tm_get_last_filter(eminfo=&em_user_last_tm_nodes,em_lib=&em_lib,
18229 +                        em_variableset=&em_data_variableset);
18230 +    %if &EMEXCEPTIONSTRING ne %then %goto end_cluster_score;
18231 +    %let lastparsenode=&last_parse_node;
18232 +    %let lastfilternode=&last_filter_node;
18233 +    %let lastprescore=&last_prescore_node;
18234 +    %let filt_node=;
18235 +
18236 +   %em_getname(key=terms, type=data);
18237 +   %em_getname(key=docs, type=data);
18238 +   %em_getname(key=clusters, type=data);
18239 +   %em_getname(key=svd_u, type=data);
18240 +   %em_getname(key=svd_s, type=data);
18241 +   %em_getname(key=emoutstat, type=data);
18242 +   %em_getname(key=tmconfig, type=data);
18243 +
18244 +   %em_getname(key=tmout, type=data);
18245 +   %em_getname(key=validout, type=data);
18246 +   %em_getname(key=testout, type=data);
18247 +   %em_getname(key=scoreout, type=data);
18248 +   %em_getname(key=PRESCORECODE, type=file, extension=sas);
18249 +   %let systmutil=;
18250 +
18251 +    filename temp catalog 'sashelp.emtxtext.tm_data2code.source';
18252 +    %include temp;
18253 +    filename temp catalog 'sashelp.emtext.tmemclus.source';
18254 +    %include temp;
18255 +    filename temp catalog 'sashelp.emtext.tmpred.source';
18256 +    %include temp;
18257 +    filename temp catalog 'sashelp.emtext.tmsort.source';
18258 +    %include temp;
18259 +    filename temp catalog 'sashelp.emtxtext.tmc_doc_score.source';
18260 +    %include temp;
18261 +    filename temp catalog 'sashelp.emtext.tmsvd.source';
18262 +    %include temp;
18263 +    filename temp catalog 'sashelp.emtext.tmfast.source';
18264 +    %include temp;
18265 +
18266 +   %let EM_PUBLISHCODE = PUBLISH;
18267 +   %let EM_SCORECODEFORMAT = OTHER;
18268 +   %let overwrite_pre = ;
18269 +
18270 +   %let lastprescore=%trim(%left(&lastprescore));
18271 +
18272 +   /* Create indexed term table for writing out score code */
18273 +   proc sql noprint;
18274 +       select count(*) into :svdkeep
18275 +       from &em_user_svd_s
18276 +       where keep=1;
18277 +   create table _clusterms as
18278 +      select key, term, role, keep, freq, numdocs, parent, _ispar, weight from &em_user_terms;
18279 +
18280 +   data _filter_tmout;
18281 +      set &EM_LIB..&lastfilternode._tmout;
18282 +   run;
18283 +
18284 +   %tmc_score(import_ds=&em_import_data,export_ds=&em_export_train,
18285 +              import_out=_filter_tmout,
18286 +              export_out=&EM_export_transaction,
18287 +              term_ds=_clusterms,
18288 +              clusters_ds=&em_user_clusters,
18289 +              svdu=&em_user_svd_u,
18290 +              svds=&em_user_svd_s,
18291 +              em_outstat=&em_user_emoutstat,
18292 +              configdata=&em_user_tmconfig,
18293 +              prefixstring=&EM_NODEID,
18294 +              ocluster=&em_user_clusters,
18295 +              ndescterms=&em_property_ndescterms,
18296 +              fterms=&EM_LIB..&lastfilternode._terms,
18297 +              ftmout=&EM_LIB..&lastfilternode._tmout,
18298 +              hier=&em_user_hierds);
18299 +
18300 +   %tmc_score(import_ds=&em_import_validate,export_ds=&em_export_validate,
18301 +              export_out=&EM_USER_validout,
18302 +              import_out=&EM_LIB..&lastfilternode._validout,
18303 +              term_ds=_clusterms,
18304 +              clusters_ds=&em_user_clusters,
18305 +              svdu=&em_user_svd_u,
18306 +              svds=&em_user_svd_s,
18307 +              em_outstat=&em_user_emoutstat,
18308 +              configdata=&em_user_tmconfig,
18309 +              prefixstring=&EM_NODEID);
18310 +   %tmc_score(import_ds=&em_import_test,export_ds=&em_export_test,
18311 +              export_out=&EM_USER_testout,
18312 +              import_out=&EM_LIB..&lastfilternode._testout,
18313 +              term_ds=_clusterms,
18314 +              clusters_ds=&em_user_clusters,
18315 +              svdu=&em_user_svd_u,
18316 +              svds=&em_user_svd_s,
18317 +              em_outstat=&em_user_emoutstat,
18318 +              configdata=&em_user_tmconfig,
18319 +              prefixstring=&EM_NODEID);
18320 +
18321 +   %if &syscc>4 %then %do;
18322 +       %let syscc=0;
18323 +       %goto end_cluster_score;
18324 +   %end;
18325 +
18326 +   * path of the diagram ;
18327 +   %let emwspath = ;
18328 +   data _null_;
18329 +      call symput("emwspath", strip(pathname("&EM_LIB")));
18330 +   run;
18331 +
18332 +   filename pre "&EM_USER_PRESCORECODE";
18333 +   data _null_;
18334 +       file pre;
18335 +       put 'filename temp catalog "sashelp.emtext.tmemclus.source";';
18336 +       put '%include temp;';
18337 +       put 'filename temp catalog "sashelp.emtext.tmpred.source";';
18338 +       put '%include temp;';
18339 +       put 'filename temp catalog "sashelp.emtxtext.tmc_doc_score.source";';
18340 +       put '%include temp;';
18341 +       put 'filename temp catalog "sashelp.emtext.tmsort.source";';
18342 +       put '%include temp;';
18343 +       put 'filename temp catalog "sashelp.emtext.tmsvd.source";';
18344 +       put '%include temp;';
18345 +       put 'filename temp catalog "sashelp.emtext.tmfast.source";';
18346 +       put '%include temp;';
18347 +       put 'filename temp;';
18348 +   run;
18349 +
18350 +
18351 +   /* We need to use last prescore */
18352 +   %if &lastprescore ne %then %do;
18353 +      %let tmprescoreFile = %bquote(&emwspath)&em_dsep&lastprescore&em_dsep.PRESCORECODE.sas;
18354 +      filename tmpre "&tmprescoreFile";
18355 +      %em_copyfile(infref=tmpre, outfref=pre, append=Y);
18356 +      filename tmpre;
18357 +   %end;
18358 +
18359 +   data _codeclusters;
18360 +        set &em_user_clusters (drop=clus_desc);
18361 +   run;
18362 +
18363 +     %if not %symexist(em_term_loc) %then %do;
18364 +       %let em_term_loc = %bquote(%sysfunc(pathname(&EM_LIB)));
18365 +         libname termloc "&em_term_loc";
18366 +
18367 +      %let scored_terms = termloc.&lastfilternode._filtterms;
18368 +       %let scored_clust = termloc.&EM_NODEID._clusters;
18369 +       %let scored_config = termloc.&EM_NODEID._tmconfig;
18370 +       %let scored_svd_u = termloc.&EM_NODEID._svd_u;
18371 +       %let scored_svd_s= termloc.&EM_NODEID._svd_s;
18372 +
18373 +       %if &em_property_algorithm=1.0 %then  %do;
18374 +          %let scored_emoutstat= termloc.&EM_NODEID._emoutstat;
18375 +       %end;
18376 +
18377 +   %end;
18378 +   %else %do; /* Write out data sets to external directory */
18379 +       libname termloc "&em_term_loc";
18380 +        %if %sysfunc(libref(termloc)) ne 0 %then %do;
18381 +           %let  EMEXCEPTIONSTRING = EMTOOL.EMTERMLOC,&em_term_loc;
18382 +           %goto end_cluster_score;
18383 +       %end;
18384 +
18385 +      /* copy datasets to use for prescore code*/
18386 +       data termloc.&EM_LIB._&EM_NODEID._CLUSTERS;
18387 +         set _codeclusters;
18388 +       run;
18389 +
18390 +       data termloc.&EM_LIB._&EM_NODEID._svd_u;
18391 +         set &em_user_svd_u;
18392 +       run;
18393 +
18394 +       data termloc.&EM_LIB._&EM_NODEID._svd_s;
18395 +         set &em_user_svd_s;
18396 +       run;
18397 +
18398 +       data termloc.&EM_LIB._&EM_NODEID._tmconfig;
18399 +         set &em_user_tmconfig;
18400 +       run;
18401 +
18402 +       %let scored_terms = termloc.&EM_LIB._&lastfilternode._filtterms;
18403 +       %let scored_clust = termloc.&EM_LIB._&EM_NODEID._CLUSTERS;
18404 +       %let scored_config = termloc.&EM_LIB._&EM_NODEID._tmconfig;
18405 +       %let scored_svd_u = termloc.&EM_LIB._&EM_NODEID._svd_u;
18406 +       %let scored_svd_s= termloc.&EM_LIB._&EM_NODEID._svd_s;
18407 +
18408 +       %if &em_property_algorithm=1.0 %then  %do;
18409 +         data termloc.&EM_LIB._&EM_NODEID._emoutstat;
18410 +         set &em_user_emoutstat;
18411 +         run;
18412 +           %let scored_emoutstat= termloc.&EM_LIB._&EM_NODEID._emoutstat;
18413 +       %end;
18414 +   %end;
18415 +
18416 +
18417 +
18418 +   %let _score_append=;
18419 +
18420 +   * Now save code, if necessary, for search phrase;
18421 +   filename _tmscore "&EM_FILE_EMPUBLISHSCORECODE";
18422 +   %if &em_property_algorithm=1.0 %then %do;
18423 +   data _NULL_;
18424 +     file _tmscore;
18425 +     length string $200;
18426 +     string ='%tmc_doc_score(import='||'&em_score_output'||",export=work._newexport,";
18427 +     put string;
18428 +     string="      termds=&scored_terms, configds=&scored_config,";
18429 +     put string;
18430 +     string= "      clusters=&scored_clust, emoutstat=&scored_emoutstat, ";
18431 +     put string;
18432 +     string = "      _scrout=work.&lastfilternode._out, svd_u=&scored_svd_u, svd_s=&scored_svd_s, prefix=&em_nodeid);";
18433 +     put string;
18434 +     string='data &em_score_output; set work._newexport;';
18435 +     put string;
18436 +    run;
18437 +    %end;
18438 +    %else %do;
18439 +    data _NULL_;
18440 +     file _tmscore;
18441 +     string= '%'||"tmc_doc_score(import="||'&em_score_output'||",export=work._newexport,";
18442 +     put string;
18443 +     put "      termds=&scored_terms,configds=&scored_config,";
18444 +     put "      clusters=&scored_clust, ";
18445 +     put "      _scrout=work.&lastfilternode._out, svd_u=&scored_svd_u, svd_s=&scored_svd_s, prefix=&em_nodeid);";
18446 +     put 'data &em_score_output; set work._newexport;';
18447 +    run;
18448 +    %end;
18449 +   filename _tmscore;
18450 +
18451 +%end_cluster_score:
18452 +    filename temp;
18453 +    %if &tm_debug =0 %then %do;
18454 +    proc sql noprint;
18455 +        drop table _clusterms;
18456 +        drop table _filter_tmout;
18457 +        drop table _codeclusters;
18458 +    quit;
18459 +    %end;
18460 +
18461 +%mend score;
18462 +
NOTE: %INCLUDE (level 1) ending.
NOTE: %INCLUDE (level 1) file TEMP is file SASHELP.EMTXTEXT.TM_GET_LAST_FILTER.SOURCE.
18463 +/* ****************************************************************
18464 + * Copyright (C) 2009 by SAS Institute Inc., Cary, NC 27513
18465 + *
18466 + * Name:             tm_get_last_filter.sas
18467 + * Product:          SAS Text Miner
18468 + * Language:         Sas
18469 + * Script:
18470 + *
18471 + * Usage:
18472 + *
18473 + * Purpose:  macro to get the last filter node and the last parse node in the
18474 + *   diagram that corresponds to the current parse variable.  If there is no filter
18475 + *   node, the filter node is set to the last parse node.
18476 + *
18477 + *
18478 + *
18479 + * History:
18480 + * 14Aug09 Initial Coding
18481 + *
18482 + * Notes:
18483 + *    Returns an error in the following cases:
18484 + *      1. There is no preceding parse node.
18485 + *      2. There is no parse node with the current parse variable.
18486 + *
18487 + * Last Modified By:
18488 + * Last Modified On: Wed Sep 23 15:35:04 2009
18489 + *
18490 + * End
18491 + * ************************************************************** */
18492 +%macro tm_get_last_filter(eminfo=,em_lib=, em_variableset=);
18493 +   %let last_parse_node=;
18494 +   %let last_filter_node=;
18495 +   %let last_prescore_node=;
18496 +   %let server_err=;
18497 +   %let EMEXCEPTIONSTRING=;
18498 +   %let syscc=0;
18499 +
18500 +    /* verify that setinit for SAS Text Miner is currently active */
18501 +    %if %sysfunc(sysprod(PRODNUM107)) ne 1 %then %do;
18502 +       %let EMEXCEPTIONSTRING = EMTOOL.NOTMLICENSE;
18503 +        %goto end_macro;
18504 +        %end;
18505 +
18506 +
18507 +    * find last filter or text parse node if no filter node. ;
18508 +   %if %sysfunc(exist(&eminfo)) %then %do;
18509 +      proc sql noprint;
18510 +      select data into :last_parse_node from &eminfo where key="LastTextParsing";
18511 +         select data into :last_filter_node from &eminfo where key="LastTextFilter";
18512 +         select data into :last_prescore_node from &eminfo where kupcase(key)="PRESCORECODE";
18513 +      quit;
18514 +
18515 +   %end;
18516 +
18517 +   %if &last_parse_node= %then %do;
18518 +      %let EMEXCEPTIONSTRING = EMTOOL.NOPARSINGNODE;
18519 +      %goto end_macro;
18520 +      %end;
18521 +
18522 +   %else %if &last_filter_node= %then %let last_filter_node = %ktrim(&last_parse_node);
18523 +   %else %let last_filter_node = %ktrim(&last_filter_node);
18524 +   %let last_parse_node = %ktrim(&last_parse_node);
18525 +
18526 +   * Check to make sure parse variable is present and still exists;
18527 +   %let parsevar = ;
18528 +   proc sql noprint;
18529 +    select parsevar into :parsevar
18530 +    from &em_lib..&last_filter_node._tmconfig;
18531 +    quit;
18532 +
18533 +    *check for dropped parsevar on input dataset;
18534 +       %let parsevarOK= ;
18535 +       %let parsevarN=%kupcase(%ktrim(&parsevar));
18536 +       data _null_;
18537 +         set &em_variableset(where=(kupcase(NAME)="&parsevarN" and USE in('Y' 'D')));
18538 +         if (ROLE='TEXT' or ROLE='TEXTLOC') then call symput('parsevarOK', strip(ROLE));
18539 +         run;
18540 +       %if(&parsevarOK eq ) %then %do;
18541 +          %let EMEXCEPTIONSTRING = EMTOOL.NOPARSINGVAR;
18542 +          %goto end_macro;
18543 +          %end;
18544 +%end_macro:
18545 +
18546 +%mend tm_get_last_filter;
NOTE: %INCLUDE (level 1) ending.
NOTE: PROCEDURE SQL used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
 
 
NOTE: PROCEDURE SQL used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 1 observations read from the data set EMWS3.TEXTCLUSTER13_VARIABLESET.
      WHERE (KUPCASE(NAME)='RESUME_STR') and USE in ('D', 'Y');
NOTE: DATA statement used (Total process time):
      real time           0.00 seconds
      cpu time            0.01 seconds
 
 
NOTE: %INCLUDE (level 1) file TEMP is file SASHELP.EMTXTEXT.TM_DATA2CODE.SOURCE.
18547 +/* ****************************************************************
18548 + * Copyright (C) 2009 by SAS Institute Inc., Cary, NC 27513
18549 + *
18550 + * Name:             tm_data2code.sas
18551 + * Product:          SAS Text Miner
18552 + * Language:         Sas
18553 + * Script:
18554 + *
18555 + * Usage:  %tm_data2code(data=, outdata=WORK.DATA);
18556 + *
18557 + * Purpose:          To do a data2code (like %em_data2code()) but allow the input data
18558 + *  to be view or data.
18559 + *
18560 + *    PARAMETERS:
18561 + *        DATA        = data set
18562 + *        OUTDATA     = out data set
18563 + *        OUTFILE     = file where to saved the code
18564 + *        APPEND      = append (Y/N)
18565 + * History:
18566 + * 11Jun09 Initial Coding
18567 + *
18568 + * Notes:
18569 + *
18570 + * Last Modified By:
18571 + * Last Modified On: Thu Jul 23 11:00:06 2009
18572 + *
18573 + * End
18574 + * ************************************************************** */
18575 +%macro tm_data2code(data=, outdata=WORK.DATA, outfile=, append=N);
18576 +%if &data eq %then %do;
18577 +   %put ERROR: Data set not defined;
18578 +   %end;
18579 +%else %do;
18580 +   %if (^%sysfunc(exist(&data)) and ^%sysfunc(exist(&data, view))) %then %do;
18581 +       %put ERROR: Data set does not exist;
18582 +       %end;
18583 +   %else %do;
18584 +      %global em_data em_outdata em_codefile em_append;
18585 +      %let em_data=&data;
18586 +      %let em_outdata=&outdata;
18587 +      %let em_codefile=&outfile;
18588 +      %let em_append=&append;
18589 +      proc display c=sashelp.emutil.data2code.scl; run;
18590 +      %end;
18591 +   %end;
18592 +%mend;
NOTE: %INCLUDE (level 1) ending.
NOTE: %INCLUDE (level 1) file TEMP is file SASHELP.EMTEXT.TMEMCLUS.SOURCE.
18593 +
18594 + /*
18595 +
18596 +  Macro:   tmemclus.sas
18597 +  Purpose: Call proc emclus with given defaults and parameters.
18598 +  Syntax:  %tmemclus(data=, role=, clusters=, seed=,
18599 +                   outstat=, out=, vars=, cov=, iter=, secclus=,
18600 +                   seciter=, min=, method=, eps=, init=, print=,
18601 +                   p=, outliers=, decvar=, initstd=, dist=,
18602 +                   secstd=, nobs=, threads=);
18603 +  Required Parameters:  data=      The input data set.
18604 +                        role=      Train or score
18605 +                        clusters=  The number of primary clusters
18606 +
18607 +  Optional Parameters:  vars=      Variables to be used
18608 +                   cov=       Type of covariance matrix
18609 +                   iter=      Number of EM iterations
18610 +                   secclus    Number of secondary clusters
18611 +                   seciter    Number of k-means iterations
18612 +                   min=       Minimum number of obs in a cluster
18613 +                   method=    Standard or scaled
18614 +                   eps=       Stopping tolerance
18615 +                   init=      Random, Fastclus, or Emclus
18616 +                   print=     All, last, or none
18617 +                   p=
18618 +                   outliers=  Keep, cluster, or ignore
18619 +                   outstat=   Name of OUTSTAT data set
18620 +                   out=       Name of OUT data set
18621 +                   seed=      Name of SEED data set
18622 +                   decvar=    Proportion to decrease variances
18623 +                   initstd=   Initial standard deviation
18624 +                   dist=      Minimum distance between clusters
18625 +                   secstd=    Secondary cluster max std dev.
18626 +                   nobs=      Number of obs read in each iteration
18627 +  History:
18628 +  2001/01/16 - Bill Wheeler - Initial Coding.
18629 +  2001/11/29 - Bill Wheeler - Updated for version 8 or 9
18630 +*/
18631 +%MACRO tmemclus(data=, role=, clusters=, seed=,
18632 + outstat=, out=, vars=, cov=, iter=, secclus=,
18633 + seciter=, min=, method=, eps=, init=, print=,
18634 + p=, outliers=, decvar=, initstd=, dist=, secstd=, nobs=, threads=);
18635 +
18636 + %local saveout saveseed op1 op2 op3 op4;
18637 +
18638 + %LET saveout = &out;
18639 + %LET saveseed = &outstat;
18640 +
18641 + /* defaults */
18642 + %if &role= %then %let role = TRAIN;
18643 + %if &seed ne %then %let seed = seed=&seed;
18644 + %if &vars= %then %let var = ;
18645 + %else %let var = var &vars;
18646 + %if &cov ne %then %let cov = cov = &cov;
18647 + %if &iter ne %then %let iter = iter = &iter;
18648 + %if &init ne %then %let init = init = &init;
18649 + %if &eps ne  %then %let eps = eps = &eps;
18650 + %if &min ne %then %let min = min = &min;
18651 + %if &seciter ne %then %let seciter = seciter = &seciter;
18652 + %if &print ne %then %let print = print = &print;
18653 + %if &p ne %then %let p = p = &p;
18654 + %if &outliers ne %then %let outliers = outliers = &outliers;
18655 + %if &method ne %then %let method = method = &method;
18656 + %if &decvar ne %then %let decvar = decvar = &decvar;
18657 + %if &outstat ne %then %let outstat = outstat = &outstat;
18658 + %if &out ne %then %let out = out = &out;
18659 + %if (&threads >= 0)  %then %let threads = threads = &threads;
18660 + %else %let threads = ;
18661 +
18662 + %LET op1 = ;
18663 + %LET op2 = ;
18664 + %LET op3 = ;
18665 + %LET op4 = ;
18666 + %if ^(&initstd=) %then %let op1 = %str(initstd = &initstd);
18667 + %if ^(&dist=) %then %let op2 = %str(dist = &dist);
18668 + %if ^(&secstd=) %then %let op3 = %str(secstd = &secstd);
18669 + %if ^(&nobs=) %then %let op4 = %str(nobs = &nobs);
18670 +
18671 +
18672 + %IF &SYSVER < 9 %THEN %DO;
18673 +    %LET cov = ;
18674 +    %LET decvar = ;
18675 +    %LET outliers = ;
18676 +    %LET out = ;
18677 + %END;
18678 +
18679 +
18680 + %if %upcase(&role) = TRAIN %then
18681 + %do;
18682 +   proc emclus data = &data
18683 +   clusters = &clusters
18684 +   &seed
18685 +   &outstat
18686 +   &out
18687 +   &init
18688 +   &eps
18689 +   &method
18690 +   &secclus
18691 +   &min
18692 +   &print
18693 +   &outliers
18694 +   &iter
18695 +   &op1 &op2
18696 +   &op3 &op4
18697 +   &decvar
18698 +   &cov
18699 +   &threads
18700 +   ;
18701 +   &var;
18702 + %end;
18703 + %else
18704 +  %do;
18705 +    proc emclus data = &data
18706 +    role = score
18707 +    clusters = &clusters
18708 +    &seed
18709 +    &out
18710 +    &cov
18711 +    ;
18712 +    &var;
18713 +  %end;
18714 +
18715 + %IF &SYSVER < 9 and &saveout ^= %THEN %DO;
18716 +   proc emclus data = &data
18717 +   role = score
18718 +   clusters = &clusters
18719 +   seed = &saveseed
18720 +   &saveout
18721 +   ;
18722 +   &var;
18723 + %END;
18724 +
18725 +
18726 +%MEND tmemclus;
NOTE: %INCLUDE (level 1) ending.
NOTE: %INCLUDE (level 1) file TEMP is file SASHELP.EMTEXT.TMPRED.SOURCE.
18727 +
18728 +/*
18729 +  Macro: tmpred(inds,outds,clusters,type=,ignore=,freqDS=)
18730 +
18731 +  Description: This macro will take output from
18732 +     emclus and generate predicted
18733 +      predicted clusters.
18734 +
18735 +  Parms: inds - input data set, produced by emclus.
18736 +   outds - data set with clusters created by this macro.
18737 +   clusters - number of clusters that should be on this data set
18738 +   type - valid values: 'max' or 'prob'.  Max will just take the
18739 +      cluster with the highest probability as the predicted cluster.
18740 +      In the case of a tie the first cluster with that value will
18741 +       selected.
18742 +      Prob will attempt to select multiple clusters based on
18743 +      how many clusters were requested.  That is if 3 clusters
18744 +      were requested, any cluster with prob>1/3 will be selected
18745 +      as the predicted cluster. THIS OPTION IS UNTESTED.
18746 +*/
18747 +
18748 +%macro tmpred(inds,outds,clusters,type=, ignore=0, freqDS=, compress=1);
18749 +
18750 +  %local _str newfreqDS _flag;
18751 +
18752 +  * set the optional arguments;
18753 +  %if &type= %then %let type=max;
18754 +  %if &ignore = 1 %then %let
18755 +    _str = if _CLUSTER_ = &clusters then _CLUSTER_ = .;
18756 +  %else %let _str = ;
18757 +  %if %str(&freqDS) ^= %str() %then %do;
18758 +   %let newfreqDS = &freqDS(keep=_c1-_c&clusters);
18759 +   %let _flag = 1;
18760 +  %end;
18761 +  %else %let _flag = 0;
18762 +
18763 +  %if &compress = 1 %then %let compress = compress=Y;
18764 +  %else %let compress = ;
18765 +
18766 +  data &outds(&compress drop=_c1-_c&clusters)
18767 +    %if &_flag = 1 %then %do;
18768 +    &newfreqDS
18769 +    %end;
18770 +    ;
18771 +    set &inds end=eof;
18772 +   * array for holding all probabilities;
18773 +    array _p prob1--prob&clusters;
18774 +    array _c(&clusters);
18775 +    retain _c 0;
18776 +   * get rid of working columns;
18777 +    drop _max_ _i /*prob1--prob&clusters*/ _WARN_;
18778 +    /* keep the largest probability and the cluster */
18779 +    _max_ = 0;
18780 +    do _i = 1 to &clusters;
18781 +      if _p(_i) > _max_ then do;
18782 +        _max_ = _p(_i);
18783 +        _CLUSTER_ = _i;
18784 +      end;
18785 +    end;
18786 +    if (_CLUSTER_ >= 1) and (_CLUSTER_ <= &clusters) then
18787 +      _c(_CLUSTER_) = _c(_CLUSTER_) + 1;
18788 +    else _CLUSTER_ = .;
18789 +    &_str;
18790 +    %if &_flag = 1 %then %do;
18791 +      if eof then do;
18792 +        output &freqDS;
18793 +                output &outDS;
18794 +          end;
18795 +          else output &outDS;
18796 +        %end;
18797 +
18798 +    run;
18799 +%mend tmpred;
NOTE: %INCLUDE (level 1) ending.
NOTE: %INCLUDE (level 1) file TEMP is file SASHELP.EMTEXT.TMSORT.SOURCE.
18800 + /*
18801 +PROC SORT macro
18802 +
18803 +%tmsort(data=, out=, by=);
18804 +
18805 +data=      - name of input data set (outtree data set from PROC CLUSTER)
18806 +out=       - name of the output data set
18807 +by=        - by statement
18808 +options=   - proc options
18809 +*/
18810 +
18811 +%macro tmsort(data=, out=, by=, options=, threads=THREADS);
18812 +  %if %BQUOTE(&out) ^= %then %let out = out =  &out;
18813 +  %if &SYSVER < 9 %then %let threads = ;
18814 +
18815 +  proc sort data = %STR(&data) &threads &options
18816 +    &out;
18817 +    by &by;
18818 +  run;
18819 +
18820 +%mend tmsort;
NOTE: %INCLUDE (level 1) ending.
NOTE: %INCLUDE (level 1) file TEMP is file SASHELP.EMTXTEXT.TMC_DOC_SCORE.SOURCE.
18821 +/*****************************************************************************
18822 +*
18823 +* tmc_doc_score
18824 +*
18825 +*  import  =  the doc data set of _document_ ids's as input
18826 +*  export = the new doc dataset with the svd dimensions and cluster results as output
18827 +*  termds = the terms table as input
18828 +*  clusters = input dataset of clusters from train
18829 +*  emoutstat = input dataset of seeds from training
18830 +*  _scrout = input OUT data set to be scored, may be trimmed based on conent of termds
18831 +*  svd_u = input singular vectors
18832 +
18833 +
18834 +*  svd_s = input singular values
18835 +*  prefxi = variable prefix string identifier.
18836 +*
18837 +**************************************************************************************/
18838 +
18839 +%macro tmc_doc_score(import=,export=,termds=,export_out=,clusters=,emoutstat=,
18840 +                 _scrout=,svd_u=,svd_s=,configds=,prefix=, outclusters=,hierds=,
18841 +                filterterms=,filtertmout=, descterms=);
18842 +
18843 +   %if ^%symexist(tm_debug) %then %let tm_debug=0;
18844 +
18845 +    proc sql noprint;
18846 +        select cellwgt into: cellwgt
18847 +            from &configds;
18848 +        select clus_alg into: algorithm
18849 +            from &configds;
18850 +        select parseVar into :textvar
18851 +            from &configds;
18852 +        select count(*) into :nclus
18853 +            from &clusters;
18854 +        select count(*) into :svdkeep
18855 +            from &svd_s
18856 +            where keep=1;
18857 +    quit;
18858 +
18859 +    %let svdkeep=%left(&svdkeep);
18860 +    %let nclus=%left(&nclus);
18861 +    %let algorithm=%left(&algorithm);
18862 +    %Let cellwgt=%left(&cellwgt);
18863 +    data _import_ds;
18864 +        set &import;
18865 +    run;
18866 +
18867 +
18868 +    %tmsort(data=&termds(where=(keep='Y')), out=_terms(keep= KEY PARENT),
18869 +            by=KEY);
18870 +    %tmsort(data=&_scrout, out=&_scrout, by=_termnum_);
18871 +
18872 +    data _svdm1;
18873 +        merge _terms (where=(PARENT ne _termnum_) in=_b_ keep=KEY PARENT rename=(KEY=_TERMNUM_))
18874 +              &_scrout (in = _A_ rename=(_COUNT_=COUNT));
18875 +        by _termnum_;
18876 +        if _B_;
18877 +        if (_A_ and _B_ and (PARENT ne .))
18878 +          then _TERMNUM_ = PARENT;
18879 +
18880 +        keep _TERMNUM_ _DOCUMENT_ COUNT;
18881 +        if (_DOCUMENT_=.) or (COUNT=.) then delete;
18882 +    run;
18883 +
18884 +    proc sql ;
18885 +       create table _scrout as select distinct _TERMNUM_, _DOCUMENT_,
18886 +        sum(COUNT) as _COUNT_ from _svdm1
18887 +        group by _TERMNUM_, _DOCUMENT_;
18888 +
18889 +       drop table _svdm1;
18890 +       drop table _terms;
18891 +    quit;
18892 +
18893 +    %tmsort(data=&termds(where=(KEEP='Y' and PARENT=.)),
18894 +         out=_weights (rename=(KEY=INDEX WEIGHT=GWGT) keep=KEY WEIGHT),
18895 +         by=KEY, options=, threads=);
18896 +
18897 +
18898 +    %tmsort(data=_scrout, out=_scrout, by=_DOCUMENT_, options=, threads=);
18899 +      %let svdkeep=%left(&svdkeep);
18900 +      data &svd_u;
18901 +         set &svd_u(keep= index col1-col&svdkeep);
18902 +      run;
18903 +
18904 +      proc sql;
18905 +         create table  _inweights as
18906 +         select a.*
18907 +         from _weights a right join &svd_u b
18908 +         on a.index=b.index
18909 +         ;
18910 +       quit;
18911 +    %if %lowcase(&cellwgt) = bin %then %let cellwgt=BINARY;
18912 +    proc spsvd data=_scrout IN_U=&svd_u
18913 +        local = &cellwgt global = none in_global = _inweights ;
18914 +        row _TERMNUM_;
18915 +        col _DOCUMENT_;
18916 +        entry _COUNT_;
18917 +        output colpro=_COLPRO bigpro normcol prefix="&prefix._SVD";
18918 +    run;
18919 +    proc sort data=_import_ds;
18920 +    by _DOCUMENT_; run;
18921 +
18922 +    proc sort data=_colpro;
18923 +    by INDEX;
18924 +    run;
18925 +
18926 +    data &export;
18927 +        merge _import_ds (in=_C_ ) _colpro (rename=(INDEX=_DOCUMENT_));
18928 +        by _DOCUMENT_;
18929 +        if _C_;
18930 +    run;
18931 +
18932 +    data &export;
18933 +       set  &export;
18934 +       array svd_array &prefix._SVD1 - &prefix._SVD&svdkeep.;
18935 +       do i = 1 to dim(svd_array);
18936 +          if svd_array(i)=. then svd_array(i)=0;
18937 +       end;
18938 +       drop i;
18939 +    run;
18940 +
18941 +
18942 +    %tmsort(data=&export, out=, by=_document_, options=, threads=);
18943 +
18944 +    %if %left(&algorithm)=1.0 %then %do;
18945 +
18946 +        %tmemclus(data=&export,
18947 +            role=SCORE, clusters=&nclus,
18948 +            seed=&emoutstat,
18949 +            outstat=, out=&export,
18950 +            vars=%STR(&prefix._SVD1 - &prefix._SVD&SVDKEEP),
18951 +            cov=, iter=5, secclus=,
18952 +            seciter=, min=, method=, eps=.1, init=, print=,
18953 +            p=, outliers=, decvar=0,
18954 +            initstd=, dist=, secstd=, nobs=);
18955 +        run;
18956 +
18957 +        %tmpred(&export, &export, &nclus, type=, ignore=0,
18958 +                  freqDS=, compress=1);
18959 +
18960 +        data &export;
18961 +           set &export;
18962 +           rename prob1-prob&nClus = &prefix._prob1-&prefix._prob&nclus;
18963 +           rename _cluster_=&prefix._cluster_;
18964 +        run;
18965 +
18966 +        %if &outclusters ne %then %do;
18967 +              %let memloc = _tmmem;
18968 +              proc tmutil data=&_scrout key=&filterterms ;
18969 +                 control init memloc="&memloc" release;
18970 +                 output keeponly out=_outtmutil;
18971 +              run;
18972 +
18973 +              data _docdata;
18974 +                 set &export (rename=(&prefix._cluster_=cluster));
18975 +              run;
18976 +
18977 +              /* Recalculate desc terms */
18978 +              data _terms_;
18979 +               set &filterterms;
18980 +               by key _ispar;
18981 +               if first.key then
18982 +                output;
18983 +               else;
18984 +              run;
18985 +
18986 +              data _terms_;
18987 +               set _terms_;
18988 +               if _ispar='+' then
18989 +                  Term=_ispar || ' ' || term;
18990 +              run;
18991 +
18992 +             %tmsort(data=_outtmutil,
18993 +               out=_tmout_,
18994 +               by=_termnum_,
18995 +                  options=,
18996 +               threads=threads);
18997 +
18998 +
18999 +             data _tmout_;
19000 +               merge _tmout_ (in=_A_)
19001 +                  _terms_ (rename=(key=_termnum_ term=_term_) keep=key term );
19002 +               by _termnum_;
19003 +               if _A_;
19004 +             run;
19005 +
19006 +             data _docs_;
19007 +               set _docdata (rename=(cluster=_cluster_) keep=_document_ cluster);
19008 +               _SEGMNT_=_cluster_;
19009 +             run;
19010 +
19011 +             %tmterm1(DSN_TPARS=_tmout_,
19012 +              DSN_CLUS=_docs_,
19013 +              DSN_DESC=_desc_,
19014 +              N_DESC_TERMS=&descterms,
19015 +              N_CLUS=&nclus,
19016 +              top_freq=%eval(&descterms*2),
19017 +              key=);
19018 +
19019 +             %tmsort(data=_desc_,
19020 +               out=_desc_,
19021 +               by=_cluster_,
19022 +                  options=,
19023 +               threads=threads);
19024 +
19025 +             proc sql noprint;
19026 +               create table &outclusters as
19027 +                 select a.clus_desc, b.* from &outclusters b left join _desc_ a
19028 +                 on a._cluster_=b._cluster_;
19029 +             quit;
19030 +
19031 +       %end;
19032 +
19033 +    %end;
19034 +    %else %do;
19035 +
19036 +        data _clustermean;
19037 +            set &clusters(keep=_cluster_ _mean1-_mean&svdkeep. freq);
19038 +        run;
19039 +
19040 +        proc sql;
19041 +        create table _meandocs as
19042 +            select a.*, b.*
19043 +            from &export(keep=&prefix._SVD1 - &prefix._SVD&SVDKEEP _document_) a , _clustermean b;
19044 +        quit;
19045 +
19046 +
19047 +        proc sort data=_meandocs;
19048 +        by _document_;
19049 +        run;
19050 +
19051 +        %if (&syscc>4) %then %do;
19052 +            %let emexceptionstring=EMTOOL.INSUFFICIENTMEM;
19053 +            %goto end_tmc;
19054 +        %end;
19055 +
19056 +        %tmsort(data=_meandocs,out=,by=_document_);
19057 +
19058 +          data _docdata(drop=_mean1-_mean&svdkeep. j _CLUSTER_ _freq_ rename=(_cluster_=&prefix._cluster_ distance=&prefix._distance));
19059 +            set _meandocs;
19060 +            drop _minDist_ _dist_ j freq;
19061 +            label CLUSTER = 'Cluster ID';
19062 +            array _means(&svdkeep) _mean1-_mean&svdkeep.;
19063 +            array _cols(&svdkeep) &prefix._SVD1-&prefix._SVD&svdkeep.;
19064 +            by _document_;
19065 +            retain CLUSTER _mindist_;
19066 +            _dist_ = 0;
19067 +            /* innner product*/
19068 +            do j = 1 to &svdkeep;
19069 +                _dist_ = _dist_ + (_cols(j)-_means(j))*(_cols(j)-_means(j));
19070 +            end;
19071 +
19072 +            /* initialization*/
19073 +            if first._document_ then do;
19074 +                _minDist_ = _dist_;
19075 +                CLUSTER = _cluster_;
19076 +            end;
19077 +            /*optimization*/
19078 +            if (_dist_ < _minDist_) then do;
19079 +                _minDist_ = _dist_;
19080 +                CLUSTER = _cluster_;
19081 +            end;
19082 +            if last._document_ then do;
19083 +               output;
19084 +            end;
19085 +        run;
19086 +        proc sort data=_docdata;
19087 +           by _document_;
19088 +        proc sort data=&export;
19089 +           by _document_;
19090 +        run;
19091 +
19092 +        data &export;
19093 +           merge &export _docdata;
19094 +           by _document_;
19095 +           rename cluster=&prefix._cluster_;
19096 +        run;
19097 +    %end;
19098 +
19099 +    /* Reorder variables in exported data set */
19100 +    proc sql noprint;
19101 +        create table &export as
19102 +        select &textvar, &prefix._cluster_, *
19103 +        from &export;
19104 +    quit;
19105 +
19106 +
19107 +    %if &outclusters ne %then %do;
19108 +
19109 +        /* update freqencies in cluster table */
19110 +         proc freq data =_docdata ;
19111 +            tables cluster/out=_tempfreqtable;
19112 +         run;
19113 +
19114 +        proc sql noprint;
19115 +            create table &outclusters as
19116 +            select  a.*, b.count as freq, b.percent/100 as percent
19117 +            from &clusters (drop= freq percent _rmsstd_) a, _tempfreqtable b
19118 +           where a._cluster_=b.cluster;
19119 +
19120 +        quit;
19121 +
19122 +        %if %left(&algorithm)=2.0 %then %do;
19123 +
19124 +          proc sql noprint;
19125 +
19126 +             create table &hierds as select a.freq, b.*
19127 +                from &outclusters a right join &hierds b on a._cluster_=b._cluster_;
19128 +          quit;
19129 +
19130 +          /* Find descriptive terms for clusters & parents */
19131 +          filename temp catalog 'sashelp.emtxtext.tmgethierterms.source';
19132 +          %include temp;
19133 +          filename temp;
19134 +
19135 +          %tm_getHierTerms(hierds=&hierds,
19136 +                         docs=_docdata,
19137 +                         tmout=&filtertmout,
19138 +                         terms= &filterterms,
19139 +                         ndescterms=&descterms);
19140 +
19141 +          proc sql noprint;
19142 +             create table &outclusters as
19143 +                select a.clus_desc, b.* from &hierds a, &outclusters b
19144 +                where a._cluster_=b._cluster_;
19145 +
19146 +             update &hierds set freq=0 where clus_desc="" and _cluster_ ne 1;
19147 +          quit;
19148 +
19149 +          /* Add frequencies to ancestors */
19150 +          data _hd;
19151 +             set &hierds;
19152 +             cluster=_cluster_;
19153 +             drop _cluster_ parent;
19154 +          run;
19155 +
19156 +          %let empty=1;
19157 +
19158 +          %do %while (&empty);
19159 +
19160 +            proc sql noprint;
19161 +                update _hd set freq=
19162 +                    (select sum(freq) from &HIERDS
19163 +                    where parent=cluster)
19164 +                    where freq=. and cluster not in
19165 +                    (select parent from &hierds where freq=.);
19166 +                select count(*) into :empty from _hd
19167 +                    where freq=.;
19168 +                update &hierds set freq=(select freq from _hd where _cluster_=cluster);
19169 +            quit;
19170 +
19171 +          %end;
19172 +
19173 +          /* Set graphdesc variable for graph display */
19174 +          data &hierds(drop=plus pos sub);
19175 +            set &hierds;
19176 +            plus='';
19177 +            if substr(CLUS_DESC, 1, 1) = "+" then plus="+ ";
19178 +            if ktrim(clus_desc) ne "" then do;
19179 +              if(substr(CLUS_DESC, 1, 1)) = "'" then do;
19180 +                 pos = findc(CLUS_DESC, "'",2);
19181 +                 sub = substr(CLUS_DESC,1,pos);
19182 +              end;
19183 +              else sub = scan(CLUS_DESC, 1);
19184 +              graphdesc=_CLUSTER_ || ': ' || plus || sub;
19185 +            end;
19186 +            else graphdesc=_CLUSTER_;
19187 +          run;
19188 +        %end;
19189 +
19190 +         /*calculate residual for each doc */
19191 +
19192 +         proc sort data=_docdata (rename=(cluster=_cluster_));
19193 +            by _cluster_;
19194 +         run;
19195 +
19196 +         data _rmscalc;
19197 +            merge _docdata(in=inhere) &outclusters;
19198 +            array _means(&svdkeep) _mean1-_mean&svdkeep.;
19199 +            array _svds(&svdkeep) &prefixstring._SVD1 - &prefixstring._SVD&svdkeep.;
19200 +            by _cluster_;
19201 +            error=0;
19202 +            do i = 1 to &svdkeep;
19203 +               error +( (_svds{i}-_means{i}) * (_svds{i}-_means{i}));
19204 +            end;
19205 +
19206 +            drop i ;
19207 +         run;
19208 +
19209 +          /*calc standardized residual for clusters*/
19210 +         proc summary data=_rmscalc nway;
19211 +            class _cluster_;
19212 +            var error;
19213 +            output out=_meanerr mean=meane sum=sume;
19214 +         run;
19215 +
19216 +         data _rmsse;
19217 +            set _meanerr;
19218 +            /* original code divides by number of svd dims*/
19219 +            if _freq_ gt 1 then do;
19220 +              _rmsstd_=sqrt(sume/((_freq_-1)*(&svdkeep.)));
19221 +            end;
19222 +            else do;
19223 +              _rmsstd_=0;
19224 +            end;
19225 +            keep _cluster_  _rmsstd_;
19226 +         run;
19227 +
19228 +
19229 +         proc sql noprint;
19230 +           create table _clusstat2 as
19231 +           select a.*,b.*
19232 +           from &outclusters a left join _rmsse b
19233 +           on a._cluster_=b._cluster_;
19234 +
19235 +           create table &outclusters as
19236 +           select * from _clusstat2;
19237 +         quit;
19238 +
19239 +
19240 +    %end;
19241 +
19242 +
19243 +%end_tmc:
19244 +    %if &tm_debug =0  %then %do;
19245 +    proc sql noprint;
19246 +        drop table _weights;
19247 +        drop table _colpro;
19248 +        drop table _scrout;
19249 +        drop table _svdm1;
19250 +        drop table _inweights;
19251 +        drop table _clustermean;
19252 +        drop table _clusstat2;
19253 +        drop table _outtmutil;
19254 +        drop table _rmscalc;
19255 +        drop table _rmsse;
19256 +        drop table _meanerr;
19257 +        drop table _meandocs;
19258 +        drop table _import_ds;
19259 +        drop table _hd;
19260 +        drop table _terms_;
19261 +        drop table _docs_;
19262 +        drop table _tmout_;
19263 +        drop table _desc_;
19264 +        drop table _docdata;
19265 +    quit;
19266 +    %end;
19267 +
19268 +%mend tmc_doc_score;
19269 +
19270 +
19271 +
19272 +
19273 +
19274 +
19275 +
19276 +
19277 +
19278 +
19279 +
19280 +
19281 +
19282 +
19283 +
19284 +
19285 +
19286 +
19287 +
19288 +
19289 +
NOTE: %INCLUDE (level 1) ending.
NOTE: %INCLUDE (level 1) file TEMP is file SASHELP.EMTEXT.TMSVD.SOURCE.
19291 + /*
19293 +  Macro:     tmsvd.sas
19294 +  Purpose:  Call proc spsvd with given defaults and parameters.
19295 +  Syntax:   %tmsvd(in,k=,global=,local=,row=,col=,entry=,scaleOp=,normOp=,
19296 +            in_global=,in_u=,in_s=,in_v=,u=,s=,v=,wgt=,wordPro=,
19297 +           colPro=, p=, tol=, gwgt=, mink=, maxk=, res=, remote=, compact=,bigpro=0);
19299 +  Required Parameters:  in     The data= data set.
19300 +  Optional Parameters:  k= The number of dimensions to reduce to
19301 +                   global=  The global weight to use, defaults to IDF.
19302 +                   local=  The local weight to use, defaults to BINARY.
19303 +                   row=   Column in the input data set that represents
19304 +                          the matrix row,
19305 +                       defaults to _termnum_.
19306 +            col=   Column in the input data set that represents
19307 +                          the matrix column,
19308 +                         defaults to _document_.
19309 +            entry= Column in the input data set that represents the
19310 +                          value in the
19311 +                         given row,column cell.  Defaults to _count_.
19312 +             scaleOp= Scale options: scalerow scalecol scaleall
19313 +            normOp=  Normalization options: normrow normcol normall
19314 +            in_global= The gwgt= output data set from a prior spsvd run.
19315 +                   in_u=  The u= output from a prior spsvd run.
19316 +                   in_s=  The s= output from a prior spsvd run.
19317 +                   in_v=  The v= output from a prior spsvd run.
19318 +                   u=     matrix U data set
19319 +                   s=     matrix S data set
19320 +                   v=     matrix V data set
19321 +                  wgt=   weighted input matrix data set
19322 +                  wordPro= projections of rows of A onto columns of V
19323 +                  colPro=  projection of columns of A onto columns of U
19324 +                  p=   number of iterations
19325 +                  tol= convergence tolerance
19326 +                   gwgt= global weights data set
19327 +                  mink=
19328 +                  maxk=
19329 +                  res=
19330 +                  remote= name of file
19332 +  History:
19333 +  2001/01/16 - Kevin Daly - Initial coding.
19334 +  2001/01/19 - Kevin Daly - Fixed so that when global=NONE and local=NONE,
19335 +             no gwgt data set
19336 +               is requested.  This was causing an error and the proc
19337 +              would terminate.
19338 +  2001/02/21 - Bill Wheeler - Allowd all options to be specified
19339 +  2001/05/14 - Bill Wheeler - Added version 9 options min_k, max_k, resolution
19340 +  2001/08/14 - Bill Wheeler - Added remote option
19341 +  2001/11/29 - Bill Wheeler - Updated for version 8 or 9
19342 +*/
19344 +%macro tmsvd(in,k=,global=,local=,row=,col=,entry=,scaleOp=,normOp=,
19345 +             in_global=, in_u=, in_s=, in_v=, u=, s=, v=,
19346 +             wgt=, wordPro=, colPro=, p=, tol=, gwgt=, mink=, maxk=, res=,
19347 +             remote=, compact=,bigpro= );
19349 +  %put;
19350 +  /* Defaults */
19351 +  %if &k ^= %then %let k = k = &k;
19352 +  %if &global ^= %then %let global = global = &global;
19353 +  %if %lowcase(&local) = bin %then %let local=BINARY;
19354 +  %if &local ^= %then %let local=local=&local;
19355 +  %if &row= %then %let row=_termnum_;
19356 +  %if &col= %then %let col=_document_;
19357 +  %if &entry= %then %let entry=_count_;
19358 +  %if &scaleOp ^= %then %let scaleOp = scaledoc;
19359 +  %if &normOp ^= %then %let normOp = normdoc;
19360 +  %if &compact ^= %then %let compact = compact;
19361 +  %else %let compact = ;
19363 +  %if &in_global ^= %then %let in_global = in_global=&in_global;
19364 +  %if &in_u ^= %then %let in_u = in_u=&in_u;
19365 +  %if &in_s ^= %then %let in_s = in_s=&in_s;
19366 +  %if &in_v ^= %then %let in_v = in_v=&in_v;
19367 +  %if ((&p ^= ) and (&p ^= .)) %then %let p = p=&p;
19368 +  %else %let p = ;
19369 +  %if ((&tol ^= ) and (&tol ^= .)) %then %let tol = tol=&tol;
19370 +  %else %let tol = ;
19372 +  %IF &SYSVER < 9 %THEN %DO;
19373 +    %IF &k = %THEN %DO;
19374 +      %IF &maxk ^= %THEN %LET k = k = &maxk;
19375 +      %ELSE %LET k = k = 100;
19376 +    %END;
19377 +    %LET mink = ;
19378 +    %LET maxk = ;
19379 +    %LET res = ;
19380 +    %LET remote = ;
19381 +    %LET compact = ;
19382 +  %END;
19385 +  %if &colPro ^= %then %let colPro = COLPRO=&colPro;
19386 +  %if &gwgt ^= %then %let gwgt = GWGT=&gwgt;
19387 +  %if &s ^= %then %let s = S=&s;
19388 +  %if &u ^= %then %let u = U=&u;
19389 +  %if &v ^= %then %let v = V=&v;
19390 +  %if &wordPro ^= %then %let wordPro = WORDPRO=&wordPro;
19391 +  %if &wgt ^= %then %let wgt = WGT=&wgt;
19392 +  %if (&mink ^=  ) and (&mink ^= .) %then %let mink = min_k = &mink;
19393 +  %else %let mink = ;
19394 +  %if &maxk ^= %then %let maxk = max_k = &maxk;
19395 +  %if &res ^= %then %let res = res = &res;
19396 +  proc sort data=&in; by &col;
19397 +  /* Run the proc */
19398 +  proc spsvd data=&in
19399 +      &mink
19400 +      &maxk
19401 +      &res
19402 +      &k &compact
19403 +    &local &global &in_global
19404 +    &in_u &in_s &in_v &p &tol;
19405 +    row &row; col &col; entry &entry;
19406 +      output &colPro &gwgt &normOp &scaleOp &s &u &v
19407 +           &wordPro &wgt &bigpro;
19408 +    &remote;
19409 +  run;
19411 +%mend tmsvd;
NOTE: %INCLUDE (level 1) ending.
NOTE: %INCLUDE (level 1) file TEMP is file SASHELP.EMTEXT.TMFAST.SOURCE.
19412 + /*
19413 +
19414 +  Macro:   tmfast.sas
19415 +  Purpose: Call proc fastclus with given defaults and parameters.
19416 +  Syntax:  %tmfast(data=, clusters=, outstat=, vars=);
19417 +
19418 +  Required Parameters:  data=      The input data set.
19419 +                        clusters=  The maximum number of clusters
19420 +
19421 +  Optional Parameters:  vars=      Variables to be used
19422 +                        outstat=   The name of the OUTSTAT data set
19423 +                        outseed=   The name of the OUTSEED data set
19424 +
19425 +  Either outstat or outseed mut be given, but not both.
19426 +  History:
19427 +  2001/01/16 - Bill Wheeler - Initial Coding.
19428 +
19429 +*/
19430 +%MACRO tmfast(data=, clusters=, outstat=, outseed=,
19431 +                 id=, out=, vars=);
19432 + /* defaults */
19433 + %if (&id ne ) %then %let id = id &id;
19434 + %if (&out ne ) %then %let out = out = &out;
19435 + %if (&vars ne ) %then %let var = var &vars;
19436 + %else %let var = ;
19437 +
19438 + %if &outseed= %then
19439 + %do;
19440 +   proc fastclus data = &data
19441 +   maxclusters = &clusters noprint
19442 +   outstat = &outstat &out;
19443 +   &var;
19444 +   &id;
19445 + %end;
19446 + %else
19447 + %do;
19448 +   proc fastclus data = &data
19449 +   maxclusters = &clusters noprint
19450 +   outseed = &outseed &out;
19451 +   &var;
19452 +   &id;
19453 + %end;
19454 +%MEND tmfast;
NOTE: %INCLUDE (level 1) ending.
NOTE: Table WORK._CLUSTERMS created, with 16666 rows and 9 columns.
 
NOTE: PROCEDURE SQL used (Total process time):
      real time           0.01 seconds
      cpu time            0.01 seconds
 
 
 
NOTE: There were 218546 observations read from the data set EMWS3.TEXTFILTER7_TMOUT.
NOTE: The data set WORK._FILTER_TMOUT has 218546 observations and 3 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.00 seconds
 
 
NOTE: PROCEDURE SQL used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 674 observations read from the data set EMWS3.TEXTPARSING_TRAIN.
NOTE: There were 674 observations read from the data set EMWS3.TEXTFILTER7_DOC_IDS.
NOTE: There were 674 observations read from the data set EMWS3.TEXTFILTER7_TRAIN.
NOTE: The data set WORK._IMPORT_DS has 674 observations and 5 variables.
NOTE: DATA statement used (Total process time):
      real time           0.09 seconds
      cpu time            0.01 seconds
 
 
 
NOTE: Input data set is already sorted; it has been copied to the output data set.
NOTE: There were 16666 observations read from the data set WORK._CLUSTERMS.
      WHERE keep='Y';
NOTE: The data set WORK._TERMS has 16666 observations and 2 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.00 seconds
      cpu time            0.01 seconds
 
 
 
NOTE: There were 218546 observations read from the data set WORK._FILTER_TMOUT.
NOTE: The data set WORK._FILTER_TMOUT has 218546 observations and 3 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.03 seconds
      cpu time            0.01 seconds
 
 
 
NOTE: There were 13209 observations read from the data set WORK._TERMS.
      WHERE PARENT not = _termnum_;
NOTE: There were 218546 observations read from the data set WORK._FILTER_TMOUT.
NOTE: The data set WORK._SVDM1 has 218546 observations and 3 variables.
NOTE: DATA statement used (Total process time):
      real time           0.04 seconds
      cpu time            0.00 seconds
 
 
NOTE: Table WORK._SCROUT created, with 205198 rows and 3 columns.
 
NOTE: Table WORK._SVDM1 has been dropped.
NOTE: Table WORK._TERMS has been dropped.
NOTE: PROCEDURE SQL used (Total process time):
      real time           0.08 seconds
      cpu time            0.06 seconds
 
 
 
NOTE: Input data set is already sorted; it has been copied to the output data set.
NOTE: There were 8502 observations read from the data set WORK._CLUSTERMS.
      WHERE (KEEP='Y') and (PARENT=.);
NOTE: The data set WORK._WEIGHTS has 8502 observations and 2 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 205198 observations read from the data set WORK._SCROUT.
NOTE: The data set WORK._SCROUT has 205198 observations and 3 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.03 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 8502 observations read from the data set EMWS3.TEXTCLUSTER13_SVD_U.
NOTE: The data set EMWS3.TEXTCLUSTER13_SVD_U has 8502 observations and 101 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.00 seconds
 
 
NOTE: Table WORK._INWEIGHTS created, with 8502 rows and 2 columns.
 
NOTE: PROCEDURE SQL used (Total process time):
      real time           0.02 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 205198 observations read from the data set WORK._SCROUT.
NOTE: There were 8502 observations read from the data set EMWS3.TEXTCLUSTER13_SVD_U.
NOTE: There were 8502 observations read from the data set WORK._INWEIGHTS.
NOTE: The data set WORK._COLPRO has 673 observations and 101 variables.
NOTE: PROCEDURE SPSVD used (Total process time):
      real time           0.13 seconds
      cpu time            0.04 seconds
 
 
 
NOTE: There were 674 observations read from the data set WORK._IMPORT_DS.
NOTE: The data set WORK._IMPORT_DS has 674 observations and 5 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.06 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 673 observations read from the data set WORK._COLPRO.
NOTE: The data set WORK._COLPRO has 673 observations and 101 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 674 observations read from the data set WORK._IMPORT_DS.
NOTE: There were 673 observations read from the data set WORK._COLPRO.
NOTE: The data set EMWS3.TEXTCLUSTER13_TRAIN has 674 observations and 105 variables.
NOTE: DATA statement used (Total process time):
      real time           0.02 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 674 observations read from the data set EMWS3.TEXTCLUSTER13_TRAIN.
NOTE: The data set EMWS3.TEXTCLUSTER13_TRAIN has 674 observations and 105 variables.
NOTE: DATA statement used (Total process time):
      real time           0.03 seconds
      cpu time            0.01 seconds
 
 
 
NOTE: There were 674 observations read from the data set EMWS3.TEXTCLUSTER13_TRAIN.
NOTE: The data set EMWS3.TEXTCLUSTER13_TRAIN has 674 observations and 105 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.08 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 674 observations read from the data set EMWS3.TEXTCLUSTER13_TRAIN.
NOTE: There were 17 observations read from the data set EMWS3.TEXTCLUSTER13_EMOUTSTAT.
NOTE: The data set EMWS3.TEXTCLUSTER13_TRAIN has 674 observations and 114 variables.
NOTE: PROCEDURE EMCLUS used (Total process time):
      real time           0.03 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 674 observations read from the data set EMWS3.TEXTCLUSTER13_TRAIN.
NOTE: The data set EMWS3.TEXTCLUSTER13_TRAIN has 674 observations and 114 variables.
NOTE: Compressing data set EMWS3.TEXTCLUSTER13_TRAIN decreased size by 69.35 percent.
      Compressed is 19 pages; un-compressed would require 62 pages.
NOTE: DATA statement used (Total process time):
      real time           0.05 seconds
      cpu time            0.04 seconds
 
 
 
NOTE: There were 674 observations read from the data set EMWS3.TEXTCLUSTER13_TRAIN.
NOTE: The data set EMWS3.TEXTCLUSTER13_TRAIN has 674 observations and 114 variables.
NOTE: DATA statement used (Total process time):
      real time           0.02 seconds
      cpu time            0.01 seconds
 
 
 
NOTE: There were 218546 observations read from the data set WORK._FILTER_TMOUT.
NOTE: There were 16666 observations read from the data set EMWS3.TEXTFILTER7_TERMS_DATA.
      WHERE KEEP='Y';
NOTE: There were 73331 observations read from the data set EMWS3.TEXTFILTER7_TERM_STRINGS.
NOTE: The data set WORK._OUTTMUTIL has 205198 observations and 3 variables.
NOTE: PROCEDURE TMUTIL used (Total process time):
      real time           0.19 seconds
      cpu time            0.07 seconds
 
 
 
NOTE: There were 674 observations read from the data set EMWS3.TEXTCLUSTER13_TRAIN.
NOTE: The data set WORK._DOCDATA has 674 observations and 114 variables.
NOTE: DATA statement used (Total process time):
      real time           0.03 seconds
      cpu time            0.01 seconds
 
 
 
NOTE: There were 16666 observations read from the data set EMWS3.TEXTFILTER7_TERMS_DATA.
      WHERE KEEP='Y';
NOTE: There were 73331 observations read from the data set EMWS3.TEXTFILTER7_TERM_STRINGS.
NOTE: There were 16666 observations read from the data set EMWS3.TEXTFILTER7_TERMS.
NOTE: The data set WORK._TERMS_ has 13209 observations and 13 variables.
NOTE: DATA statement used (Total process time):
      real time           0.08 seconds
      cpu time            0.03 seconds
 
 
 
NOTE: There were 13209 observations read from the data set WORK._TERMS_.
NOTE: The data set WORK._TERMS_ has 13209 observations and 13 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 205198 observations read from the data set WORK._OUTTMUTIL.
NOTE: The data set WORK._TMOUT_ has 205198 observations and 3 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.04 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 205198 observations read from the data set WORK._TMOUT_.
NOTE: There were 13209 observations read from the data set WORK._TERMS_.
NOTE: The data set WORK._TMOUT_ has 205198 observations and 4 variables.
NOTE: DATA statement used (Total process time):
      real time           0.08 seconds
      cpu time            0.06 seconds
 
 
 
NOTE: There were 674 observations read from the data set WORK._DOCDATA.
NOTE: The data set WORK._DOCS_ has 674 observations and 3 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.00 seconds
 
 
NOTE: SQL view WORK._CMB has been defined.
NOTE: PROCEDURE SQL used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 205198 observations read from the data set WORK._TMOUT_.
NOTE: There were 674 observations read from the data set WORK._DOCS_.
NOTE: There were 205198 observations read from the data set WORK._CMB.
NOTE: The data set WORK._TFREQ has 34617 observations and 5 variables.
NOTE: PROCEDURE SUMMARY used (Total process time):
      real time           0.10 seconds
      cpu time            0.04 seconds
 
 
 
NOTE: There were 205198 observations read from the data set WORK._TMOUT_.
NOTE: There were 674 observations read from the data set WORK._DOCS_.
NOTE: There were 205198 observations read from the data set WORK._CMB.
NOTE: The data set WORK._SUM has 9 observations and 4 variables.
NOTE: PROCEDURE SUMMARY used (Total process time):
      real time           0.06 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 9 observations read from the data set WORK._SUM.
NOTE: DATA statement used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
 
 
NOTE: Table WORK._SUM has been dropped.
NOTE: PROCEDURE SQL used (Total process time):
      real time           0.00 seconds
      cpu time            0.01 seconds
 
 
 
NOTE: There were 34617 observations read from the data set WORK._TFREQ.
NOTE: The data set WORK._TFREQ has 34617 observations and 5 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.06 seconds
      cpu time            0.04 seconds
 
 
 
NOTE: There were 34617 observations read from the data set WORK._TFREQ.
NOTE: The data set WORK._UNQT has 240 observations and 3 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 240 observations read from the data set WORK._UNQT.
NOTE: 139 observations with duplicate key values were deleted.
NOTE: The data set WORK._UNQT has 101 observations and 1 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.02 seconds
      cpu time            0.00 seconds
 
 
NOTE: Table WORK._CLCDF created, with 786 rows and 3 columns.
 
NOTE: PROCEDURE SQL used (Total process time):
      real time           0.02 seconds
      cpu time            0.00 seconds
 
 
NOTE: Table WORK._UNQT has been dropped.
NOTE: Table WORK._TFREQ has been dropped.
NOTE: PROCEDURE SQL used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 786 observations read from the data set WORK._CLCDF.
NOTE: The data set WORK._CLCDF has 101 observations and 10 variables.
NOTE: PROCEDURE TRANSPOSE used (Total process time):
      real time           0.01 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 101 observations read from the data set WORK._CLCDF.
NOTE: The data set WORK._CLCDF has 101 observations and 18 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 101 observations read from the data set WORK._CLCDF.
NOTE: The data set WORK._CLCDFTR has 786 observations and 4 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.01 seconds
 
 
NOTE: Table WORK._CLCDF has been dropped.
NOTE: PROCEDURE SQL used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 786 observations read from the data set WORK._CLCDFTR.
NOTE: The data set WORK._CLCDFTR has 786 observations and 4 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.01 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 786 observations read from the data set WORK._CLCDFTR.
NOTE: The data set WORK._DESC_ has 8 observations and 2 variables.
NOTE: DATA statement used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
 
 
NOTE: Table WORK._CLCDFTR has been dropped.
NOTE: View WORK._CMB has been dropped.
NOTE: PROCEDURE SQL used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 8 observations read from the data set WORK._DESC_.
NOTE: The data set WORK._DESC_ has 8 observations and 2 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.01 seconds
      cpu time            0.00 seconds
 
 
WARNING: This CREATE TABLE statement recursively references the target table. A consequence of this is a possible data integrity problem.
WARNING: Variable clus_desc already exists on file EMWS3.TEXTCLUSTER13_CLUSTERS.
NOTE: Table EMWS3.TEXTCLUSTER13_CLUSTERS created, with 8 rows and 105 columns.
 
NOTE: PROCEDURE SQL used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
 
 
WARNING: This CREATE TABLE statement recursively references the target table. A consequence of this is a possible data integrity problem.
WARNING: Variable Resume_str already exists on file EMWS3.TEXTCLUSTER13_TRAIN.
WARNING: Variable TextCluster13_cluster_ already exists on file EMWS3.TEXTCLUSTER13_TRAIN.
NOTE: Table EMWS3.TEXTCLUSTER13_TRAIN created, with 674 rows and 114 columns.
 
NOTE: PROCEDURE SQL used (Total process time):
      real time           0.02 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 674 observations read from the data set WORK._DOCDATA.
NOTE: The data set WORK._TEMPFREQTABLE has 8 observations and 3 variables.
NOTE: The PROCEDURE FREQ printed page 2.
NOTE: PROCEDURE FREQ used (Total process time):
      real time           0.02 seconds
      cpu time            0.01 seconds
 
 
WARNING: This CREATE TABLE statement recursively references the target table. A consequence of this is a possible data integrity problem.
NOTE: Table EMWS3.TEXTCLUSTER13_CLUSTERS created, with 8 rows and 104 columns.
 
NOTE: PROCEDURE SQL used (Total process time):
      real time           0.02 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 674 observations read from the data set WORK._DOCDATA.
NOTE: The data set WORK._DOCDATA has 674 observations and 114 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.05 seconds
      cpu time            0.01 seconds
 
 
 
NOTE: There were 674 observations read from the data set WORK._DOCDATA.
NOTE: There were 8 observations read from the data set EMWS3.TEXTCLUSTER13_CLUSTERS.
NOTE: The data set WORK._RMSCALC has 674 observations and 218 variables.
NOTE: DATA statement used (Total process time):
      real time           0.02 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 674 observations read from the data set WORK._RMSCALC.
NOTE: The data set WORK._MEANERR has 8 observations and 5 variables.
NOTE: PROCEDURE SUMMARY used (Total process time):
      real time           0.02 seconds
      cpu time            0.01 seconds
 
 
 
NOTE: There were 8 observations read from the data set WORK._MEANERR.
NOTE: The data set WORK._RMSSE has 8 observations and 2 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.00 seconds
 
 
WARNING: Variable _cluster_ already exists on file WORK._CLUSSTAT2.
NOTE: Table WORK._CLUSSTAT2 created, with 8 rows and 105 columns.
 
NOTE: Table EMWS3.TEXTCLUSTER13_CLUSTERS created, with 8 rows and 105 columns.
 
NOTE: PROCEDURE SQL used (Total process time):
      real time           0.02 seconds
      cpu time            0.00 seconds
 
 
NOTE: PROCEDURE SQL used (Total process time):
      real time           0.00 seconds
      cpu time            0.01 seconds
 
 
 
NOTE: There were 405 observations read from the data set EMWS3.TEXTFILTER7_VALIDATE.
NOTE: The data set WORK._IMPORT_DS has 405 observations and 5 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: Input data set is already sorted; it has been copied to the output data set.
NOTE: There were 16666 observations read from the data set WORK._CLUSTERMS.
      WHERE keep='Y';
NOTE: The data set WORK._TERMS has 16666 observations and 2 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: Input data set is already sorted; it has been copied to the output data set.
NOTE: There were 121692 observations read from the data set EMWS3.TEXTFILTER7_VALIDOUT.
NOTE: The data set EMWS3.TEXTFILTER7_VALIDOUT has 121692 observations and 3 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.02 seconds
      cpu time            0.01 seconds
 
 
 
NOTE: There were 13209 observations read from the data set WORK._TERMS.
      WHERE PARENT not = _termnum_;
NOTE: There were 121692 observations read from the data set EMWS3.TEXTFILTER7_VALIDOUT.
NOTE: The data set WORK._SVDM1 has 121692 observations and 3 variables.
NOTE: DATA statement used (Total process time):
      real time           0.02 seconds
      cpu time            0.03 seconds
 
 
NOTE: Table WORK._SCROUT created, with 121692 rows and 3 columns.
 
NOTE: Table WORK._SVDM1 has been dropped.
NOTE: Table WORK._TERMS has been dropped.
NOTE: PROCEDURE SQL used (Total process time):
      real time           0.04 seconds
      cpu time            0.03 seconds
 
 
 
NOTE: Input data set is already sorted; it has been copied to the output data set.
NOTE: There were 8502 observations read from the data set WORK._CLUSTERMS.
      WHERE (KEEP='Y') and (PARENT=.);
NOTE: The data set WORK._WEIGHTS has 8502 observations and 2 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 121692 observations read from the data set WORK._SCROUT.
NOTE: The data set WORK._SCROUT has 121692 observations and 3 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.04 seconds
      cpu time            0.01 seconds
 
 
 
NOTE: There were 8502 observations read from the data set EMWS3.TEXTCLUSTER13_SVD_U.
NOTE: The data set EMWS3.TEXTCLUSTER13_SVD_U has 8502 observations and 101 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.00 seconds
 
 
NOTE: Table WORK._INWEIGHTS created, with 8502 rows and 2 columns.
 
NOTE: PROCEDURE SQL used (Total process time):
      real time           0.02 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 121692 observations read from the data set WORK._SCROUT.
NOTE: There were 8502 observations read from the data set EMWS3.TEXTCLUSTER13_SVD_U.
NOTE: There were 8502 observations read from the data set WORK._INWEIGHTS.
NOTE: The data set WORK._COLPRO has 405 observations and 101 variables.
NOTE: PROCEDURE SPSVD used (Total process time):
      real time           0.10 seconds
      cpu time            0.01 seconds
 
 
 
NOTE: There were 405 observations read from the data set WORK._IMPORT_DS.
NOTE: The data set WORK._IMPORT_DS has 405 observations and 5 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.02 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 405 observations read from the data set WORK._COLPRO.
NOTE: The data set WORK._COLPRO has 405 observations and 101 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 405 observations read from the data set WORK._IMPORT_DS.
NOTE: There were 405 observations read from the data set WORK._COLPRO.
NOTE: The data set EMWS3.TEXTCLUSTER13_VALIDATE has 405 observations and 105 variables.
NOTE: DATA statement used (Total process time):
      real time           0.02 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 405 observations read from the data set EMWS3.TEXTCLUSTER13_VALIDATE.
NOTE: The data set EMWS3.TEXTCLUSTER13_VALIDATE has 405 observations and 105 variables.
NOTE: DATA statement used (Total process time):
      real time           0.02 seconds
      cpu time            0.01 seconds
 
 
 
NOTE: There were 405 observations read from the data set EMWS3.TEXTCLUSTER13_VALIDATE.
NOTE: The data set EMWS3.TEXTCLUSTER13_VALIDATE has 405 observations and 105 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.04 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 405 observations read from the data set EMWS3.TEXTCLUSTER13_VALIDATE.
NOTE: There were 17 observations read from the data set EMWS3.TEXTCLUSTER13_EMOUTSTAT.
NOTE: The data set EMWS3.TEXTCLUSTER13_VALIDATE has 405 observations and 114 variables.
NOTE: PROCEDURE EMCLUS used (Total process time):
      real time           0.02 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 405 observations read from the data set EMWS3.TEXTCLUSTER13_VALIDATE.
NOTE: The data set EMWS3.TEXTCLUSTER13_VALIDATE has 405 observations and 114 variables.
NOTE: Compressing data set EMWS3.TEXTCLUSTER13_VALIDATE decreased size by 64.86 percent.
      Compressed is 13 pages; un-compressed would require 37 pages.
NOTE: DATA statement used (Total process time):
      real time           0.02 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 405 observations read from the data set EMWS3.TEXTCLUSTER13_VALIDATE.
NOTE: The data set EMWS3.TEXTCLUSTER13_VALIDATE has 405 observations and 114 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.00 seconds
 
 
WARNING: This CREATE TABLE statement recursively references the target table. A consequence of this is a possible data integrity problem.
WARNING: Variable Resume_str already exists on file EMWS3.TEXTCLUSTER13_VALIDATE.
WARNING: Variable TextCluster13_cluster_ already exists on file EMWS3.TEXTCLUSTER13_VALIDATE.
NOTE: Table EMWS3.TEXTCLUSTER13_VALIDATE created, with 405 rows and 114 columns.
 
NOTE: PROCEDURE SQL used (Total process time):
      real time           0.02 seconds
      cpu time            0.00 seconds
 
 
NOTE: PROCEDURE SQL used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 274 observations read from the data set EMWS3.TEXTFILTER7_TEST.
NOTE: The data set WORK._IMPORT_DS has 274 observations and 5 variables.
NOTE: DATA statement used (Total process time):
      real time           0.02 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: Input data set is already sorted; it has been copied to the output data set.
NOTE: There were 16666 observations read from the data set WORK._CLUSTERMS.
      WHERE keep='Y';
NOTE: The data set WORK._TERMS has 16666 observations and 2 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: Input data set is already sorted; it has been copied to the output data set.
NOTE: There were 80503 observations read from the data set EMWS3.TEXTFILTER7_TESTOUT.
NOTE: The data set EMWS3.TEXTFILTER7_TESTOUT has 80503 observations and 3 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.02 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 13209 observations read from the data set WORK._TERMS.
      WHERE PARENT not = _termnum_;
NOTE: There were 80503 observations read from the data set EMWS3.TEXTFILTER7_TESTOUT.
NOTE: The data set WORK._SVDM1 has 80503 observations and 3 variables.
NOTE: DATA statement used (Total process time):
      real time           0.02 seconds
      cpu time            0.00 seconds
 
 
NOTE: Table WORK._SCROUT created, with 80503 rows and 3 columns.
 
NOTE: Table WORK._SVDM1 has been dropped.
NOTE: Table WORK._TERMS has been dropped.
NOTE: PROCEDURE SQL used (Total process time):
      real time           0.04 seconds
      cpu time            0.01 seconds
 
 
 
NOTE: Input data set is already sorted; it has been copied to the output data set.
NOTE: There were 8502 observations read from the data set WORK._CLUSTERMS.
      WHERE (KEEP='Y') and (PARENT=.);
NOTE: The data set WORK._WEIGHTS has 8502 observations and 2 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 80503 observations read from the data set WORK._SCROUT.
NOTE: The data set WORK._SCROUT has 80503 observations and 3 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.02 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 8502 observations read from the data set EMWS3.TEXTCLUSTER13_SVD_U.
NOTE: The data set EMWS3.TEXTCLUSTER13_SVD_U has 8502 observations and 101 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.00 seconds
 
 
NOTE: Table WORK._INWEIGHTS created, with 8502 rows and 2 columns.
 
NOTE: PROCEDURE SQL used (Total process time):
      real time           0.03 seconds
      cpu time            0.01 seconds
 
 
 
NOTE: There were 80503 observations read from the data set WORK._SCROUT.
NOTE: There were 8502 observations read from the data set EMWS3.TEXTCLUSTER13_SVD_U.
NOTE: There were 8502 observations read from the data set WORK._INWEIGHTS.
NOTE: The data set WORK._COLPRO has 274 observations and 101 variables.
NOTE: PROCEDURE SPSVD used (Total process time):
      real time           0.06 seconds
      cpu time            0.01 seconds
 
 
 
NOTE: There were 274 observations read from the data set WORK._IMPORT_DS.
NOTE: The data set WORK._IMPORT_DS has 274 observations and 5 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.01 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 274 observations read from the data set WORK._COLPRO.
NOTE: The data set WORK._COLPRO has 274 observations and 101 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 274 observations read from the data set WORK._IMPORT_DS.
NOTE: There were 274 observations read from the data set WORK._COLPRO.
NOTE: The data set EMWS3.TEXTCLUSTER13_TEST has 274 observations and 105 variables.
NOTE: DATA statement used (Total process time):
      real time           0.02 seconds
      cpu time            0.01 seconds
 
 
 
NOTE: There were 274 observations read from the data set EMWS3.TEXTCLUSTER13_TEST.
NOTE: The data set EMWS3.TEXTCLUSTER13_TEST has 274 observations and 105 variables.
NOTE: DATA statement used (Total process time):
      real time           0.02 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 274 observations read from the data set EMWS3.TEXTCLUSTER13_TEST.
NOTE: The data set EMWS3.TEXTCLUSTER13_TEST has 274 observations and 105 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.02 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 274 observations read from the data set EMWS3.TEXTCLUSTER13_TEST.
NOTE: There were 17 observations read from the data set EMWS3.TEXTCLUSTER13_EMOUTSTAT.
NOTE: The data set EMWS3.TEXTCLUSTER13_TEST has 274 observations and 114 variables.
NOTE: PROCEDURE EMCLUS used (Total process time):
      real time           0.01 seconds
      cpu time            0.01 seconds
 
 
 
NOTE: There were 274 observations read from the data set EMWS3.TEXTCLUSTER13_TEST.
NOTE: The data set EMWS3.TEXTCLUSTER13_TEST has 274 observations and 114 variables.
NOTE: Compressing data set EMWS3.TEXTCLUSTER13_TEST decreased size by 64.00 percent.
      Compressed is 9 pages; un-compressed would require 25 pages.
NOTE: DATA statement used (Total process time):
      real time           0.02 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 274 observations read from the data set EMWS3.TEXTCLUSTER13_TEST.
NOTE: The data set EMWS3.TEXTCLUSTER13_TEST has 274 observations and 114 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.01 seconds
 
 
WARNING: This CREATE TABLE statement recursively references the target table. A consequence of this is a possible data integrity problem.
WARNING: Variable Resume_str already exists on file EMWS3.TEXTCLUSTER13_TEST.
WARNING: Variable TextCluster13_cluster_ already exists on file EMWS3.TEXTCLUSTER13_TEST.
NOTE: Table EMWS3.TEXTCLUSTER13_TEST created, with 274 rows and 114 columns.
 
NOTE: PROCEDURE SQL used (Total process time):
      real time           0.02 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: DATA statement used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: The file PRE is:
      Filename=C:\Users\lahar\OneDrive\Desktop\Data Mining\Resume\Workspaces\EMWS3\TextCluster13\PRESCORECODE.sas,
      RECFM=V,LRECL=32767,File Size (bytes)=0,
      Last Modified=26Nov2023:12:17:49,
      Create Time=26Nov2023:12:17:49
 
NOTE: 13 records were written to the file PRE.
      The minimum record length was 14.
      The maximum record length was 62.
NOTE: DATA statement used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: The file PRE is:
      Filename=C:\Users\lahar\OneDrive\Desktop\Data Mining\Resume\Workspaces\EMWS3\TextCluster13\PRESCORECODE.sas,
      RECFM=V,LRECL=20000,File Size (bytes)=452,
      Last Modified=26Nov2023:12:17:49,
      Create Time=26Nov2023:12:17:49
 
NOTE: 23 records were written to the file PRE.
      The minimum record length was 1.
      The maximum record length was 86.
NOTE: DATA statement used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
 
 
NOTE: Fileref TMPRE has been deassigned.
 
NOTE: There were 8 observations read from the data set EMWS3.TEXTCLUSTER13_CLUSTERS.
NOTE: The data set WORK._CODECLUSTERS has 8 observations and 104 variables.
NOTE: DATA statement used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
 
 
NOTE: Libref TERMLOC refers to the same physical library as EMWS3.
NOTE: Libref TERMLOC was successfully assigned as follows:
      Engine:        V9
      Physical Name: C:\Users\lahar\OneDrive\Desktop\Data Mining\Resume\Workspaces\EMWS3
 
NOTE: The file _TMSCORE is:
      Filename=C:\Users\lahar\OneDrive\Desktop\Data Mining\Resume\Workspaces\EMWS3\TextCluster13\EMPUBLISHSCORE.sas,
      RECFM=V,LRECL=32767,File Size (bytes)=0,
      Last Modified=26Nov2023:12:17:49,
      Create Time=26Nov2023:12:17:49
 
NOTE: 5 records were written to the file _TMSCORE.
      The minimum record length was 43.
      The maximum record length was 122.
NOTE: DATA statement used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
 
 
NOTE: Fileref _TMSCORE has been deassigned.
NOTE: Fileref TEMP has been deassigned.
19455  *------------------------------------------------------------*;
19456  * End SCORE: TextCluster13;
19457  *------------------------------------------------------------*;
 
19459  *------------------------------------------------------------*;
19460  * TextCluster13: Computing metadata for TRAIN data;
19461  *------------------------------------------------------------*;
 
20343  proc sort data = EMWS3.TextFilter7_EMINFO OUT=WORK.SORTEDEMINFO NOTHREADS;
20344  by TARGET KEY;
20345  run;
 
NOTE: There were 5 observations read from the data set EMWS3.TEXTFILTER7_EMINFO.
NOTE: The data set WORK.SORTEDEMINFO has 5 observations and 3 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
 
 
20346  proc sort data = EMWS3.TextCluster13_EMINFO OUT=WORK.TEMP_INFO NOTHREADS;
20347  by TARGET KEY;
20348  run;
 
NOTE: There were 4 observations read from the data set EMWS3.TEXTCLUSTER13_EMINFO.
NOTE: The data set WORK.TEMP_INFO has 4 observations and 3 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
 
 
20349  data EMWS3.TextCluster13_EMINFO;
20350  merge WORK.SORTEDEMINFO WORK.TEMP_INFO;
20351  by TARGET KEY;
20352  run;
 
NOTE: There were 5 observations read from the data set WORK.SORTEDEMINFO.
NOTE: There were 4 observations read from the data set WORK.TEMP_INFO.
NOTE: The data set EMWS3.TEXTCLUSTER13_EMINFO has 6 observations and 3 variables.
NOTE: DATA statement used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
 
 
20353  proc datasets lib=work nolist;
20354  delete TEMP_INFO SORTEDEMINFO;
20355  run;
 
NOTE: Deleting WORK.TEMP_INFO (memtype=DATA).
NOTE: Deleting WORK.SORTEDEMINFO (memtype=DATA).
20356  quit;
 
NOTE: PROCEDURE DATASETS used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
 
 
*------------------------------------------------------------*
* Report Log
Date:                November 26, 2023
Time:                12:17:49
*------------------------------------------------------------*
20380  %let EMEXCEPTIONSTRING=;
20381  *------------------------------------------------------------*;
20382  * REPORT: TextCluster13;
20383  *------------------------------------------------------------*;
20384  %let EM_ACTION = REPORT;
20385  %let syscc = 0;
20386  %macro main();
20387
20388     %if %upcase(&EM_ACTION) eq CREATE %then %do;
20389        filename temp catalog 'sashelp.emtxtext.cluster_create.source';
20390        %include temp;
20391        %create();
20392     %end;
20393     %if %upcase(&EM_ACTION) eq TRAIN %then %do;
20394        filename temp catalog 'sashelp.emtxtext.cluster_train.source';
20395        %include temp;
20396        %train();
20397     %end;
20398     %if %upcase(&EM_ACTION) eq REPORT %then %do;
20399        filename temp catalog 'sashelp.emtxtext.cluster_report.source';
20400        %include temp;
20401        %report();
20402     %end;
20403     %if %upcase(&EM_ACTION) eq SCORE %then %do;
20404        filename temp catalog 'sashelp.emtxtext.cluster_score.source';
20405        %include temp;
20406        %score();
20407     %end;
20408  %mend main;
20409
20410  %main();
NOTE: %INCLUDE (level 1) file TEMP is file SASHELP.EMTXTEXT.CLUSTER_REPORT.SOURCE.
20411 +%macro report();
20412 +
20413 +    %EM_GETNAME(KEY=GRAPH_TABLE, TYPE=DATA);
20414 +    %EM_GETNAME(KEY=clusters, TYPE=DATA);
20415 +    %EM_GETNAME(KEY=prescorecode, type=file, extension=sas);
20416 +    %em_getname(key=svd_s, type=data);
20417 +    %em_getname(key=hierds, type=data);
20418 +
20419 +    proc sql noprint;
20420 +        select count(*) into :svdkeep
20421 +            from &em_user_svd_s
20422 +            where keep=1;
20423 +        select count(*) into :nclus
20424 +            from &em_user_clusters;
20425 +    quit;
20426 +    %let svdkeep=%left(&svdkeep);
20427 +    %let nclus=%left(&nclus);
20428 +    %let clusterid=%sysfunc(sasmsg(sashelp.tmine, rpt_text_clusterid_vlabel, NOQUOTE));
20429 +    %let frequency=%sysfunc(sasmsg(sashelp.tmine, rpt_text_frequency_vlabel, NOQUOTE));
20430 +    %let percentage=%sysfunc(sasmsg(sashelp.tmine, rpt_text_percentage_vlabel, NOQUOTE));
20431 +    %let descterms=%sysfunc(sasmsg(sashelp.tmine, rpt_text_descterms_vlabel, NOQUOTE));
20432 +    %let rmsstd=%sysfunc(sasmsg(sashelp.tmine, rpt_text_rmsstd_vlabel, NOQUOTE));
20433 +    %let coordinate=%sysfunc(sasmsg(sashelp.tmine, rpt_text_coordinate_vlabel, NOQUOTE));
20434 +    %let parent=%sysfunc(sasmsg(sashelp.tmine, rpt_text_parent_vlabel, NOQUOTE));
20435 +    %let hierlevel=%sysfunc(sasmsg(sashelp.tmine, rpt_text_hierlevel_vlabel, NOQUOTE));
20436 +    %let graphdesc=%sysfunc(sasmsg(sashelp.tmine, rpt_text_graphdesc_vlabel, NOQUOTE));
20437 +    %let descshort=%sysfunc(sasmsg(sashelp.tmine, rpt_text_descshort_vlabel, NOQUOTE));
20438 +
20439 +    data &em_user_graph_table;
20440 +        set &em_user_clusters;
20441 +        label _cluster_="&clusterid"
20442 +              clus_desc="&DescTerms"
20443 +              freq="&Frequency"
20444 +              percent="&Percentage"
20445 +              _rmsstd_="&rmsstd"
20446 +              %do i=1 %to &svdkeep;
20447 +                _mean&i="&Coordinate &i"
20448 +              %end;
20449 +              ;
20450 +        format percent percent10.;
20451 +        desc_short = clus_desc;
20452 +        if COUNTW(clus_desc, ' ') > 5 then do;
20453 +            call scan(clus_desc, 6, position, len, ' ');
20454 +            desc_short=substr(clus_desc, 1, position-1) || '...';
20455 +            drop position len;
20456 +            label desc_short="&descshort";
20457 +        end;
20458 +    run;
20459 +
20460 +    proc sql noprint;
20461 +        create table &em_user_graph_table as
20462 +        select _cluster_, clus_desc, freq, percent, *
20463 +        from &em_user_graph_table;
20464 +    quit;
20465 +
20466 +    %let block = %sysfunc(sasmsg(sashelp.tmine, rpt_text_clusters_title, NOQUOTE));
20467 +
20468 +    %let desc = %sysfunc(sasmsg(sashelp.tmine, rpt_text_prescore_title, NOQUOTE));
20469 +    %EM_REPORT(KEY=PRESCORECODE, VIEWTYPE=SOURCE, DESCRIPTION=%nrbquote(&desc),
20470 +              BLOCK=Scoring, AUTODISPLAY=N);
20471 +
20472 +    %let desc = %sysfunc(sasmsg(sashelp.tmine, rpt_text_clusfreqbyrms_title, NOQUOTE));
20473 +    %EM_REPORT(KEY=GRAPH_TABLE, VIEWTYPE=SCATTER, X=FREQ, Y=_RMSSTD_, DESCRIPTION=%nrbquote(&desc),
20474 +            BLOCK=%nrbquote(&block), AUTODISPLAY=Y, TIP=%if &em_property_nDescTerms > 5 %then desc_short; %else clus_desc;);
20475 +
20476 +    %let desc = %sysfunc(sasmsg(sashelp.tmine, rpt_text_clusters_title, NOQUOTE));
20477 +    %EM_REPORT(KEY=GRAPH_TABLE, VIEWTYPE=DATA, DESCRIPTION=%nrbquote(&desc), BLOCK=%nrbquote(&block), AUTODISPLAY=Y);
20478 +
20479 +    %if &nclus > 2 %then %do;
20480 +        data work.graph_table(drop=_cluster_);
20481 +            set &em_user_graph_table;
20482 +            cluster=put(_cluster_,best12.);
20483 +        run;
20484 +        proc distance data=work.graph_table out=work.graph_table method=EUCLID nostd;
20485 +            var RATIO(_mean1-_mean&svdkeep);
20486 +            id cluster;
20487 +        run;
20488 +        proc mds data=work.graph_table out=work.graph_table
20489 +            level=ratio dimension=2 noprint;
20490 +        run;
20491 +        data work.graph_table;
20492 +            set work.graph_table;
20493 +            if _name_ ne '';
20494 +            Cluster=input(substr(_name_,2),8.);
20495 +            LABEL dim1='X' dim2='Y';
20496 +        run;
20497 +        proc sql noprint;
20498 +            create table &em_user_graph_table as
20499 +            select a.*, b.dim1, b.dim2
20500 +            from &em_user_graph_table a, work.graph_table b
20501 +            where a._cluster_=b.cluster;
20502 +        quit;
20503 +
20504 +        %let desc = %sysfunc(sasmsg(sashelp.tmine, rpt_text_clusterdist_title, NOQUOTE));
20505 +        %EM_REPORT(KEY=GRAPH_TABLE, VIEWTYPE=SCATTER, X=DIM1, Y=DIM2, BLOCK=%nrbquote(&BLOCK),
20506 +            DESCRIPTION=%nrbquote(&desc), AUTODISPLAY=Y, TIP=%if &em_property_nDescTerms > 5 %then desc_short; %else clus_desc;,
20507 +            GROUP=_CLUSTER_, LEGEND=N);
20508 +    %end;
20509 +    %else %do;
20510 +        %put &em_codebar;
20511 +        %let errormsg=%sysfunc(sasmsg(sashelp.tmine, EMTOOL.NODISTANCEREPORT_NOTE, NOQUOTE));
20512 +        %put &errormsg;
20513 +        %put &em_codebar;
20514 +    %end;
20515 +
20516 +    %let desc = %sysfunc(sasmsg(sashelp.tmine, rpt_text_clusterfreq_title, NOQUOTE));
20517 +    %EM_REPORT(KEY=GRAPH_TABLE, VIEWTYPE=PIE, X=_cluster_, Y=freq, DESCRIPTION=%nrbquote(&desc),
20518 +        TOOLTIP=clus_desc, BLOCK=%nrbquote(&block), AUTODISPLAY=Y);
20519 +
20520 +    %if &EM_PROPERTY_ALGORITHM=2.0 %then %do;
20521 +
20522 +        proc sql noprint;
20523 +            create table &em_user_hierds as
20524 +            select level, _cluster_, parent, clus_desc, *
20525 +            from &em_user_hierds;
20526 +        quit;
20527 +        filename temp catalog 'sashelp.emtext.tmsort.source';
20528 +        %include temp;
20529 +        %tmsort(data=&em_user_hierds, out=, by=level parent _cluster_);
20530 +
20531 +        data &em_user_hierds;
20532 +            set &em_user_hierds;
20533 +            label _cluster_="&clusterid"
20534 +                  clus_desc="&descterms"
20535 +                  freq="&frequency"
20536 +                  parent="&parent"
20537 +                  level="&hierlevel"
20538 +                  graphdesc="&graphdesc";
20539 +        run;
20540 +        %let desc = %sysfunc(sasmsg(sashelp.tmine, rpt_text_clusterhierarchy_title, NOQUOTE));
20541 +        %em_report(viewtype=constellation, linkkey=hierds, nodekey=hierds, method=HIERARCHY,
20542 +            linkfrom=_CLUSTER_,linkto=PARENT,linkid=_cluster_,nodeid=_CLUSTER_,nodesize=FREQ,nodelabel=graphdesc,
20543 +            nodetip=clus_desc, BLOCK=%nrbquote(&block), DESCRIPTION=%nrbquote(&desc), AUTODISPLAY=Y);
20544 +
20545 +        %let desc = %sysfunc(sasmsg(sashelp.tmine, rpt_text_hierarchydata_title, NOQUOTE));
20546 +        %em_report(KEY=hierds, VIEWTYPE=data, DESCRIPTION=%nrbquote(&DESC), AUTODISPLAY=Y, BLOCK=%nrbquote(&BLOCK));
20547 +    %end;
20548 +
20549 +    proc sql noprint;
20550 +        drop table work.graph_table;
20551 +    quit;
20552 +
20553 +%mend report;
20554 +
NOTE: %INCLUDE (level 1) ending.
NOTE: PROCEDURE SQL used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 8 observations read from the data set EMWS3.TEXTCLUSTER13_CLUSTERS.
NOTE: The data set EMWS3.TEXTCLUSTER13_GRAPH_TABLE has 8 observations and 106 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.00 seconds
 
 
WARNING: This CREATE TABLE statement recursively references the target table. A consequence of this is a possible data integrity problem.
WARNING: Variable clus_desc already exists on file EMWS3.TEXTCLUSTER13_GRAPH_TABLE.
WARNING: Variable _CLUSTER_ already exists on file EMWS3.TEXTCLUSTER13_GRAPH_TABLE.
WARNING: Variable freq already exists on file EMWS3.TEXTCLUSTER13_GRAPH_TABLE.
WARNING: Variable percent already exists on file EMWS3.TEXTCLUSTER13_GRAPH_TABLE.
NOTE: Table EMWS3.TEXTCLUSTER13_GRAPH_TABLE created, with 8 rows and 106 columns.
 
NOTE: PROCEDURE SQL used (Total process time):
      real time           0.01 seconds
      cpu time            0.01 seconds
 
 
 
NOTE: The data set WORK.EM_USER_REPORT has 132 observations and 4 variables.
NOTE: DATA statement used (Total process time):
      real time           0.02 seconds
      cpu time            0.01 seconds
 
 
 
NOTE: There were 132 observations read from the data set WORK.EM_USER_REPORT.
NOTE: The data set WORK.EM_USER_REPORT has 265 observations and 4 variables.
NOTE: DATA statement used (Total process time):
      real time           0.02 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 265 observations read from the data set WORK.EM_USER_REPORT.
NOTE: The data set WORK.EM_USER_REPORT has 397 observations and 4 variables.
NOTE: DATA statement used (Total process time):
      real time           0.02 seconds
      cpu time            0.01 seconds
 
 
 
NOTE: There were 8 observations read from the data set EMWS3.TEXTCLUSTER13_GRAPH_TABLE.
NOTE: The data set WORK.GRAPH_TABLE has 8 observations and 106 variables.
NOTE: DATA statement used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
 
 
 
WARNING: Found negative value(s) in the ratio variable(s). The distance matrix may be meaningless.
NOTE: The data set WORK.GRAPH_TABLE has 8 observations and 9 variables.
NOTE: PROCEDURE DISTANCE used (Total process time):
      real time           0.01 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: Convergence reached in 10 iterations.
NOTE: The data set WORK.GRAPH_TABLE has 10 observations and 7 variables.
NOTE: PROCEDURE MDS used (Total process time):
      real time           0.01 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 10 observations read from the data set WORK.GRAPH_TABLE.
NOTE: The data set WORK.GRAPH_TABLE has 8 observations and 8 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.00 seconds
 
 
WARNING: This CREATE TABLE statement recursively references the target table. A consequence of this is a possible data integrity problem.
NOTE: Table EMWS3.TEXTCLUSTER13_GRAPH_TABLE created, with 8 rows and 108 columns.
 
NOTE: PROCEDURE SQL used (Total process time):
      real time           0.01 seconds
      cpu time            0.00 seconds
 
 
 
NOTE: There were 397 observations read from the data set WORK.EM_USER_REPORT.
NOTE: The data set WORK.EM_USER_REPORT has 530 observations and 4 variables.
NOTE: DATA statement used (Total process time):
      real time           0.02 seconds
      cpu time            0.01 seconds
 
 
 
NOTE: There were 530 observations read from the data set WORK.EM_USER_REPORT.
NOTE: The data set WORK.EM_USER_REPORT has 663 observations and 4 variables.
NOTE: DATA statement used (Total process time):
      real time           0.02 seconds
      cpu time            0.00 seconds
 
 
NOTE: Table WORK.GRAPH_TABLE has been dropped.
NOTE: PROCEDURE SQL used (Total process time):
      real time           0.00 seconds
      cpu time            0.01 seconds
 
 
20555  *------------------------------------------------------------*;
20556  * End REPORT: TextCluster13;
20557  *------------------------------------------------------------*;
 
20558  /* Reset EM Options */
20559  options formchar="|----|+|---+=|-/\<>*";
20560  options nocenter ls=256 ps=10000;
20561  goptions reset=all device=GIF NODISPLAY;
 
20562  proc sort data=WORK.EM_USER_REPORT;
20563  by ID VIEW;
20564  run;
 
NOTE: There were 663 observations read from the data set WORK.EM_USER_REPORT.
NOTE: The data set WORK.EM_USER_REPORT has 663 observations and 4 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
 
 
